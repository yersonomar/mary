/*!CK:1736669907!*//*1457473237,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["9Dq8F"]); }

__d("PhotoWarningScreenConfig",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={GraphicEvents:{GRAPHIC_PHOTO_SHOWN_NO_WARNING:"GRAPHIC_PHOTO_SHOWN_NO_WARNING",GRAPHIC_PHOTO_SHOWN_WITH_WARNING:"GRAPHIC_PHOTO_SHOWN_WITH_WARNING",GRAPHIC_PHOTO_WARNING_DISMISSED:"GRAPHIC_PHOTO_WARNING_DISMISSED"},ObjectionableEvents:{INVALIDATE_CONTENT:"invalidate_content",SHOW_WARNING_SCREEN:"show_warning_screen",WARNING_SCREEN_DISMISSED:"warning_screen_dismissed",WARNING_SCREEN_REENABLED:"warning_screen_reenabled",MARK_OBJECTIONABLE:"mark_objectionable",UNDO_MARK_OBJECTIONABLE:"undo_mark_objectionable"},Types:{GRAPHIC:"graphic",OBJECTIONABLE:"objectionable"}};},null);
__d("SpotlightViewerLoggingEvents",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LOADED:"loaded",LOADING:"loading",ERROR:"error",ABORT:"abort",OPEN_BEGIN:"open_begin",OPEN_COMPLETE:"open_complete",CLOSE_BEGIN:"close_begin",CLOSE_COMPLETE:"close_complete",PAGE_BEGIN:"page_begin",PAGE_COMPLETE:"page_complete",PHOTO_CHANGE_BEGIN:"photo_change_begin",PHOTO_CHANGE_COMPLETE:"photo_change_complete",DATA_FETCH_BEGIN:"data_fetch_begin",DATA_FETCH_COMPLETE:"data_fetch_complete",PHOTO_FETCH:"photo_fetch"};},null);
__d('ImageUtils',['UserAgent_DEPRECATED'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={hasLoaded:function(i){if(i.naturalWidth!==undefined){return i.complete&&i.width!==0;}else if(i.height==20&&i.width==20&&i.complete){return false;}else if(i.complete===undefined&&c('UserAgent_DEPRECATED').webkit()<500){var j=new Image();j.src=i.src;return j.complete;}return i.complete;}};f.exports=h;},null);
__d('PhotoEverstoreLogger',['Event','AsyncRequest','ImageUtils'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={BATCH_WINDOW_MS:500,storedLog:[]};function i(){}Object.assign(i,{_log:function(k){h.storedLog.push(k);if(h.storedLog.length==1)setTimeout(j,h.BATCH_WINDOW_MS);},logImmediately:function(k){i._log(k);},registerForLogging:function(k){var l=document.getElementById(k);if(l!=null)if(c('ImageUtils').hasLoaded(l)){i._log(l.src);}else c('Event').listen(l,'load',function(event){i._log(l.src);});}});function j(){var k=h.storedLog;h.storedLog=[];var l=JSON.stringify(k);new (c('AsyncRequest'))().setURI('/ajax/photos/logging/everstore_logging.php').setData({loggedUrls:l}).setMethod('POST').setOption('suppressErrorHandlerWarning',true).setOption('suppressErrorAlerts',true).send();}f.exports=i;},null);
__d('PhotoViewerImage',['PhotoEverstoreLogger','URI','Vector'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this._hiResDimensions=i.hiResDimensions&&c('Vector').deserialize(i.hiResDimensions);this._normalDimensions=i.normalDimensions&&c('Vector').deserialize(i.normalDimensions);this._info=i.info;this._video=i.video;this._shouldLog=i.everstoreLogThis;this._hiResSrc=i.hiResSrc;this._normalSrc=i.normalSrc;this._thumbSrc=i.thumbSrc;this._isInverted=false;this._data=i;}h.prototype.getURIString=function(){'use strict';return new (c('URI'))(this._info.permalink).getUnqualifiedURI().toString();};h.prototype.hasHiResDimensions=function(){'use strict';return !!this._hiResDimensions;};h.prototype.getHiResDimensions=function(){'use strict';return this._hiResDimensions;};h.prototype.getNormalDimensions=function(){'use strict';return this._normalDimensions;};h.prototype.getHiResSrc=function(){'use strict';return this._hiResSrc;};h.prototype.getNormalSrc=function(){'use strict';return this._normalSrc;};h.prototype.getThumbSrc=function(){'use strict';return this._thumbSrc;};h.prototype.getInfo=function(){'use strict';return this._info;};h.prototype.getPermalink=function(){'use strict';return this._info.permalink;};h.prototype.getHighestResSrc=function(){'use strict';return this._hiResSrc||this._normalSrc;};h.prototype.preload=function(i){'use strict';var j;if(this.getHighestResSrc())if(i&&!this._resource){this._resource=new Image();this._resource.src=this.getHighestResSrc();j=this._resource.src;if(this._shouldLog)c('PhotoEverstoreLogger').logImmediately(this._resource.src);}else if(!i&&!this._small){this._small=new Image();this._small.src=this._normalSrc||this._hiResSrc;j=this._small.src;if(this._shouldLog)c('PhotoEverstoreLogger').logImmediately(this._small.src);}return j;};h.prototype.setNormalDimensions=function(i,j){'use strict';this._normalDimensions=new (c('Vector'))(i,j);};h.prototype.setHiResDimensions=function(i,j){'use strict';this._hiResDimensions=new (c('Vector'))(i,j);};h.prototype.invertDimensions=function(){'use strict';if(this.hasHiResDimensions())this._hiResDimensions=new (c('Vector'))(this._hiResDimensions.y,this._hiResDimensions.x);this._normalDimensions=new (c('Vector'))(this._normalDimensions.y,this._normalDimensions.x);this._isInverted=!this._isInverted;};h.prototype.copy=function(){'use strict';return new h(this._data);};f.exports=h;},null);
__d('PhotosConst',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,VIEWER_SNOWFLAKE:14,VIEWER_COMPOSER:16,VIEWER_CAROUSEL:19,VIEWER_PERMALINK_STRING:'permalink',VIEWER_SNOWLIFT_STRING:'snowlift',VIEWER_VAULTBOX_STRING:'vaultbox',VIEWER_CAROUSEL_STRING:'carousel',BULK_EDITOR:3,BULK_EDITOR_REACT:15,EDITOR_MODAL:17,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:'n',PIC_NORMAL_FBX_SIZE:180,ALBUM_NAME_MAXLEN:65};f.exports=h;},null);
__d('PhotoStreamCache',['DOM','HTML','PhotoEverstoreLogger','PhotosConst','PhotoViewerImage','Rect','UIPagelet','URI','Vector','ge'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';}h.prototype.init=function(i,j,k,l,m){'use strict';this.version=i;this.pageletName=j;this.pageletRootID=k;this.tagSuggestionMode=m;this.bufferSize=h.BUFFER_SIZE;this.fullBucketSize=h.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.usesOpaqueCursor=false;this.usesNonCircularPhotoSet=false;this.reachedLeftEnd=false;this.reachedRightEnd=false;this.leftLock=false;this.rightLock=false;this.useAjaxPipe=true;this.logger=l;this.viewAsUser=null;this.reset();};h.prototype.setViewAs=function(i){'use strict';this.viewAsUser=i;};h.prototype.isInViewAsMode=function(){'use strict';return !!this.viewAsUser;};h.prototype.getViewAsUserId=function(){'use strict';return this.viewAsUser;};h.prototype.getUsesOpaqueCursor=function(){'use strict';return this.usesOpaqueCursor;};h.prototype.isNonCircularPhotoSet=function(){'use strict';return this.usesNonCircularPhotoSet;};h.prototype.setReachedLeftEnd=function(){'use strict';this.reachedLeftEnd=true;};h.prototype.setReachedRightEnd=function(){'use strict';this.reachedRightEnd=true;};h.prototype.hasReachedLeftEnd=function(){'use strict';return this.reachedLeftEnd;};h.prototype.hasReachedRightEnd=function(){'use strict';return this.reachedRightEnd;};h.prototype.nonCircularPhotoSetCanPage=function(i){'use strict';if(!this.isNonCircularPhotoSet())return true;if(i<0)return this.getCursorPos()||!this.hasReachedLeftEnd();if(i>0)return this.getLength()-1!=this.getCursorPos()||!this.hasReachedRightEnd();return true;};h.prototype.setUseAjaxPipe=function(i){'use strict';this.useAjaxPipe=i;};h.prototype.reset=function(){'use strict';this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;this.firstOpaqueCursor=null;};h.prototype.waitForInitData=function(){'use strict';this.fbidList.push(h.INIT_PLACEHOLDER);};h.prototype.destroy=function(){'use strict';this.reset();this.isActive=false;};h.prototype.isLoaded=function(){'use strict';return this.loaded;};h.prototype.canPage=function(){'use strict';if(!this.isLoaded())return false;if(this.totalCount!==null)return this.totalCount>1;if(this.usesNonCircularPhotoSet)return true;return this.getLength()>1;};h.prototype.errorInCurrent=function(){'use strict';if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());};h.prototype.getLength=function(){'use strict';return this.fbidList.length;};h.prototype.getPhotoSet=function(){'use strict';return this.photoSetQuery.set;};h.prototype.getPhotoSetQuery=function(){'use strict';return this.photoSetQuery;};h.prototype.getCurrentImageData=function(){'use strict';return this.getImageData(this.getCursor());};h.prototype.addViewAsToURI=function(i){'use strict';var j=new (c('URI'))(i);if(this.isInViewAsMode())j.addQueryData({viewas:this.getViewAsUserId()});return j;};h.prototype.getOpaqueCursor=function(i){'use strict';if(this.getImageData(i)){if(this.version===c('PhotosConst').VIEWER_VAULTBOX)return this.getImageData(i).getInfo().opaquecursor;return this.getImageData(i).info.opaquecursor;}if(i==this.firstCursor)return this.firstOpaqueCursor;return null;};h.prototype.getImageData=function(i){'use strict';var j=this.getCacheContent(i,h.IMAGE_DATA);if(j)j.info.permalink=this.addViewAsToURI(j.info.permalink);return j;};h.prototype.getCurrentHtml=function(){'use strict';return this.getCacheContent(this.getCursor(),h.HTML);};h.prototype.getCurrentExtraData=function(){'use strict';return this.getCacheContent(this.getCursor(),h.EXTRA);};h.prototype.getCacheContent=function(i,j){'use strict';if(!i||i===h.ERROR_ID||i===h.INIT_PLACEHOLDER)return null;return this.cache[j][i];};h.prototype.getCursorPos=function(){'use strict';return this.position;};h.prototype.getCursor=function(){'use strict';if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;};h.prototype.getCursorAt=function(i){'use strict';return this.fbidList[i];};h.prototype.getCursorForURI=function(i){'use strict';return this.permalinkMap[i];};h.prototype.calculatePositionForMovement=function(i){'use strict';var j=this.position+i;if(this.allLoaded){var k=this.getLength();j=(k+j%k)%k;}return j;};h.prototype.isValidMovement=function(i){'use strict';if(!this.isLoaded()||!this.canPage())return false;var j=this.calculatePositionForMovement(i);return this.getCursor()>0||j>=0&&j<this.getLength();};h.prototype.moveCursor=function(i){'use strict';if(!this.isValidMovement(i))return;this.position=this.calculatePositionForMovement(i);if(i!==0)this.loadMoreIfNeccessary(i>0);};h.prototype.checkErrorAt=function(i){'use strict';if(!this.isLoaded())return false;if(i===h.ERROR_ID)return true;return false;};h.prototype.getRelativeMovement=function(i){'use strict';for(var j=0;j<this.getLength();j++)if(this.fbidList[j]==i)return j-this.position;return null;};h.prototype.preloadImages=function(i){'use strict';var j,k,l=this.getLength(),m=this.cache.image,n=h.BUFFER_SIZE;if(l>n*2){j=(this.position+l-n%l)%l;k=(this.position+n)%l;}else{j=0;k=l-1;}while(j!=k){var o,p=this.fbidList[j],q=i&&i(m[p]);if(this.version===c('PhotosConst').VIEWER_VAULTBOX){o=m[p]&&m[p].preload(q);}else if(m[p]&&m[p].url)if(q&&!m[p].resource){m[p].resource=new Image();m[p].resource.src=m[p].url;o=m[p].url;if(m[p].everstoreLogThis===true)c('PhotoEverstoreLogger').logImmediately(m[p].resource.src);}else if(!q&&!m[p].small){m[p].small=new Image();m[p].small.src=m[p].smallurl||m[p].url;o=m[p].small.src;if(m[p].everstoreLogThis===true)c('PhotoEverstoreLogger').logImmediately(m[p].small.src);}if(this.logger&&o)this.logger.log(o);j=(j+1)%l;}};h.prototype.loadMoreIfNeccessary=function(i){'use strict';if(this.allLoaded||i&&this.rightLock||!i&&this.leftLock)return;var j=i?1:-1,k=this.position+this.bufferSize*j;if(k<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(k>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}};h.prototype.getEndCursor=function(i){'use strict';return i?this.fbidList[this.getLength()-1]:this.fbidList[0];};h.prototype.calculateRelativeIndex=function(i,j,k){'use strict';if(!this.totalCount)return null;var l=this.fbidList.indexOf(j),m=this.fbidList.indexOf(k);if(l===-1||m===-1)return null;var n=m-l;return (i+n+this.totalCount)%this.totalCount;};h.prototype.calculateDistance=function(i,j){'use strict';var k=this.fbidList.indexOf(i),l=this.fbidList.indexOf(j);if(k===-1||l===-1)return null;return (l-k+this.getLength())%this.getLength();};h.prototype.fetch=function(i,j){'use strict';var k=this.getEndCursor(j),l=babelHelpers['extends']({cursor:k,version:this.version,end:this.getEndCursor(!j),fetchSize:j?i:-1*i,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(k),tagSuggestionMode:this.tagSuggestionMode},this.photoSetQuery);if(this.isInViewAsMode())l.viewas=this.getViewAsUserId();if(this.totalCount&&this.firstCursorIndex!==null){l.total=this.totalCount;l.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,k);}var m=c('ge')(this.pageletRootID);if(!m){m=c('DOM').create('div',{id:this.pageletRootID});c('DOM').appendContent(document.body,m);}c('UIPagelet').loadFromEndpoint(this.pageletName,m,l,{usePipe:this.useAjaxPipe,automatic:true,jsNonblock:true,crossPage:true});if(!this.useAjaxPipe)this.setUseAjaxPipe(true);};h.prototype.storeToCache=function(i){'use strict';var j={};if(!this.isActive)return j;if('error' in i){this.processErrorResult(i.error);j.error=true;return j;}if('init' in i){this.processInitResult(i.init);j.init={logids:i.init.logids,fbid:i.init.fbid,loggedin:i.init.loggedin,fromad:i.init.fromad,withinbusiness:i.init.withinbusiness,eid:i.init.eid};}if('image' in i){this.processImageResult(i.image);j.image=true;}if('data' in i){this.processDataResult(i.data);j.data=true;}return j;};h.prototype.processInitResult=function(i){'use strict';if(this.loaded)return;this.usesOpaqueCursor=i.usesopaquecursor;this.usesNonCircularPhotoSet=i.isnoncircularphotoset;this.loaded=true;this.photoSetQuery=i.query;if(i.bufferSize)this.bufferSize=i.bufferSize;if(i.fullBucketSize)this.fullBucketSize=i.fullBucketSize;if(this.fbidList.length===0){this.fbidList.push(i.fbid);this.rightLock=true;}else{var j=this.fbidList.indexOf(h.INIT_PLACEHOLDER);if(j!=-1)this.fbidList[j]=i.fbid;}this.firstCursor=i.fbid;this.firstOpaqueCursor=i.opaquecursor;if('initIndex' in i&&'totalCount' in i){this.firstCursorIndex=i.initIndex;this.totalCount=i.totalCount;}if(this.version==c('PhotosConst').VIEWER_PERMALINK){var k=i.initialBucketSize?i.initialBucketSize:h.INIT_BUCKET_SIZE;this.fetch(k,true);}};h.prototype.processImageResult=function(i){'use strict';for(var j in i){if(j===this.firstCursor&&i[j].everstoreLogThis)c('PhotoEverstoreLogger').logImmediately(i[j].url);if(this.version===c('PhotosConst').VIEWER_VAULTBOX){var k=i[j];this.cache.image[j]=new (c('PhotoViewerImage'))(k);this.permalinkMap[this.cache.image[j].getURIString()]=j;}else{this.cache.image[j]=i[j];if(i[j].dimensions)this.cache.image[j].dimensions=c('Vector').deserialize(i[j].dimensions);if(i[j].originalDimensions)this.cache.image[j].originalDimensions=c('Vector').deserialize(i[j].originalDimensions);if(i[j].smalldims)this.cache.image[j].smalldims=c('Vector').deserialize(i[j].smalldims);this.permalinkMap[new (c('URI'))(i[j].info.permalink).getUnqualifiedURI().toString()]=j;}}};h.prototype.attachToFbidsList=function(i,j,k){'use strict';if(this.allLoaded)return;if(j===-1){for(var l=i.length-1;l>=0;l--){this.fbidList.unshift(i[l]);this.position++;}this.leftLock=false;}else{for(var m=0;m<i.length;m++)this.fbidList.push(i[m]);this.rightLock=false;}if(k)this.setAllLoaded();};h.prototype.setAllLoaded=function(){'use strict';this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);};h.prototype.processDataResult=function(i){'use strict';for(var j in i){if(!this.cache.html[j])this.cache.html[j]={};for(var k in i[j].html){var l=i[j].html[k];if(typeof l==='string')l=c('HTML')(l).getRootNode();if(l.childNodes){this.cache.html[j][k]=Array.from(l.childNodes);}else this.cache.html[j][k]=[];}if(!('extra' in i[j])){this.cache.extra[j]=null;continue;}this.cache.extra[j]={tagRects:{}};if(!Array.isArray(i[j].extra.tagRects))for(var m in i[j].extra.tagRects)if(i[j].extra.tagRects[m])this.cache.extra[j].tagRects[m]=c('Rect').deserialize(i[j].extra.tagRects[m]);Object.keys(i[j].extra).forEach(function(n){if(n=='tagRects')return;this.cache.extra[j][n]=i[j].extra[n];}.bind(this));}};h.prototype.processErrorResult=function(i){'use strict';if(!this.isLoaded()){this.initError=true;return;}var j=i.side,k=[h.ERROR_ID];this.attachToFbidsList(k,j);};h.prototype.setTotalCount=function(i){'use strict';this.totalCount=i;};h.prototype.setFirstCursorIndex=function(i){'use strict';this.firstCursorIndex=i;};Object.assign(h,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});f.exports=h;},null);
__d("XPhotosetSearchPivotController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/search-pivot\/photoset\/",{fbid:{type:"Int",required:true},tags:{type:"IntToIntMap"}});},null);
__d('PhotosetSearchPivotData',['Promise','AsyncRequest','PhotoStreamCache','XPhotosetSearchPivotController'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=/^(perm:)?tag:(\d+)/,i={},j={fetch:function(k,l){if(!(k in i)){var m=c('XPhotosetSearchPivotController').getURIBuilder().setInt('fbid',k);if(l){var n={};l.fbidList.forEach(function(o){var p=l.getCacheContent(o,c('PhotoStreamCache').EXTRA);if(p)Object.keys(p.tagRects).forEach(function(q){if(h.test(q)){var r=RegExp.$2;if(r in n){n[r]++;}else n[r]=1;}});});m.setIntToIntMap('tags',n);}i[k]=new (c('Promise'))(function(o,p){new (c('AsyncRequest'))().setURI(m.getURI()).setHandler(function(q){o(q.getPayload());}).setErrorHandler(p).setAllowCrossPageTransition(true).send();});}return i[k]['catch'](function(o){delete i[k];throw o;});}};f.exports=j;},null);
__d('ObjectionableContentFilterTypedLogger',['Banzai','GeneratedLoggerUtils','nullthrows'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(){this.clear();}h.prototype.log=function(){c('GeneratedLoggerUtils').log('logger:ObjectionableContentFilterLoggerConfig',this.$ObjectionableContentFilterTypedLogger1,c('Banzai').BASIC);};h.prototype.logVital=function(){c('GeneratedLoggerUtils').log('logger:ObjectionableContentFilterLoggerConfig',this.$ObjectionableContentFilterTypedLogger1,c('Banzai').VITAL);};h.prototype.clear=function(){this.$ObjectionableContentFilterTypedLogger1={};return this;};h.prototype.updateData=function(j){this.$ObjectionableContentFilterTypedLogger1=babelHelpers['extends']({},this.$ObjectionableContentFilterTypedLogger1,j);return this;};h.prototype.setContentID=function(j){this.$ObjectionableContentFilterTypedLogger1.content_id=j;return this;};h.prototype.setEvent=function(j){this.$ObjectionableContentFilterTypedLogger1.event=j;return this;};h.prototype.setVC=function(j){this.$ObjectionableContentFilterTypedLogger1.vc=j;return this;};h.prototype.updateExtraData=function(j){j=c('nullthrows')(c('GeneratedLoggerUtils').serializeMap(j));c('GeneratedLoggerUtils').checkExtraDataFieldNames(j,i);this.$ObjectionableContentFilterTypedLogger1=babelHelpers['extends']({},this.$ObjectionableContentFilterTypedLogger1,j);return this;};h.prototype.addToExtraData=function(j,k){var l={};l[j]=k;return this.updateExtraData(l);};var i={content_id:true,event:true,vc:true};f.exports=h;},null);
__d('PhotoLogger',['Event','BanzaiScuba','SpotlightViewerLoggingEvents','SubscriptionsHandler'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){'use strict';this.$PhotoLogger1=i;this.$PhotoLogger2={};}h.prototype.log=function(i){'use strict';if(!this.$PhotoLogger2[i]){this.$PhotoLogger3(i);this.$PhotoLogger2[i]=true;}};h.prototype.$PhotoLogger3=function(i){'use strict';this.$PhotoLogger4(c('SpotlightViewerLoggingEvents').LOADING,{uri:i});var j=new (c('SubscriptionsHandler'))(),k=new Image();j.addSubscriptions(c('Event').listen(k,'load',function(){this.$PhotoLogger4(c('SpotlightViewerLoggingEvents').LOADED,{uri:i});j.release();}.bind(this)),c('Event').listen(k,'error',function(){this.$PhotoLogger4(c('SpotlightViewerLoggingEvents').ERROR,{uri:i});j.release();}.bind(this)),c('Event').listen(k,'abort',function(){this.$PhotoLogger4(c('SpotlightViewerLoggingEvents').ABORT,{uri:i});j.release();}.bind(this)));k.src=i;};h.prototype.logEvent=function(i){'use strict';this.$PhotoLogger4(i);};h.prototype.$PhotoLogger4=function(i,j){'use strict';var k=new (c('BanzaiScuba'))('photos_client_loading',null,{addBrowserFields:true});k.addNormal('event',i);k.addNormal('viewer',this.$PhotoLogger1);for(var l in j)k.addNormal(l,j[l]);k.post();};f.exports=h;},null);
__d('PhotoSessionLog',['AsyncRequest','Run','URI','Vector'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){}Object.assign(h,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,SNOWDOWN:13,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,source:null,buttonLikes:0,pagingAction:'',cycle:false,endOfRelevant:false,relevantCount:0,initLogging:function(i){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.eid='';this.version=i;this.buttonLikes=0;this.pagingAction='';this.cycle=false;this.endOfRelevant=false;this.relevantCount=0;this.panoramaClicks=0;this.panoramaImpressions=0;if(i===h.SNOWLIFT){var j=c('Vector').getViewportDimensions();this.width=j.x;this.height=j.y;}},setLogFbids:function(i){this.logIds=i;},setEid:function(i){this.eid=i;},setPhotoSet:function(i){this.set=i;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(i){this.pagingAction=i;},setCycle:function(i){this.cycle=i;},setEndOfRelevant:function(i){this.endOfRelevant=i;},setRelevantCount:function(i){this.relevantCount=i;},setEndMetrics:function(i){this.endMetrics=i;},setSource:function(i){this.source=i;},addPanoramaClick:function(){this.panoramaClicks++;},addPanoramaImpression:function(){this.panoramaImpressions++;},addPhotoView:function(i,j,k){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(i)this.fbidList.push([i.fbid,i.owner,Date.now()]);if(j)this.hiResLoads++;if(k)this.fullScreenViews[i.fbid]=true;},logEnterFullScreen:function(i){this.fullScreenViews[i]=true;},addDetailData:function(i,j){if(!this.details[i])this.details[i]={t:j.num_tags,l:j.has_location,c:j.has_caption,cm:j.comment_count,lk:j.like_count,w:j.width,h:j.height,ad:'{}',p:this.pagingAction};},updateAdData:function(i,j){if(this.details[i])this.details[i].ad=JSON.stringify(j);},logPhotoViews:function(i){if(!this.views)return;if(i!=this.AGGREGATE)this.last=true;var j={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},eid:this.eid,first:this.first,last:this.last,close:i?i:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source,panorama_clicks:this.panoramaClicks,panorama_impressions:this.panoramaImpressions};if(this.version===h.SNOWLIFT){var k=c('Vector').getViewportDimensions();j.width=k.x||this.width;j.height=k.y||this.height;if(this.hiResLoads>0)j.hires_loads=this.hiResLoads;if(this.last){var l=Object.keys(this.fullScreenViews).length;if(l>0)j.fullscreen=l;}}var m=new (c('URI'))('/ajax/photos/logging/session_logging.php').setSubdomain('www');new (c('AsyncRequest'))().setAllowCrossPageTransition(true).setURI(m).setOption('asynchronous_DEPRECATED',i!=h.UNLOAD).setOption('suppressErrorHandlerWarning',true).setData(j).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});c('Run').onUnload(function(){h.logPhotoViews(h.UNLOAD);});c('Run').onLeave(function(){h.logPhotoViews(h.LEAVE);});f.exports=h;},null);
__d('PhotosUtils',['Vector'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){}Object.assign(h,{getNearestBox:function(i,j){var k=Infinity,l=null;for(var m in i){var n=i[m];if(n.contains(j)){var o=j.distanceTo(n.getCenter());if(o<k){k=o;l=m;}}}return l;},absoluteToNormalizedPosition:function(i,j){var k=c('Vector').getElementPosition(i),l=c('Vector').getElementDimensions(i),m=j.sub(k).mul(100/l.x,100/l.y);m.domain='pure';return m;},normalizedToAbsolutePosition:function(i,j){var k=c('Vector').getElementPosition(i),l=c('Vector').getElementDimensions(i),m=j.mul(l.x/100,l.y/100).add(k);m.domain='document';return m;},isFacebox:function(i){return i.match(/^face:/);},isTag:function(i){return i.match(/^tag:/);}});f.exports=h;},null);
__d('PhotoPermalinkURI',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isValid:function(i){return h.parse(i)!==null;},parse:function(i){if(this.isValidLegacy(i)){var j=i.getQueryData();if(j.fbid)return {photo_id:j.fbid,set_token:j.set};if(j.id&&j.pid)return {photo_id:j.id+':'+j.pid,set_token:j.set};return null;}var k=i.getPath();if(k[k.length-1]==='/')k=k.substring(0,k.length-1);var l=k.split('/');if(l.length>=3&&l[2]==='photos')if(l.length===4&&/^\d+$/.exec(l[3])!==null){return {photo_id:l[3],set_token:null};}else if(l.length===5&&/^\d+$/.exec(l[4])!==null)return {photo_id:l[4],set_token:l[3]};return null;},isValidLegacy:function(i){var j=i.getPath();if(j[j.length-1]==='/')j=j.substring(0,j.length-1);if(j==='/photo.php'||j==='/force_photo/photo.php'||j==='/photo'||j==='/force_photo/photo/index.php'||j==='/photo/index.php'||j==='/force_photo/photo'||j==='/video.php'||j==='/video/video.php')return true;return false;}};f.exports=h;},null);
__d('VideoPermalinkURI',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isValid:function(i){return h.parse(i)!==null;},parse:function(i){if(this.isValidLegacy(i)){var j=i.getQueryData();if(j.v)return {video_id:j.v,set_token:j.set};return null;}var k=i.getPath();if(k[k.length-1]==='/')k=k.substring(0,k.length-1);var l=k.split('/');if(l.length>=3&&l[2]==='videos')if(l.length===4&&/^\d+$/.exec(l[3])!==null){return {video_id:l[3],set_token:null};}else if(l.length===5&&/^\d+$/.exec(l[4])!==null)return {video_id:l[4],set_token:l[3]};return null;},isValidLegacy:function(i){var j=i.getPath();if(j[j.length-1]==='/')j=j.substring(0,j.length-1);if(j==='/photo.php'||j==='/force_photo/photo.php'||j==='/photo'||j==='/force_photo/photo/index.php'||j==='/photo/index.php'||j==='/force_photo/photo'||j==='/video.php'||j==='/video/video.php')return true;return false;}};f.exports=h;},null);
__d('PhotoTagSearchPivotLogger',['Banzai'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};c('Banzai').subscribe(c('Banzai').SHUTDOWN,function(){Object.keys(h).forEach(function(l){var m=h[l];Object.keys(m).forEach(function(n){c('Banzai').post('photo_tag_search_pivot',{source:l,action:n,count:m[n]});});});});var i=/^(perm:)?tag:/,j,k={logImpression:function(l,m){var n=l in h?h[l]:h[l]={};n[m]=m in n?n[m]+1:1;},logImageImpression:function(l,m,n){if(j!==m){if(n.some(function(o){return i.test(o);}))this.logImpression(l,'image_impression');j=m;}},logPivotImpression:function(l,m){if(i.test(m))this.logImpression(l,'pivot_impression');},logShowMorePhotos:function(){this.logImpression('photoset','show_more_photos');},logHideMorePhotos:function(){this.logImpression('photoset','hide_more_photos');},logSuggestMorePhotos:function(){this.logImpression('photoset','suggest_more_photos');},logMorePhotosNavigation:function(l){c('Banzai').post('photo_tag_search_pivot',{source:'photoset',action:'more_photos_search',query:l,count:1});}};f.exports=k;},null);
__d('PhotosetSearchPivot.react',['cx','fbt','LeftRight.react','PhotoTagSearchPivotLogger','PhotosetSearchPivotData','React','XUISpinner.react','XUIText.react','joinClasses'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'PhotosetSearchPivotItem',propTypes:{normalized:j.string,title:j.object,uri:j.string,images:j.array},onClick:function(){c('PhotoTagSearchPivotLogger').logMorePhotosNavigation(this.props.normalized);},render:function(){return (c('React').createElement('div',{className:"_25r"},c('React').createElement('a',{onClick:this.onClick,href:this.props.uri,className:"_25t _3-8t"},c('React').createElement('div',{className:"_25u"},c('React').createElement('div',{className:"_25v _25w",style:{backgroundImage:'url('+this.props.images[0].uri+')'}}),c('React').createElement('div',{className:"_25x"},c('React').createElement('div',{className:"_25y"},c('React').createElement('div',{className:"_25z"}),c('React').createElement('div',{className:"_26r"},c('React').createElement('div',{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[1].uri+')'}}))),c('React').createElement('div',{className:"_274"},c('React').createElement('div',{className:"_25z"}),c('React').createElement('div',{className:"_26r"},c('React').createElement('div',{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[2].uri+')'}}))))),c('React').createElement(c('XUIText.react'),{display:'block',className:"_27f _2pi4",dangerouslySetInnerHTML:{__html:this.props.title.__html}}))));}}),l=c('React').createClass({displayName:'PhotosetSearchPivot',propTypes:{fbid:j.string,endofalbum:j.bool,withBackground:j.bool,linesAroundHeader:j.bool,onclose:j.func},fetchPivots:function(m){c('PhotosetSearchPivotData').fetch(m).then(function(n){setTimeout(this.onFetchSuccess.bind(this,m,n.pivots),0);}.bind(this),function(n){setTimeout(this.onFetchError.bind(this,m),0);}.bind(this));},onFetchSuccess:function(m,n){if(!this.isMounted()||this.props.fbid!==m)return;n=n||[];var o='show';if(n.length===0)o='hide';this.setState({pivots:n,action:o});},onFetchError:function(m){if(!this.isMounted()||this.props.fbid!==m)return;this.setState({pivots:[],action:'hide'});},getInitialState:function(){this.fetchPivots(this.props.fbid);return {pivots:[],action:'loading'};},componentWillReceiveProps:function(m){if(m.fbid){this.setState({action:'loading'});this.fetchPivots(m.fbid);}else this.setState({action:'hide',pivots:[]});},onExitClicked:function(){this.props.onclose();},render:function(){if(this.state.action==='loading')return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,"_27h _2ph_")},c('React').createElement(c('XUISpinner.react'),{size:'large'})));if(this.state.action==='hide')return c('React').createElement('span',null);var m=this.state.pivots.map(function(q){return (c('React').createElement(k,{normalized:q.normalized,title:q.title,uri:q.uri,images:q.images}));}),n=this.props.endofalbum?c('React').createElement('span',{className:"_2pij"},i._("Fin del \u00e1lbum")):null,o="_27m"+(' '+"_2pi3")+(' '+"_2pib")+(this.props.linesAroundHeader?' '+"_3-te":''),p=c('React').createElement('span',null,n,c('React').createElement('span',{className:"_4ptz"},i._("Otras fotos que te podr\u00edan gustar")));if(this.props.onclose){p=c('React').createElement(c('LeftRight.react'),{className:o},p,c('React').createElement('a',{href:'#',onClick:this.onExitClicked,className:"_27n"}));}else p=c('React').createElement('div',{className:o},p);return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,(this.state.action==='hide'?"_27j":'')+(this.state.action==='show'?' '+"_27k":''))},c('React').createElement('div',{className:"_27l"+(this.props.withBackground?' '+"_3-tf":'')},p,c('React').createElement('div',{className:"_27o _2pi8 clearfix"},m))));}});f.exports=l;},null);
__d('PhotosetPivotSlide.react',['cx','fbt','xuiglyph','Image.react','Link.react','PhotosetSearchPivot.react','React','XUIText.react'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=c('React').createClass({displayName:'PhotosetPivotSlide',propTypes:{fbid:k.string,isAlbum:k.bool,albumOwnerName:k.string,visible:k.bool,onReturn:k.func},render:function(){return (c('React').createElement('div',{className:"_1_ap"+(this.props.visible?' '+"_1_aq":'')},c('React').createElement('div',{className:"_1_ar"},c('React').createElement(c('XUIText.react'),{display:'block'},this._getEndOfAlbumTitle()),c('React').createElement(c('Link.react'),{className:"_1_as",onClick:this.props.onReturn},c('React').createElement(c('Image.react'),{className:"_1_at",src:j({name:'arrow-right',shade:'white',size:'small'})}),i._("Volver al principio"))),c('React').createElement(c('PhotosetSearchPivot.react'),{className:"_1_au",fbid:this.props.visible?this.props.fbid:null,linesAroundHeader:true})));},_getEndOfAlbumTitle:function(){if(this.props.albumOwnerName){if(this.props.isAlbum){return i._("Fin del \u00e1lbum de {user_name}",[i.param('user_name',c('React').createElement(c('XUIText.react'),{weight:'bold'},this.props.albumOwnerName))]);}else return i._("Fin de las fotos de {user_name}",[i.param('user_name',c('React').createElement(c('XUIText.react'),{weight:'bold'},this.props.albumOwnerName))]);}else if(this.props.isAlbum){return i._("Fin del \u00e1lbum");}else return i._("Fin de las fotos");}});f.exports=l;},null);
__d('PhotoSnowliftAds',['csx','Arbiter','Event','CSS','DataStore','DOM','PhotoSessionLog','UIPagelet','URI','Vector'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,position:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(j,k){if(k)this.adsStatus=j;var l=Date.now();this.adsEvents[j+'_'+l]=l;},init:function(j,k,l,m){this.reset();this.root=j;this.snowlift=k;this.minAds=l.min_ads;this.displayedCallback=m;this.addEvent('init',true);},reset:function(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(j){this.availableDimensions=j;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(j,k,l){var m={};j.forEach(function(n){var o=n.root.firstChild.offsetHeight;n.units.forEach(function(q){if(!c('CSS').hasClass(q,'hidden')&&!this.getIsHoldout(q)&&!this.getIsShadow(q)){var r=this.getHeight(q.firstChild,k);o-=r;}}.bind(this));var p={height:o,visible:false};n.units.forEach(function(q){var r=this.getIsAds(q),s=this.getHeight(q.firstChild,k),t=this.getUnitId(q),u=this.getIsHoldout(q);if(u&&l)return;m[t]={height:s,visible:false,priority:0,is_ads:r,is_holdout:u,section_ref:p};}.bind(this));}.bind(this));return m;},calculateVisibleUnits:function(j,k,l){var m=0,n=this.getUnitPriority(k);n.forEach(function(o){if(k.hasOwnProperty(o)){var p=k[o],q=p.height;if(!p.section_ref.visible)q+=p.section_ref.height;p.height_below=l-q;p.visible=p.height_below>=0&&q>0;if(p.visible){p.section_ref.visible=true;l-=q;m++;}}}.bind(this));return k;},displayUnits:function(j,k){j.forEach(function(l){var m=false,n=true;l.units.forEach(function(o){var p=this.getUnitId(o),q=k[p];if(!q)return;var r=q.visible,s=q.height_below,t=q.is_ads;c('CSS').conditionClass(o,'hidden',!r);if(t&&r&&n){var u=c('DOM').find(o,'div.ego_unit');c('CSS').addClass(u,'ego_unit_no_top_border');n=false;}m=m||r;this.calcUnitStats(this.units[t][p],r,s);}.bind(this));c('CSS').conditionClass(l.root,'hidden',!m);}.bind(this));c('Arbiter').inform('PhotoSnowliftAds/displayUnits');},getUnitsDisplayed:function(j,k){var l=0;j.forEach(function(m){m.units.forEach(function(n){var o=this.getUnitId(n),p=k[o];if(!p||!p.visible)return;l++;}.bind(this));}.bind(this));return l;},getHeightsRequired:function(j,k){var l=0,m=[];j.forEach(function(n){var o=false;n.units.forEach(function(p){var q=this.getUnitId(p),r=k[q];if(!r)return;l+=r.height;if(!o){l+=r.section_ref.height;o=true;}m.push(l);}.bind(this));}.bind(this));return m;},getUnitPriority:function(j){var k=[],l=0,m=0;for(var n in j){var o=j[n];k.push(n);var p=this.minAds+l+m;if(o.is_ads){if(m<this.minAds)p=m;m++;}else l++;o.priority=p;}k=k.sort(function(q,r){var s=j[q],t=j[r];return s.priority-t.priority;}.bind(this));return k;},updateUnitsStatus:function(){var j=this.availableDimensions.x,k=this.availableDimensions.y,l=this.calculateUnitSizes(this.sections,j);l=this.calculateVisibleUnits(this.sections,l,k);for(var m in l){if(!l.hasOwnProperty(m))continue;var n=l[m];if(!n.is_holdout||!n.visible)continue;var o=this.units[1][m];this.calcUnitStats(o,n.visible,n.height_below);}l=this.calculateUnitSizes(this.sections,j,true);l=this.calculateVisibleUnits(this.sections,l,k);this.displayUnits(this.sections,l);if(this.displayedCallback){var p=this.getUnitsDisplayed(this.sections,l),q=this.getHeightsRequired(this.sections,l);this.displayedCallback(p,q);}},calcUnitStats:function(j,k,l){var m=Date.now();if(j.visible)j.totalTime+=m-j.lastShowTime;if(j.trackingCode!==null&&j.totalTime>=this.UNITS_REGISTER_DELAY){var n=j.trackingCode;j.trackingCode=null;this.registerImpression(n,j.registerUrl);}j.visible=k;j.heightBelow=l;j.lastShowTime=m;},prepareResize:function(){var j=function(k){var l=c('DOM').create('div',{className:'inner'}),m=c('DOM').create('div',{className:'wrapper'},l);c('DOM').replace(k,m);c('DOM').setContent(l,k);return m;};this.sections=c('DOM').scry(this.root,'div.ego_section').map(function(k){return {root:j(k),units:c('DOM').scry(k,'div.ego_unit').map(j)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var j=this.nextRegisterTime();if(j!==Infinity)setTimeout(this.processResize.bind(this),j);},setIsLogAdData:function(j){this.isLogAdData=j;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var j=this.snowlift.getImageId();if(this.isLogAdData&&j){var k=c('Vector').getElementDimensions(this.snowlift.getImage()),l=c('Vector').getElementDimensions(this.snowlift.getRHCHeader()),m=c('Vector').getElementDimensions(this.snowlift.getRHCBody()),n=c('Vector').getElementDimensions(this.snowlift.getRHCFooter()),o={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:k.x,image_y:k.y,header_x:l.x,header_y:l.y,body_x:m.x,body_y:m.y,footer_x:n.x,footer_y:n.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};c('PhotoSessionLog').updateAdData(j,o);}},getAdsBelowSpace:function(){var j=[],k=this.units[1];for(var l in k)if(k.hasOwnProperty(l)&&!this.getIsHoldout(this.getAdUnit(l)))j.push(k[l].heightBelow);return j;},getIsAds:function(j){var k=c('DOM').scry(j,"div._4u8");return k.length;},getUnitId:function(j){if(this.getIsAds(j)){return this.getAdId(j);}else return this.getEgoId(j);},getEgoId:function(j){var k=c('DOM').find(j,'div.ego_unit');return k.getAttribute('data-ego-fbid');},getAdData:function(j){var k=c('DOM').find(j,"div._4u8"),l=k.getAttribute('data-ad');return l&&JSON.parse(l)||{};},getAdId:function(j){return this.getAdData(j).adid;},getIsHoldout:function(j){return j&&this.getIsAds(j)&&this.getAdData(j).holdout;},getIsShadow:function(j){return j&&this.getIsAds(j)&&this.getAdData(j).shadow;},getAdUnit:function(j){if(!this.sections)return null;var k=[];this.sections.forEach(function(m){k.push.apply(k,m.units);});for(var l=0;l<k.length;l++)if(this.getIsAds(k[l])&&this.getAdId(k[l])==j)return k[l];return null;},nextRegisterTime:function(){var j=Infinity,k=babelHelpers['extends']({},this.units[0],this.units[1]);for(var l in k)if(k.hasOwnProperty(l)){var m=k[l];if(m.trackingCode!==null&&m.visible)j=Math.min(j,this.UNITS_REGISTER_DELAY-m.totalTime);}return j;},getHeight:function(j,k){var l=c('DataStore').get(j,'height');if(l&&l.x===k)return l.y;return this.cacheHeight(j,k);},cacheHeight:function(j,k){var l={x:k,y:j.offsetHeight};c('DataStore').set(j,'height',l);return l.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);this.position++;var j=this.getCursorFBID(this.loadQuery);c('UIPagelet').loadFromEndpoint('WebEgoPane',this.root,{pid:34,data:[this.loadQuery.set,j,false,this.snowlift.getOpaqueCursor(j)]},{crossPage:true,bundle:false});},getCursorFBID:function(j){if(j.v!==undefined)return j.v;if(j.fbid!==undefined)return j.fbid;return '0';},unitsLoaded:function(j,k){var l;if(k){l='/ai.php';this.addEvent('adsLoaded',true);}else{l='/ajax/ei.php';this.addEvent('egoLoaded',true);}var m={};for(var n in j)if(j.hasOwnProperty(n))m[n]={trackingCode:j[n],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:l};this.units[k]=m;if(k)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();c('CSS').removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var j=Date.now()-this.lastLoadTime;if(!this.isLoading&&j>i.REFRESH_RATE){c('CSS').addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(j,k){var l=c('DOM').create('iframe',{src:new (c('URI'))(k).addQueryData({aed:j}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});l.setAttribute('aria-hidden','true');c('DOM').appendContent(this.root,l);},waitForImages:function(j){var k=c('DOM').scry(this.root,'img.img'),l=k.length,m=l;if(m===0)j();var n=function(){m--;if(m===0)setTimeout(j,0);};for(var o=0;o<l;o++){var p=k[o];if(p.complete){n();}else c('Event').listen(p,{load:n,error:n,abort:n});}}};f.exports=i;},null);
__d('PhotoViewer',['Bootloader','CSS','DOM','emptyFunction'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';this.image=null;this.root=null;this.stream=null;}h.prototype.getEventString=function(i){'use strict';var j=this.getEventPrefix();if(j)return j+'.'+i;return null;};h.prototype.getImage=function(){'use strict';return this.image;};h.prototype.getPosition=function(){'use strict';return this.stream?this.stream.getCursor():null;};h.prototype.getRoot=function(){'use strict';return this.root;};h.prototype.hiliteAllBoxes=function(){'use strict';c('DOM').scry(this.stageWrapper,'div.tagsWrapper div.faceBox').forEach(function(i){c('CSS').addClass(i,'otherActive');});};h.bootstrap=function(i,j){'use strict';c('Bootloader').loadModules(["PhotoSnowlift"],function(k){k.bootstrap(i,j);});};Object.assign(h.prototype,{getEventPrefix:c('emptyFunction').thatReturnsNull,getSourceString:c('emptyFunction').thatReturnsNull,getVersionConst:c('emptyFunction').thatReturnsNull,getViewerSource:c('emptyFunction').thatReturnsNull,getViewerSet:c('emptyFunction').thatReturnsNull});f.exports=h;},null);
__d("XGraphicPhotoWarningLoggingController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/photos\/graphic_photo\/logging\/",{event:{type:"Enum",required:true,enumType:1}});},null);
__d('PhotoWarningScreen',['csx','cx','AsyncRequest','CSS','DOM','Event','PhotoWarningScreenConfig','ObjectionableContentFilterTypedLogger','XGraphicPhotoWarningLoggingController'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k){'use strict';if(k.footer){k.footer=c('DOM').insertAfter(k.rootElement,k.footer).pop();var l=c('DOM').scry(k.footer,"._1kmy").pop();if(l)c('Event').listen(l,'click',function(){c('CSS').hide(k.footer);c('CSS').show(k.warningOverlay);c('CSS').addClass(k.innerContent,"_1t6v");if(k.warningType===c('PhotoWarningScreenConfig').Types.OBJECTIONABLE)j.logObjectionable(c('PhotoWarningScreenConfig').ObjectionableEvents.WARNING_SCREEN_REENABLED,k.responsiblePhotos);});}c('Event').listen(k.seePhotoButton,'click',function(){c('CSS').hide(k.warningOverlay);if(k.footer)c('CSS').show(k.footer);c('CSS').removeClass(k.innerContent,"_1t6v");switch(k.warningType){case c('PhotoWarningScreenConfig').Types.GRAPHIC:j.logGraphic(c('PhotoWarningScreenConfig').GraphicEvents.GRAPHIC_PHOTO_WARNING_DISMISSED);break;case c('PhotoWarningScreenConfig').Types.OBJECTIONABLE:j.logObjectionable(c('PhotoWarningScreenConfig').ObjectionableEvents.WARNING_SCREEN_DISMISSED,k.responsiblePhotos);break;}});}j.logGraphic=function(event){var k=c('XGraphicPhotoWarningLoggingController').getURIBuilder().setEnum('event',event).getURI();new (c('AsyncRequest'))(k).setAllowCrossPageTransition(true).send();};j.logObjectionable=function(event,k){k.forEach(function(l){new (c('ObjectionableContentFilterTypedLogger'))().setEvent(event).setContentID(l).log();});};f.exports=j;},null);
__d('PhotoWarningScreenMixin',['csx','cx','CSS','DOM','emptyFunction'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('emptyFunction'),k={getGraphicWarningContainer:j,getGraphicWarningHiddenContent:j,_graphicWarningMarkup:null,_graphicWarningOverlay:null,_graphicWarningHiddenContentWrapper:null,initGraphicWarningDOM:function(l){this._graphicWarningMarkup=l;this._graphicWarningOverlay=c('DOM').scry(l,"._1t6w").pop();this._graphicWarningHiddenContentWrapper=c('DOM').scry(l,"._1t6x").pop();},showGraphicWarning:function(){this._graphicWarningOverlay&&c('CSS').show(this._graphicWarningOverlay);if(this.getGraphicWarningContainer().contains(this._graphicWarningMarkup))return;if(this._graphicWarningHiddenContentWrapper){this.getGraphicWarningContainer().replaceChild(this._graphicWarningMarkup,this.getGraphicWarningHiddenContent());c('CSS').addClass(this._graphicWarningHiddenContentWrapper,"_1t6v");this._graphicWarningHiddenContentWrapper.appendChild(this.getGraphicWarningHiddenContent());}},hideGraphicWarning:function(){if(!this.getGraphicWarningContainer().contains(this._graphicWarningMarkup))return;this.getGraphicWarningContainer().replaceChild(this.getGraphicWarningHiddenContent(),this._graphicWarningMarkup);}};f.exports=k;},null);
__d('PhotoSnowlift',['csx','cx','fbt','invariant','$','Arbiter','AsyncRequest','Bootloader','CSS','DataStore','Dialog','DOM','DOMControl','DOMQuery','EncryptedImg','Event','FullScreen','ImageUtils','Input','Keys','Layer','LayerHideOnEscape','LikeConfirmer','LinkController','LitestandShareAttachment','LitestandStoryInsertionStatus','Locale','PhotoWarningScreenConfig','PageTransitions','Parent','PhotoLogger','PhotoPermalinkURI','PhotosConst','PhotoSessionLog','PhotosetPivotSlide.react','PhotosetSearchPivot.react','PhotosetSearchPivotData','PhotoSnowliftActionsGating','PhotoSnowliftAds','PhotoStreamCache','PhotosUtils','PhotoTagSearchPivotLogger','PhotoViewer','PhotoWarningScreen','PhotoWarningScreenMixin','ReactComponentRenderer','Rect','ScriptPath','ScrollableArea','SnowliftVideoPivotsCarouselController','Style','Toggler','Tooltip','UFIFeedbackTargets','UFIRootRegistry','UFIUIEvents','UIPagelet','URI','UserAgent_DEPRECATED','Vector','VideoPermalinkURI','VideoPlayerAbortLoadingExperiment','VideoPlayerReason','arrayContains','classWithMixins','computeRelativeURI','emptyFunction','ge','getActiveElement','goURI','isNode','mixin','tickerPhoteSnowLiftOpenStatus','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k){var l,m;if(c.__markCompiled)c.__markCompiled();var n=c('PhotoWarningScreenConfig').GraphicEvents,o=74,p=75,q=70,r=76,s=315,t=new RegExp('\\/posts\\/(\\d+)\\/?$');l=babelHelpers.inherits(u,c('classWithMixins')(c('PhotoViewer'),c('mixin')(c('PhotoWarningScreenMixin'))));m=l&&l.prototype;function u(){'use strict';m.constructor.call(this);this._seenTags={};this._navCount=0;this._isZoomOn=false;this.clearAlbumBoundaries();}u.prototype.preload=function(v,w){'use strict';c('Bootloader').loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(x){this.PhotoTagger=x;}.bind(this));};u.prototype.bootstrap=function(v,w){'use strict';this.preload(v,w);this._href=v;this._elem=w;if(this.closeDirty){setTimeout(this.bootstrap.bind(this,v,w),0);return;}c('PhotoSnowliftAds').reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this._dataFt=null;var x=c('Parent').byAttribute(w,'data-cursor');if(x){try{var z=JSON.parse(x.getAttribute('data-ft'));this._dataFt={qid:z.qid,mf_story_key:z.mf_story_key};}catch(y){}}else try{x=c('Parent').byAttribute(w,'data-ad');var aa=JSON.parse(x.getAttribute('data-ad'));this._dataFt={ad_id:aa.adid};}catch(y){}c('ScriptPath').openOverlayView('snowlift');this.returningToStart=false;this.loading&&c('CSS').removeClass(this.loading,'loading');if(w){c('CSS').addClass(this.loading=w,'loading');var ba=c('Parent').byClass(w,'uiStreamStory')||c('Parent').bySelector(w,"._5jmm");if(ba){this.storyID=ba.id;}else{var ca=c('Parent').bySelector(w,"._5b9c");if(ca)this.storyID=ca.getAttribute('data-ownerid');}this._updateContainerOwnerID();this.getThumbAndSize(w);}else this.loading=null;c('Arbiter').inform('PhotoSnowlift.GO',v,c('Arbiter').BEHAVIOR_STATE);this.loadFrameIfUninitialized();this._setupNextItemUI();};u.prototype._updateContainerOwnerID=function(){'use strict';if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};u.prototype.setupFromSnowflake=function(v,w){'use strict';this.extraClasses=v;this.snowflake=true;this.firstInSet=w;if(this.root){c('CSS').addClass(this.root,"snowflake");this.extraClasses.forEach(function(x){c('CSS').addClass(this.root,x);},this);}};u.prototype.getCurrentImageServerSizeDimensions=function(){'use strict';var v=this.stream.getCurrentImageData();return v.originalDimensions||v.dimensions;};u.prototype.getEventPrefix=function(){'use strict';return 'PhotoSnowlift';};u.prototype.getRoot=function(){'use strict';return this.root;};u.prototype.getSourceString=function(){'use strict';return 'snowlift';};u.prototype.getViewerSource=function(){'use strict';return this.source;};u.prototype.getViewerSet=function(){'use strict';return this.stream.getPhotoSet();};u.prototype.getVersionConst=function(){'use strict';return c('PhotosConst').VIEWER_SNOWLIFT;};u.prototype.getImage=function(){'use strict';return this.image;};u.prototype.getImageId=function(){'use strict';return this.stream.getCursor();};u.prototype.getRHCHeader=function(){'use strict';return this.rhcHeader;};u.prototype.getRHCBody=function(){'use strict';return this.ufiForm;};u.prototype.getRHCFooter=function(){'use strict';return this.rhcFooter;};u.prototype.getLoadQuery=function(){'use strict';return this.loadQuery;};u.prototype.getCurrentPhotoInfo=function(){'use strict';var v=this.stream.getCurrentImageData();if(v)return v.info;return null;};u.prototype.getOwnerId=function(){'use strict';var v=this.stream.getCurrentImageData();if(v)return v.info.owner;return null;};u.prototype.getThumbAndSize=function(v){'use strict';this.currentImageSize=null;this.thumbSrc=null;var w=new (c('URI'))(v.getAttribute('ajaxify')).getQueryData();if(!w.size)return;var x=c('Vector').deserialize(w.size);if(!x.x||!x.y)return;this.currentImageSize=x;if(v.getAttribute('data-cropped'))return;var y=c('DOM').scry(v,'img')[0],z=c('DOM').scry(v,'i')[0],aa=c('Parent').byAttribute(v,'data-size');this.shouldStretch=aa&&this.currentImageSize&&y&&aa.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=u.TIMELINE_STRETCH_WIDTH&&y.offsetWidth===u.TIMELINE_STRETCH_WIDTH;var ba;if(y){ba=y.src;}else if(z){ba=c('Style').get(z,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=ba;};u.prototype.loadFrameIfUninitialized=function(){'use strict';if(this.root)return;new (c('AsyncRequest'))('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};u.prototype.init=function(v,w){'use strict';this.init=c('emptyFunction');this._shouldLog=w.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new (c('PhotoLogger'))(c('PhotosConst').VIEWER_SNOWLIFT_STRING);this._showHover=w.pivot_hover;this._showMorePhotos=w.show_more_photos;this._extraSlidePivot=w.extra_slide_pivot;c('PhotoSessionLog').setEndMetrics(w.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=c('FullScreen').isSupportedWithKeyboardInput();this.showOGVideos=w.og_videos;this.resizeCommentsForAds=w.resize_comments_for_ads;this._canSeeGraphicWarning=!!w.can_see_graphic_warning;this.initGraphicWarningDOM(w.graphic_warning_markup);this.spotlight=v;this.spotlight.subscribe('blur',function(){this.closingAction=c('PhotoSessionLog').OUTSIDE;}.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());c('PhotoSnowliftAds').init(this.sideAdUnit,this,w,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){c('LinkController').registerHandler(this.handleNavigateAway.bind(this));this.subscription=c('Arbiter').subscribe('PhotoSnowlift.GO',function(x,y){this.openExplicitly=true;this.loading&&c('CSS').removeClass(this.loading,'loading');this.open(y);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;c('PageTransitions').registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;c('Arbiter').subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));c('Arbiter').subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)c('FullScreen').subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=w.snowlift_slideshow;this.buttonTruncateGk=w.snowlift_button_truncate;this._hasZoomCapability=this._hasZoomCapability&&w.www_panorama_viewer;this.allowIrrelevantRequests=!!w.snowlift_allow_irrelevant_requests;if(this.snowflake){c('CSS').addClass(this.root,"snowflake");this.extraClasses.forEach(function(x){c('CSS').addClass(this.root,x);},this);}this._setupNextItemUI();};u.prototype.onFullScreenChange=function(){'use strict';if(!this.isOpen)return;var v=c('FullScreen').isFullScreen();c('CSS').conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',v);if(v){this.lastFullscreenEnter=Date.now();if(!c('CSS').hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var w=this.stream.getCurrentImageData();if(w&&w.url&&this.image.src!==w.url&&this.shouldShowHiRes(w))this.switchImage(w.url);this.adjustForResize();if(!this._isZoomOn)this._conditionDisplayZoomInButton();}else{if(!this._isZoomOn)this.uncollapseRHC();if(c('UserAgent_DEPRECATED').chrome()&&this.lastPage>this.lastFullscreenEnter&&!c('CSS').hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);c('Arbiter').inform('reflow');}c('Toggler').hide();};u.prototype.initializeNodes=function(v){'use strict';this.root=v;this.container=c('DOM').find(v,'div.fbPhotoSnowliftContainer');this._updateContainerOwnerID();this.snowliftPopup=c('DOM').find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=c('DOM').find(this.snowliftPopup,'div.rhc');this.rhcHeader=c('DOM').find(this.rhc,'div.rhcHeader');this.rhcFooter=c('DOM').find(this.rhc,'div.rhcFooter');this.taglist=c('DOM').find(this.rhc,'span.fbPhotoTagList');this.ufiForm=c('DOM').find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=c('DOM').find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=c('DOM').find(this.ufiForm,'div.rhcScroller');this.scrollerBody=c('DOM').find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=c('DOM').find(this.snowliftPopup,'div.stageWrapper');this.overlay=c('DOM').find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=c('DOM').find(this.stageWrapper,'div.stageError');this.image=c('DOM').find(this.stageWrapper,'img.spotlight');this.stage=c('DOM').find(this.stageWrapper,'div.stage');this.showZoomInButton=c('DOM').scry(this.stageWrapper,"._5qmg").pop();this.showZoomOutButton=c('DOM').scry(this.stageWrapper,"._5qmh").pop();this.zoomedImage=c('DOM').scry(this.stage,"._10zw").pop();this.outerImageSlider=c('DOM').scry(this.stage,"._10zx").pop();this.innerImageSlider=c('DOM').scry(this.stage,"._10zv").pop();this._hasZoomCapability=this.showZoomInButton&&this.showZoomOutButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider;if(this._hasZoomCapability){c('CSS').hide(this.showZoomInButton);c('CSS').hide(this.showZoomOutButton);c('CSS').hide(this.zoomedImage);c('CSS').hide(this.outerImageSlider);}this.videoStage=c('DOM').find(this.stageWrapper,'div.videoStage');this.prevPager=c('DOM').find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=c('DOM').find(this.snowliftPopup,'a.snowliftPager.next');this.upPager=c('DOM').find(this.container,'a.snowliftPager.up');this.downPager=c('DOM').find(this.container,'a.snowliftPager.down');this.stageActions=c('DOM').find(v,'div.stageActions');this.buttonActions=c('DOM').find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=c('DOM').find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=c('DOM').find(v,"._5ciw");c('CSS').conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};u.prototype.getGraphicWarningContainer=function(){'use strict';return this.stageWrapper;};u.prototype.getGraphicWarningHiddenContent=function(){'use strict';return this.stage;};u.prototype.initializeScroller=function(){'use strict';this.initializeScroller=c('emptyFunction');c('CSS').addClass(this.scroller,"_467y");this.scrollableArea=c('ScrollableArea').fromNative(this.scroller,{fade:true,persistent:true});var v=function(event){var w=c('Event').$E(event).getTarget();if(c('DOM').contains(this.ufiInputContainer,w)){var x=c('DOMControl').getInstance(w);if(x){this.scrollableArea.scrollToBottom();var y=x.subscribe('resize',function(){var aa=this.scrollableArea.isScrolledToBottom();this.adjustScroller();aa&&this.scrollableArea.scrollToBottom();}.bind(this)),z=c('Event').listen(w,'blur',function(){x.unsubscribe(y);z.remove();});}}if(w.classList.contains('UFIPagerLink')||w.classList.contains('UFICommentLink'))if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.haltAutoplay=true;}.bind(this);c('Arbiter').subscribe(c('UFIUIEvents').InputHeightChanged,function(w,x){if(c('DOM').contains(this.ufiInputContainer,x.node))this.adjustScroller();}.bind(this));c('Arbiter').subscribe(c('UFIUIEvents').PhotoPreviewHeightChanged,function(w,x){if(!x.node||c('DOM').contains(this.ufiInputContainer,x.node))this.adjustScroller();}.bind(this));c('Arbiter').subscribe(c('UFIUIEvents').Changed,function(w,x){if(this.ufiForm===x.form)this.adjustScrollerIfNecessary();}.bind(this));c('Arbiter').subscribe(c('UFIUIEvents').Comment,function(w,x){if(this.ufiForm===x.form){this.adjustScrollerIfNecessary();if(x.isinverted){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));c('Event').listen(this.rhc,'click',function(event){var w=event.getTarget();if(c('Parent').byTag(w,'a')||c('Parent').byTag(w,'button')||c('DOM').isNodeOfType(w,'input'))this.adjustScrollerIfNecessary();}.bind(this));c('Arbiter').subscribe(['reflow',c('UFIUIEvents').CommentPager],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));c('Arbiter').subscribe(c('UFIUIEvents').TranslationRendered,function(){this.adjustScrollerIfNecessary();}.bind(this));c('Event').listen(this.ufiForm,'focusin',v);};u.prototype.openHandler=function(v){'use strict';if(this.isOpen||!c('PhotoPermalinkURI').isValid(v)||this.returningToStart||v.getQueryData().closeTheater||v.getQueryData().permPage){this.openHandlerRegistered=false;return false;}this.open(v);this._uriStack.push(new (c('URI'))(v).getQualifiedURI().toString());c('PageTransitions').transitionComplete(true);return true;};u.prototype.addHaltAutoplaySubscription=function(){'use strict';c('Arbiter').subscribe([c('UFIUIEvents').Focus],function(){this.haltAutoplay=true;}.bind(this));c('Arbiter').subscribe([c('UFIUIEvents').Blur],function(v,w){this.haltAutoplay=w.hasEnteredText;}.bind(this));};u.prototype.open=function(v){'use strict';var w=new (c('URI'))(v),x=w.getQueryData(),y=c('PhotoPermalinkURI').parse(w);if(y!==null){x.fbid=y.photo_id;x.set=y.set_token;}var z=c('VideoPermalinkURI').parse(w);if(z!==null){x.v=z.video_id;x.set=z.set_token;}if(!x.fbid&&!x.v&&!x.pid){var aa=t.exec(w.getPath());if(aa)x.v=aa[1];}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){x.firstLoad=true;this.initialLoad=true;c('LitestandStoryInsertionStatus').registerBlocker(function(){return this.isOpen;}.bind(this));c('tickerPhoteSnowLiftOpenStatus').registerOpenChecker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=Object.assign(x,{ssid:this.sessionID});if(this._dataFt)this.loadQuery.data_ft=this._dataFt;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.autoplayOptionScreenConfig=null;this.haltAutoplay=false;this.shouldRenderVideoPivots=false;c('CSS').show(this.nextPager);c('CSS').show(this.prevPager);this.source=null;this.saveTagSubscription=c('Arbiter').subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new (c('PhotoStreamCache'))();this.stream.init(c('PhotosConst').VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this._shouldLog?this._logger:null,x.tagSuggestionMode||'everyone');if(!!c('URI').getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(c('URI').getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(u.STATE_HTML,true);this.rhcCollapsed=false;this._open(v);c('Bootloader').loadModules(["PhotosButtonTooltips"],function(ba){ba.init();});};u.prototype._open=function(v){'use strict';this.createLoader();this.spotlight.show();c('Arbiter').inform('layer_shown',{type:'PhotoSnowlift'});c('Arbiter').inform('PhotoSnowlift.OPEN');this.stageHandlers=[c('Event').listen(window,'resize',this.adjustForResize.bind(this)),c('Event').listen(this.stageWrapper,'click',this.buttonListener.bind(this)),c('Event').listen(this.stageWrapper,'mouseleave',function(event){var y=event.getTarget();if(!(c('Parent').byClass(y,'snowliftOverlay')||c('Parent').byClass(y,'fbPhotoSnowliftTagApproval')||c('Parent').byClass(y,'tagPointer')||c('Parent').byClass(y,'arrow')||c('Parent').byClass(y,'faceboxSuggestion')||c('Parent').byClass(y,'typeaheadWrapper')||c('Parent').byClass(y,'photoTagTypeahead')||c('Parent').byClass(y,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),c('Event').listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),c('Event').listen(this.root,'mousemove',this.hiliteProductItemPager.bind(this)),c('Event').listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),c('Event').listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),c('Event').listen(this.container,'mousemove',this._enableMouseOver.bind(this)),c('Event').listen(this.container,'mouseover',this._interceptMouseOver.bind(this)),c('Event').listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),c('Event').listen(this.root,'focusin',this.hiliteProductItemPager.bind(this)),c('Event').listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this._hasZoomCapability){this.stageHandlers.push(c('Event').listen(this.stage,'mousedown',this._zoomedImageMouseDown.bind(this)));this.stageHandlers.push(c('Event').listen(this.root,'mouseup',this._zoomedImageMouseUp.bind(this)));}this.stageHandlers.push(c('Event').listen(this.root,'click',function(event){var y=event.getTarget();if(c('Parent').bySelector(y,"._418x")){if(c('FullScreen').isFullScreen()){c('FullScreen').toggleFullScreen();return;}this.closingAction=c('PhotoSessionLog').X;this.spotlight.hide();}}.bind(this)),c('Event').listen(this.container,'click',function(event){var y=event.getTarget();if(c('Parent').byClass(y,'rotateRight')){this.rotate('right');}else if(c('Parent').byClass(y,'rotateLeft')){this.rotate('left');}else if(c('Parent').bySelector(y,"._32_l")){var z=c('Parent').bySelector(y,"._32_l"),aa=z.getAttribute('data-fbid'),ba=this.stream.getCursor(),ca=this.stream.calculateDistance(ba,aa),da=this.stream.fbidList.indexOf(aa);c('SnowliftVideoPivotsCarouselController').adjustCarousel(da);this.page(ca,false);this.haltAutoplay=false;this.removeAutoplayOptionScreen();}else if(this.fullscreen)if(c('Parent').byClass(y,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(c('Parent').byClass(y,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var w=c('ge')('fbPhotoSnowliftFeedback');if(w)this.stageHandlers.push(c('Event').listen(w,'click',function(event){var y=event.getTarget();if(c('Parent').byClass(y,'like_link')||c('Parent').byClass(y,'UFILikeLink')&&c('Parent').byClass(y,'UIActionLinks'))this.toggleLikeButton();var z=c('Parent').byClass(event.getTarget(),'uiUfiCollapsedComment');if(z)c('CSS').addClass(z,'uiUfiCollapsedCommentToggle');}.bind(this)));var x=c('ge')('fbPhotoSnowliftOnProfile');if(x)this.stageHandlers.push(c('Event').listen(x,'click',function(event){if(c('Parent').byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=c('URI').getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();this.setLoadingState(u.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){c('PageTransitions').registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}c('PhotoSessionLog').initLogging(c('PhotoSessionLog').SNOWLIFT);if(this.pivots)c('PhotoSessionLog').setRelevantCount(this.pivots.relevantCount);};u.prototype.toggleFullScreen=function(){'use strict';var v=c('FullScreen').toggleFullScreen(document.documentElement);if(v){var w=this.stream.getCurrentImageData();if(w&&w.url&&this.image.src!==w.url&&this.shouldShowHiRes(w))if(!this._log(w.url))new Image().src=w.url;c('PhotoSessionLog').logEnterFullScreen(this.stream.getCursor());}};u.prototype.getStream=function(){'use strict';return this.stream;};u.prototype.fetchInitialData=function(){'use strict';this.stream.waitForInitData();var v=this.loadQuery.within_business?this.loadQuery.business_thread_id:this.loadQuery.fbid;c('UIPagelet').loadFromEndpoint('PhotoViewerInitPagelet',c('ge')('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:c('UFIFeedbackTargets').getActorIDForFeedbackTargetIfExists(v),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};u.prototype.toggleCollapse=function(){'use strict';if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};u.prototype.collapseRHC=function(){'use strict';this.rhcCollapsed=true;c('CSS').addClass(this.root,'collapseRHC');this.adjustForResize();};u.prototype.uncollapseRHC=function(){'use strict';this.rhcCollapsed=false;c('CSS').removeClass(this.root,'collapseRHC');this.adjustForResize();};u.prototype.closeHandler=function(){'use strict';if(!this.isOpen)return;this.closingAction=this.closingAction||c('PhotoSessionLog').ESC;if(c('URI').getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};u.prototype.returnToStartingURI=function(v,w){'use strict';if(!v)if(w){this.squashNextTransition(c('goURI').bind(null,w));}else this.squashNextTransition();this.returningToStart=true;var x=c('Arbiter').subscribe('page_transition',function(){this.returningToStart=false;x.unsubscribe();}.bind(this)),y=v||isNaN(c('UserAgent_DEPRECATED').opera()),z=this._uriStack.length;if(y&&z<window.history.length){window.history.go(-z);}else{var aa=this.startingURI,ba=new (c('URI'))(aa).removeQueryData('closeTheater');if(aa.getQueryData().sk=='approve'&&aa.getPath()=='/profile.php'){ba.removeQueryData('highlight');ba.removeQueryData('notif_t');}c('goURI')(ba);}};u.prototype.squashNextTransition=function(v){'use strict';this.squashNext=true;c('PageTransitions').registerHandler(function w(){if(this.squashNext){this.squashNext=false;if(v)setTimeout(v,0);c('PageTransitions').transitionComplete(true);return true;}return false;}.bind(this),7);};u.prototype.handleNavigateAway=function(v){'use strict';var w=c('computeRelativeURI')(c('PageTransitions').getMostRecentURI().getQualifiedURI(),v.getAttribute('href'));if(this.isOpen&&w instanceof c('URI')&&w.getUnqualifiedURI().toString()!=this.startingURI.toString()&&w.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=c('PhotoSessionLog').NAVIGATE;this.returnToStartingURI(false,w);this.close();return false;}return true;};u.prototype.postProcessTaggedPhotos=function(){'use strict';if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var v=null;if(this.source===u.COLLECTIONS_UNTAGGED_PHOTOS){v='/ajax/photos/photo/edit/skiptag/';}else if(this.source===u.PHOTOS_OF_YOU_SUGGESTIONS||this.source===u.FRIENDS_IN_PHOTOS_SUGGESTIONS)v='/ajax/photos/photo/add_to_star_grid/';if(v)new (c('AsyncRequest'))().setURI(v).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};u.prototype.onTagSaved=function(v,w){'use strict';if(this.taggedPhotoIds){if(this.source===u.PHOTOS_OF_YOU_SUGGESTIONS&&!w.self_tag)return;this.taggedPhotoIds.push(w.photo_fbid);}};u.prototype.clearAlbumBoundaries=function(){'use strict';this._albumBoundaries={start:0,end:0,dir:0};};u.prototype.close=function(){'use strict';if(!this.isOpen)return;this._albumFBID=null;this.hideMorePhotos();this.hidePivotSlide();this._pauseVideoIfNeeded();this.isOpen=false;this._navCount=0;this.clearAlbumBoundaries();if(this.fullscreen)c('FullScreen').disableFullScreen();c('CSS').removeClass(document.body,'fbPhotoSnowliftFullScreenMode');c('ScriptPath').closeOverlayView('snowlift');this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();c('Arbiter').unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;c('setTimeoutAcrossTransitions')(this.closeCleanup.bind(this),0);if(this.snowflake){c('CSS').removeClass(this.root,"snowflake");this.extraClasses.forEach(function(v){c('CSS').removeClass(this.root,v);},this);}c('UFIRootRegistry').cleanupSnowliftNodes();this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};u.prototype.closeCleanup=function(){'use strict';this.closeDirty=false;c('CSS').removeClass(this.root,'dataLoading');c('PhotoSessionLog').logPhotoViews(this.closingAction);this.destroy();c('CSS').hide(this.errorBox);c('CSS').hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var v=this.stream.getCursor();if(c('VideoPlayerAbortLoadingExperiment').canAbort){var w;for(w=0;w<this.stream.getLength();w++){var x=this.stream.getImageData(this.stream.getCursorAt(w));if(x&&x.video)x.controller.abortLoading();}}c('CSS').removeClass(this.stageWrapper,'showVideo');c('DOM').empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();c('DOM').empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var y=this.closingAction===c('PhotoSessionLog').NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){c('PageTransitions').registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}c('Arbiter').inform('layer_hidden',{type:'PhotoSnowlift'});c('Arbiter').inform('PhotoSnowlift.CLOSE',{is_navigating:y,fbid:v});this._setZoomOut();this._previousZoomScrollPercent=null;};u.prototype.createLoader=function(v){'use strict';if(this.currentImageSize===null){this.adjustStageSize(u.STAGE_MIN);}else{var w=this.getStageSize(this.currentImageSize);w=new (c('Vector'))(Math.max(w.x,this.getMinimumStageWidth()),Math.max(w.y,u.STAGE_MIN.y));var x=this.getImageSizeInStage(this.currentImageSize,w);if(this.thumbSrc===null){this.adjustStageSize(x);}else this.useImage(c('DOM').create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:x.x+'px',height:x.y+'px'}}),x,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(v)setTimeout(function(){var y=function(){var ca=arguments.length<=0||arguments[0]===undefined?null:arguments[0];if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(ca?ca:v,this.currentImageSize);this.setLoadingState(u.STATE_IMAGE_DATA,false);}}.bind(this);if(c('EncryptedImg').isEncrypted(v)){c('EncryptedImg').load(v,y);}else{var z=new Image(),aa=c('Event').listen(z,'load',y),ba=function(){if(aa){aa.remove();aa=null;}};c('Arbiter').subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',ba);c('Arbiter').subscribeOnce('PhotoSnowlift.CLOSE',ba);z.src=v;}this._log(v);}.bind(this),0);c('CSS').hide(this.stageActions);this.setStagePagersState('disabled');};u.prototype.initDataFetched=function(v){'use strict';c('PhotoSessionLog').setPhotoSet(this.stream.getPhotoSet());c('PhotoSessionLog').setLogFbids(v.logids);if(v.eid)c('PhotoSessionLog').setEid(v.eid);this._albumBoundaries.start=this.stream.getCursor();var w=this.stream.getCurrentImageData();c('PhotoSessionLog').addPhotoView(w.info,this.shouldShowHiRes(w),this.fullscreen&&c('FullScreen').isFullScreen());var x=this.stream.getCurrentExtraData();if(this._showHover&&x)c('PhotoTagSearchPivotLogger').logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(x.tagRects));if(x&&x.source!==undefined){this.source=parseInt(x.source,10);c('PhotoSessionLog').setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[c('Event').listen(this.root,'click',this.pageListener.bind(this)),c('Event').listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];c('CSS').show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=v.loggedin;this.disableAds=!this.isLoggedInViewer||v.fromad||v.withinbusiness||this.stream.isInViewAsMode();this.loadAds();if(this._isZoomAvailable(w)){c('PhotoSessionLog').addPanoramaImpression();var y=new (c('Vector'))(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(y);}else if(this._hasZoomCapability)c('CSS').hide(this.showZoomInButton);};u.prototype.adjustScrollerIfNecessary=function(){'use strict';clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};u.prototype.adjustScroller=function(v){'use strict';clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var w=c('Vector').getElementDimensions(this.rhc),x=w.y;x-=c('Vector').getElementDimensions(this.rhcHeader).y;x-=c('Vector').getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var y=c('Vector').getElementDimensions(this.placeInfo);x-=y.y;c('Style').set(this.sideAdUnit,'bottom',y.y+'px');}if(v==null)v=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=v;x=Math.max(0,x);var z=c('Vector').getElementDimensions(this.scrollerBody).y,aa=Math.max(u.MIN_UFI_HEIGHT,x-v);if(z>=aa){if(x>aa){c('CSS').removeClass(this.rhc,'pinnedUfi');x-=aa;}else{c('CSS').addClass(this.rhc,'pinnedUfi');x=0;}c('Style').set(this.scroller,'height',aa+'px');}else{c('Style').set(this.scroller,'height','auto');c('CSS').removeClass(this.rhc,'pinnedUfi');x-=z;}var ba=c('Vector').getElementDimensions(this.ufiInputContainer).y;c('Style').set(this.ufiForm,'padding-bottom',ba+'px');c('PhotoSnowliftAds').resize(new (c('Vector'))(w.x,x));this.scrollableArea.adjustGripper();};u.prototype.adjustForResize=function(){'use strict';this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this._hasZoomCapability){if(!this._isZoomOn)this._conditionDisplayZoomInButton();this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);}};u.prototype.shouldShowHiRes=function(v){'use strict';if(!v||!v.smallurl)return false;var w=this.getStageSize(v.dimensions);w=this._adjustStageSizeForPixelRatio(w);var x=this.getImageSizeInStage(v.dimensions,w);return (x.x>u.STAGE_NORMAL_MAX.x||x.y>u.STAGE_NORMAL_MAX.y);};u.prototype._adjustStageSizeForPixelRatio=function(v){'use strict';if(window.devicePixelRatio&&window.devicePixelRatio>1)v=new (c('Vector'))(v.x*window.devicePixelRatio,v.y*window.devicePixelRatio);return v;};u.prototype.getImageURL=function(v){'use strict';if(v.video){return null;}else if(v.smallurl&&!this.shouldShowHiRes(v))return v.smallurl;return v.url;};u.prototype.getImageOrVideoDimensions=function(v){'use strict';if(v.video){var w=this.getVideoElement(v.video);if(w)return this.getVideoSize(w);}return this.getImageDimensions(v);};u.prototype.getImageDimensions=function(v){'use strict';if(this._isZoomOn)return v.originalDimensions;if(v.smalldims&&(!this.shouldShowHiRes(v)||this.image.src===v.smallurl))return v.smalldims;return v.dimensions;};u.prototype.getStageSize=function(v,w){'use strict';var x=c('Vector').getViewportDimensions(),y=new (c('Vector'))(v.x,v.y+this.getExtraVerticalSpace());if(w)y=new (c('Vector'))(Math.max(v.x,w.x),Math.max(v.y,w.y));var z,aa;if(this.fullscreen&&c('FullScreen').isFullScreen()){aa=screen.height-u.FULL_SCREEN_PADDING*2;return new (c('Vector'))(this.rhcCollapsed?screen.width:screen.width-u.SIDEBAR_SIZE_MAX,this._isItemPagerEnabled()?aa-u.PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:aa);}else{z=Math.min(y.x,x.x-u.SIDEBAR_SIZE_MAX-u.STAGE_CHROME.x);var ba=x.y-u.STAGE_CHROME.y;aa=Math.min(y.y,this._isItemPagerEnabled()?ba-u.PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:ba);}if(z===0&&aa===0)return new (c('Vector'))(0,0);var ca=z/aa,da=y.x/y.y;if(ca<da)return new (c('Vector'))(z,Math.round(z/da));return new (c('Vector'))(Math.round(aa*da),aa);};u.prototype.getExtraVerticalSpace=function(){'use strict';if(this.getVideoOnStage())return u.VIDEO_BOTTOM_BAR_SPACE*2;return 0;};u.prototype.getComponentsHeight=function(){'use strict';var v=this.getVideoOnStage();if(v){var w=c('ge')(v);if(w)return this.getVideoComponentsHeight(w);}return 0;};u.prototype.getMinimumStageWidth=function(){'use strict';var v=u.STAGE_MIN.x;if(this.getVideoOnStage())return v;if(c('PhotoSnowliftActionsGating').ALLOW_MAKE_PROFILE_PICTURE_BUTTON)v+=u.PROFILE_PICTURE_BUTTON_WIDTH;return v;};u.prototype.getImageSizeInStage=function(v,w){'use strict';var x=v.x,y=v.y,z=this.getComponentsHeight(),aa=this.getExtraVerticalSpace();y-=z;w=new (c('Vector'))(w.x,w.y-z-aa);if(x>=w.x||y>=w.y){var ba=w.x/w.y,ca=x/y;if(ba<ca){x=w.x;y=Math.round(x/ca);}else if(ba>ca){y=w.y;x=Math.round(y*ca);}else{x=w.x;y=w.y;}}return new (c('Vector'))(x,y+z);};u.prototype.getStageSizeForZoomedImage=function(v,w){'use strict';if(this.fullscreen&&c('FullScreen').isFullScreen()){var x=this.rhcCollapsed?screen.width:screen.width-u.SIDEBAR_SIZE_MAX,y=screen.height-u.FULL_SCREEN_PADDING*2;return new (c('Vector'))(x,y);}var z=c('Vector').getViewportDimensions();if(w===null)w=new (c('Vector'))(0,0);var aa=new (c('Vector'))(Math.max(v.x,this.getMinimumStageWidth(),w.x),Math.max(v.y,u.STAGE_MIN.y,w.y)),ba=z.x-u.STAGE_CHROME.x;if(!this.rhcCollapsed)ba-=u.SIDEBAR_SIZE_MAX;x=Math.min(aa.x,ba);y=Math.min(aa.y,z.y-u.STAGE_CHROME.y);return new (c('Vector'))(x,y);};u.prototype.adjustStageSize=function(v){'use strict';var w=this.currentImageSize;if(v){w=v;}else{var x=this.stream&&this.stream.getCurrentImageData();if(x)w=this.getImageOrVideoDimensions(x);}if(!w)return;this.currentImageSize=w;var y=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&w.x>w.y&&w.x<=u.TIMELINE_STRETCH_WIDTH&&w.x>=u.TIMELINE_STRETCH_MIN){w.y=Math.round(w.y*u.TIMELINE_STRETCH_WIDTH/w.x);w.x=u.TIMELINE_STRETCH_WIDTH;}var z;if(this._isZoomOn){z=this.getStageSizeForZoomedImage(w,this.currentMinSize);}else z=this.getStageSize(w,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new (c('Vector'))(0,0);this.currentMinSize=new (c('Vector'))(Math.max(z.x,this.getMinimumStageWidth(),this.currentMinSize.x),Math.max(z.y,u.STAGE_MIN.y,this.currentMinSize.y));var aa=this.getImageSizeInStage(w,this.currentMinSize),ba=this.currentMinSize.x-aa.x,ca=this.currentMinSize.y-aa.y;if(ba>0&&ba<u.PADDING_MIN){this.currentMinSize.x-=ba;}else if(ca>0&&ca<u.PADDING_MIN)this.currentMinSize.y-=ca;var da=this.currentMinSize.x+u.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)da=this.currentMinSize.x;var ea=this.getVideoOnStage()&&this.pivotsCarouselElement,fa=0,ga=this.currentMinSize.y;if(ea){var ha=this.pivotsCarouselElement.clientHeight;fa=Math.ceil(ha/100)*100;ga=ga+fa;}this.snowliftPopup.style.cssText='width:'+da+'px;'+'height:'+ga+'px;';var ia=this.currentMinSize.y-y,ja=ia+fa;if(c('UserAgent_DEPRECATED').firefox()){var ka=c('Style').get(this.stageWrapper,'font-size');ia=ia/parseFloat(ka)+'em';ja=ja/parseFloat(ka)+'em';}else{ia=ia+'px';ja=ja+'px';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+ia+';';if(this.getVideoOnStage())this.videoStage.style.cssText='width:'+this.currentMinSize.x+'px;'+'height:'+ja+';';if(this._isZoomOn){var la=this.currentMinSize.y-y;if(w.y>la){var ma=w.x/w.y*la;c('Style').apply(this.zoomedImage,{width:ma+"px",height:la+"px"});}else c('Style').apply(this.zoomedImage,{width:w.x+"px",height:w.y+"px"});}else{aa.y-=this.getComponentsHeight();this.setMediaElementSize(aa);}if(ea)this.setPivotCarouselElementWidth(ka);var na=this.getTagger();if(na)na.repositionTagger();this.adjustScrollerIfNecessary();};u.prototype.setMediaElementSize=function(v){'use strict';var w=this.image;if(this.getVideoOnStage())if(this._videoPlayerStateManager&&this._videoPlayerStateManager.setDimensions){this._videoPlayerStateManager.setDimensions(v.x,v.y);}else w=c('DOM').scry(this.videoStage,"._53j5")[0]||w;w.style.cssText='width:'+v.x+'px;'+'height:'+v.y+'px;';};u.prototype.setPivotCarouselElementWidth=function(v){'use strict';var w=this.videoStage.clientWidth;if(c('UserAgent_DEPRECATED').firefox()){w=w/parseFloat(v)+'em';}else w=w+'px';this.pivotsCarouselElement.style.width=w;};u.prototype.adjustForNewData=function(){'use strict';if(!this.image)return;var v=c('DOM').scry(this.stage,'div.tagsWrapper')[0],w=c('Vector').getElementDimensions(this.image);if(v){c('Style').set(v,'width',w.x+'px');c('Style').set(v,'height',w.y+'px');}};u.prototype.adsDisplayedCallback=function(v,w){'use strict';var x=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&v<u.MIN_ADS_VISIBLE&&w.length>=u.MIN_ADS_VISIBLE;if(x){this.inAdsDisplayedCallback=true;var y=w[u.MIN_ADS_VISIBLE-1];this.adjustScroller(y);this.inAdsDisplayedCallback=false;}};u.prototype.setLoadingState=function(v,w){'use strict';switch(v){case u.STATE_IMAGE_PIXELS:c('CSS').conditionClass(this.root,'imagePixelsLoading',w);break;case u.STATE_IMAGE_DATA:this.loadingStates[v]=w;c('CSS').conditionClass(this.root,'imageLoading',w);break;case u.STATE_HTML:this.loadingStates[v]=w;c('CSS').conditionClass(this.root,'dataLoading',w);this.rhc.setAttribute('aria-busy',w?'true':'false');break;}};u.prototype.destroy=function(){'use strict';this.stageHandlers.forEach(function(v){v.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(v){v.remove();});this.pageHandlers=null;}this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;this._videoPlayerStateManager=null;};u.prototype.checkState=function(v){var w=arguments.length<=1||arguments[1]===undefined?false:arguments[1];'use strict';if(v!=u.STATE_ERROR&&!this.loadingStates[v])return;switch(v){case u.STATE_IMAGE_DATA:var x=this.stream.getCurrentImageData();if(x){var y=this.getImageURL(x);if(y){this.switchImage(y,null,true,w);}else if(x.video)this.switchVideo(x.video,true);this.setLoadingState(v,false);}break;case u.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(v,false);}break;default:if(this.stream.errorInCurrent()){c('CSS').hide(this.image);c('CSS').show(this.errorBox);}break;}};u.prototype.buttonListener=function(event){'use strict';var v=event.getTarget(),w=Date.now();if(c('Parent').bySelector(v,"._5qmg")){c('PhotoSessionLog').addPanoramaClick();this.switchIntoZoomedImage();return;}if(c('Parent').bySelector(v,"._5qmh")){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}if(c('Parent').byClass(v,'fbPhotoTagApprovalBox'))return;if(w-this.lastPage<350)return;if(c('Parent').byClass(v,'fbPhotosPhotoLike')){this.likePhoto();}else if(c('Parent').byClass(v,'tagApproveIgnore')){this.updateTagBox(event,v);}else if(c('Parent').bySelector(v,"._5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(c('Parent').bySelector(v,"._5ymu")){if(!this._showingMorePhotos){c('PhotoTagSearchPivotLogger').logShowMorePhotos();var x=this.stream.getCursor();if(x)this.showMorePhotos(String(x));if(this._hasZoomCapability)c('CSS').hide(this.showZoomInButton);}else{c('PhotoTagSearchPivotLogger').logHideMorePhotos();this._conditionDisplayZoomInButton();this.hideMorePhotos();}return;}else if(c('Parent').bySelector(v,"._27n"))this._conditionDisplayZoomInButton();this.hideMorePhotos();};u.prototype.toggleSlideshow=function(){'use strict';if(!this.slideshowGk)return;if(this._slideshowToken){this.stopSlideshow();}else this.startSlideshow();};u.prototype.startSlideshow=function(){'use strict';this._slideshowToken=window.setInterval(this.page.bind(this,1,c('UserAgent_DEPRECATED').chrome()&&c('FullScreen').isFullScreen()),u.SLIDESHOW_TIME);c('CSS').addClass(this.root,'slideshowStarted');c('CSS').removeClass(this.root,'slideshowAvailable');};u.prototype.stopSlideshow=function(){'use strict';this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;c('CSS').addClass(this.root,'slideshowAvailable');c('CSS').removeClass(this.root,'slideshowStarted');};u.prototype.likePhoto=function(){'use strict';c('PhotoSessionLog').addButtonLike();var v=c('$')('fbPhotoSnowliftFeedback'),w=c('DOM').scry(v,'button.like_link')[0];if(!w)w=c('DOM').scry(v,'a.UFILikeLink')[0];var x=w.getAttribute('href');if(c('FullScreen').isFullScreen())if(c('UserAgent_DEPRECATED').chrome())w.setAttribute('href','javascript:;');w.click();w.setAttribute('href',x);};u.prototype.toggleLikeButton=function(){'use strict';var v=c('DOM').scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(v){var w=c('DOM').find(this.root,'.likeCount'),x=c('DOM').find(w,'.likeCountNum');if(w)if(c('CSS').hasClass(v,'viewerLikesThis')){c('DOM').setContent(x,parseInt(x.textContent,10)-1);}else c('DOM').setContent(x,parseInt(x.textContent,10)+1);c('CSS').toggleClass(v,'viewerLikesThis');c('CSS').removeClass(v,'viewerAlreadyLikedThis');}};u.prototype.likePhotoWithKey=function(){'use strict';return c('LikeConfirmer').like(this.likePhoto.bind(this),c('getActiveElement')());};u.prototype.updateTagBox=function(v,w){'use strict';this.unhiliteAllTags();var x=c('ge')(v);if(!x)return;c('CSS').addClass(x,'tagBox');c('CSS').addClass(x,'tagBoxPendingResponse');c('CSS').removeClass(x,'tagBoxPending');c('CSS').hide(c('DOM').find(x,'span.tagForm'));if(w){c('CSS').show(c('DOM').find(x,'span.tagApproved'));}else c('CSS').show(c('DOM').find(x,'span.tagIgnored'));};u.prototype.rotate=function(v){'use strict';var w=this.stream.getCursor();if(this.getVideoOnStage()){var x=v=='left'?270:90;!!!this.videoRotateURI?k(0):undefined;c('Bootloader').loadModules(["VideoRotate"],function(z){new z(w,this.videoRotateURI).motionRotate(x);}.bind(this));return;}var y=babelHelpers['extends']({fbid:w,opaquecursor:this.stream.getOpaqueCursor(w),cs_ver:c('PhotosConst').VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());y[v]=1;this.setLoadingState(u.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);c('CSS').hide(this.image);new (c('AsyncRequest'))('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(y).setErrorHandler(this.rotationError.bind(this,w)).setFinallyHandler(this.rotationComplete.bind(this,w)).setMethod('POST').setReadOnly(false).send();};u.prototype.rotationComplete=function(v,w){'use strict';if(v==this.stream.getCursor()){this.setLoadingState(u.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};u.prototype.rotationError=function(v,w){'use strict';if(v==this.stream.getCursor()){this.setLoadingState(u.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));c('Bootloader').loadModules(["AsyncResponse"],function(x){x.defaultErrorHandler(w);});}};u.prototype.saveTagsFromPayload=function(v){'use strict';this.storeFromData(v);if('data' in v&&this.stream.getCursor() in v.data)this.swapData();};u.prototype.saveEdit=function(){'use strict';if(!c('CSS').hasClass(this.root,'fbPhotoSnowliftEditMode'))return;c('Bootloader').loadModules(["PhotoInlineEditor","FormSubmit"],function(v,w){var x=v.getInstance(this.getViewerConst());x&&w.send(x.getForm().controller);}.bind(this));};u.prototype.mouseLeaveListener=function(event){'use strict';this.unhiliteAllTags();this.reHilitePendingTag();};u.prototype.hiliteProductItemPager=function(event){'use strict';var v=c('Vector').getEventPosition(event),w=c('Vector').getElementDimensions(this.root),x=w.y-v.y;if(x>u.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE&&v.y>u.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE){c('CSS').conditionClass(this.upPager,'hilightPager',false);c('CSS').conditionClass(this.downPager,'hilightPager',false);return;}var y=x<u.PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE;c('CSS').conditionClass(this.upPager,'hilightPager',!y);c('CSS').conditionClass(this.downPager,'hilightPager',y);};u.prototype.hilitePager=function(event){'use strict';var v=c('Vector').getEventPosition(event),w=c('Vector').getElementPosition(this.stage),x=c('Vector').getElementDimensions(this.stage);if(c('Locale').isRTL()){this.stagePagerPrev=x.x-(v.x-w.x)<u.GOPREV_AREA;}else this.stagePagerPrev=v.x-w.x<u.GOPREV_AREA;c('CSS').conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);c('CSS').conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var y,z=event.getTarget();if(!c('Parent').byClass(z,'snowliftOverlay')&&!c('Parent').byClass(z,'bottomBarActions')&&!c('Parent').byClass(z,'snowliftPager'))y=u.PAGER_FADE;this.showPagers(y);};u.prototype.showPagers=function(v){'use strict';clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof v!=='undefined')this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),v);};u.prototype.hidePagers=function(){'use strict';var v=c('DOM').scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(v)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};u.prototype.getTagger=function(){'use strict';return this.PhotoTagger&&this.PhotoTagger.getInstance(c('PhotosConst').VIEWER_SNOWLIFT);};u.prototype.unhiliteAllTags=function(){'use strict';clearTimeout(this.unhiliteTimer);c('DOM').scry(this.stage,'div.tagsWrapper div.hover').forEach(function(w){c('CSS').removeClass(w,'hover');});c('DOM').scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(w){c('CSS').removeClass(w,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!c('CSS').hasClass(this.root,'taggingMode')){var v=this.getTagger();if(v){v.hideTagger();v.setCurrentFacebox(null);}}};u.prototype.switchHilitedTags=function(v,w){'use strict';if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var x=c('ge')(v);if(x){this.hilitedTag=v;if(!c('CSS').hasClass(this.root,'taggingMode')&&c('PhotosUtils').isFacebox(this.hilitedTag)){var y=this.getTagger();if(y){c('CSS').addClass(x,'hover');var z=y.getFacebox(v);y.setCurrentFacebox(z);if(z)y.addTagFromFacebox(z);}}else c('CSS').addClass(x,'hover');if(c('CSS').hasClass(x,'tagBoxPending')&&!c('CSS').hasClass(x,'showPendingTagName')&&w===true){c('DOM').scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(aa){c('CSS').removeClass(aa,'showPendingTagName');});c('CSS').addClass(x,'showPendingTagName');}}};u.prototype.reHilitePendingTag=function(){'use strict';var v=c('ge')(this.hilitedTag);if(v&&c('CSS').hasClass(v,'showPendingTagName'))return;var w=c('DOM').scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(w)this.switchHilitedTags(w.id);};u.prototype.hiliteTagsOnMouseMove=function(event){'use strict';if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var v=event.getTarget();if(c('Parent').byClass(v,'snowliftOverlay')||c('Parent').byClass(v,'fbPhotoSnowliftTagApproval')||c('Parent').byClass(v,'tagPointer')||c('Parent').byClass(v,'arrow')||c('Parent').byClass(v,'faceboxSuggestion')||c('Parent').byClass(v,'typeaheadWrapper')||c('Parent').byClass(v,'photoTagTypeahead'))return;var w=c('Parent').byClass(v,'tagBoxPending'),x=false;if(this.hilitedTag){var y=c('ge')(this.hilitedTag);x=y&&c('CSS').hasClass(y,'tagBoxPending');}var z=!this.hilitedTag&&w||!x&&w;if(z){this.switchHilitedTags(w.id);return;}if(w&&w.id==this.hilitedTag)return;var aa=250,ba=15,ca=c('Vector').getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=ca;var da=c('PhotosUtils').absoluteToNormalizedPosition(this.image,ca);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(ca)<ba){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(da))return;var ea=c('PhotosUtils').getNearestBox(this.stream.getCurrentExtraData().tagRects,da);if(!ea){if(!x){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var fa=null;if(x){var ga={};ga[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];fa=c('PhotosUtils').getNearestBox(ga,da);}if(fa!==null&&x)return;if(this.hilitedTag!=ea)if(x){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,ea),aa);}else{if(this._showHover&&!this._seenTags[ea]){this._seenTags[ea]=true;c('PhotoTagSearchPivotLogger').logPivotImpression('snowlift',ea);}this.switchHilitedTags(ea);}};u.prototype.currentTagHasPrecedence=function(v){'use strict';if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===undefined){this.hilitedTag=null;return false;}var w=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],x=new (c('Rect'))(w.t+w.h()/2,w.r,w.b+(c('PhotosUtils').isFacebox(this.hilitedTag)?10:0),w.l,w.domain);return x.contains(v);};u.prototype.getVideoOnStage=function(){'use strict';var v=this.stream&&this.stream.getCurrentImageData();return v&&v.video;};u.prototype.shouldPageOnAction=function(v,w){'use strict';if(!this.isOpen||c('LikeConfirmer').isShowingConfirmation())return false;var x=c('isNode')(w)&&(c('Parent').byClass(w,'snowliftPager')||c('Parent').byClass(w,'stagePagers')||c('Parent').byClass(w,'pivotPageColumn')),y=c('isNode')(w)&&c('Parent').byClass(w,'stage'),z=c('CSS').hasClass(w,'faceBox'),aa=!c('CSS').hasClass(this.root,'taggingMode')&&z&&!x;if(aa){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout(function(){c('DOM').find(this.getTagger().tagger,'input.textInput').focus();}.bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var ba=y&&c('CSS').hasClass(this.root,'taggingMode')||c('Parent').byClass(w,'tagBoxPending')||c('Parent').byClass(w,'tagBoxPendingResponse')||c('Parent').byClass(w,'fbPhotoTagApprovalBox')||c('Parent').byClass(w,'tag');if(ba)return false;if(y&&this._isZoomOn)y=false;return v==c('Keys').LEFT||v==c('Keys').RIGHT||v==c('Keys').UP||v==c('Keys').DOWN||v==o||v==p||x||aa||y;};u.prototype.keyHandler=function(v,event){'use strict';if(event.getModifiers().any||c('Layer').getTopmostLayer()!==this.spotlight)return true;switch(c('Event').getKeyCode(event)){case c('Keys').LEFT:case c('Keys').RIGHT:case c('Keys').UP:case c('Keys').DOWN:case o:case p:this.pageListener(event);return false;case q:return this.toggleFullScreen();case r:return this.likePhotoWithKey();case c('Keys').SPACE:this.toggleSlideshow();this.showPagers(u.PAGER_FADE);return false;case c('Keys').ESC:if(this._isZoomOn){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return false;}break;}};u.prototype._isItemPagerEnabled=function(){'use strict';var v=this._scrapProductItemSnowLiftLinks();return v!==null&&v.length>1;};u.prototype._setupNextItemUI=function(){'use strict';if(!this.upPager||!this.downPager)return;var v=this._scrapProductItemSnowLiftLinks();if(!v||v.length<2){c('CSS').hide(this.upPager);c('CSS').hide(this.downPager);}else{var w=c('Vector').getElementDimensions(this.stage),x=c('Vector').getElementDimensions(this.root),y=(x.y-w.y)/2-u.PRODUCT_ITEM_PAGER_MARGIN;this.upPager.style.marginTop="-"+y+"px";this.downPager.style.marginTop=y-u.PRODUCT_ITEM_PAGER_HEIGHT+"px";c('CSS').show(this.upPager);c('CSS').show(this.downPager);}};u.prototype._scrapProductItemSnowLiftLinks=function(){'use strict';if(!this._elem)return null;var v=c('ge')('pagelet_group_forsaleposts');if(!v)v=c('ge')('group_commerce_cross_group_feed_stories');if(!v)return null;var w=c('DOM').scry(v,'a[name="snowlift"]').filter(function(z){return c('DOM').scry(z,'img').length==1;}),x=w.map(function(z){return z.href;}),y=c('arrayContains')(x,this._elem.href);return y?w:[];};u.prototype._loadNextItem=function(v){'use strict';var w=this._scrapProductItemSnowLiftLinks();if(!w)return;var x=w[0];w.every(function(y,z){if(y.href===this._elem.href){var aa=v?++z:--z;if(aa<0){x=w[w.length-1];}else if(aa<w.length)x=w[aa];return false;}return true;}.bind(this));x.click();};u.prototype.shouldHandlePendingTag=function(event){'use strict';var v=this.getTagger();if(!v||!v.tags.length)return false;var w=c('PhotosUtils').absoluteToNormalizedPosition(this.getImage(),c('Vector').getEventPosition(event)),x=v.findNearestTag(w);if(!x||!c('CSS').hasClass(x.node,'tagBoxPending'))return false;c('Arbiter').inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:x.id,version:this.getVersionConst()});return true;};u.prototype.pageListener=function(event){'use strict';var v=c('Event').getKeyCode(event),w=event.getTarget();if(this._slideshowToken){this.stopSlideshow();return;}if(!this.shouldPageOnAction(v,w))return;if(this.shouldHandlePendingTag(event))return;var x=0,y=null,z=null;if(v==c('Keys').RIGHT||v==p){x=1;c('PhotoSessionLog').setPagingAction('key_right');this._disableMouseOver=true;}else if(v==c('Keys').LEFT||v==o){x=-1;c('PhotoSessionLog').setPagingAction('key_left');this._disableMouseOver=true;}else if(v==c('Keys').UP){c('PhotoSessionLog').setPagingAction('key_up');this._disableMouseOver=true;y=false;}else if(v==c('Keys').DOWN){c('PhotoSessionLog').setPagingAction('key_down');this._disableMouseOver=true;y=true;}else if(c('Parent').byClass(w,'next')){x=1;c('PhotoSessionLog').setPagingAction('click_next');}else if(c('Parent').byClass(w,'prev')){x=-1;c('PhotoSessionLog').setPagingAction('click_prev');}else if(c('Parent').byClass(w,'down')){y=true;c('PhotoSessionLog').setPagingAction('click_down');}else if(c('Parent').byClass(w,'up')){y=false;c('PhotoSessionLog').setPagingAction('click_up');}else if(z=c('Parent').byClass(w,'seek')){var aa=c('DataStore').get(z,'seek-fbid');x=this.stream.getRelativeMovement(aa);c('PhotoSessionLog').setPagingAction('seek');}else if(!this.stagePagerPrev){x=1;c('PhotoSessionLog').setPagingAction('click_stage');}else{x=-1;c('PhotoSessionLog').setPagingAction('click_stage_back');}var ba=c('DOM').scry(this.ufiForm,'input.mentionsHidden'),ca=false;for(var da=0;da<ba.length;da++)if(!c('Input').isEmpty(ba[da])){ca=true;break;}if(ca||c('CSS').hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(this.page.bind(this,x));}else{this.page(x,c('UserAgent_DEPRECATED').chrome()&&c('FullScreen').isFullScreen());this._previousZoomScrollPercent=null;}if(null!==y)this._loadNextItem(y);};u.prototype.warnLeavePage=function(v){'use strict';new (c('Dialog'))().setTitle(j._("\u00bfSeguro que quieres salir de esta p\u00e1gina?")).setBody(j._("Si sales de esta p\u00e1gina perder\u00e1s los cambios que no has guardado.")).setButtons([{name:'leave_page',label:j._("Salir de esta p\u00e1gina"),handler:v},{name:'continue_editing',label:j._("No salir de esta p\u00e1gina"),className:'inputaux'}]).setModal(true).show();};u.prototype.getUsesOpaqueCursor=function(){'use strict';return this.stream.getUsesOpaqueCursor();};u.prototype.getOpaqueCursor=function(v){'use strict';return this.stream.getOpaqueCursor(v);};u.prototype.setReachedLeftEnd=function(){'use strict';this.stream.setReachedLeftEnd();};u.prototype.setReachedRightEnd=function(){'use strict';this.stream.setReachedRightEnd();};u.prototype._initLitestandShareAttachments=function(){'use strict';var v=c('DOMQuery').scry(this.root,'.'+c('LitestandShareAttachment').getSimpleCropClass());v.forEach(function(w){return c('LitestandShareAttachment').init(w);});};u.prototype.page=function(v,w,x){'use strict';if(!this.stream.isValidMovement(v)||!this.stream.nonCircularPhotoSetCanPage(v)){this.showPagers(u.PAGER_FADE);return;}var y=this.stream.getCursorAt(this.stream.calculatePositionForMovement(v));if(this.snowflake&&(this.stream.getCursor()==this.firstInSet&&v<0||this.firstInSet==y&&v>0)){this.showPagers(u.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this._seenTags={};this._navCount+=v;var z=this.stream.allLoaded?Math.abs(this._navCount)-this.stream.getLength():null;if(this._extraSlidePivot&&this._albumFBID){if(!this._albumBoundaries.end&&z===0){this._albumBoundaries.end=this.stream.getCursor();this._albumBoundaries.dir=v;}else if(z===-1)c('PhotosetSearchPivotData').fetch(this._albumFBID,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this._albumBoundaries.end&&y===this._albumBoundaries.start&&v===this._albumBoundaries.dir){this.showPivotSlide(this._albumFBID,w);return;}else if(this.stream.getCursor()===this._albumBoundaries.start&&y===this._albumBoundaries.end&&v===-this._albumBoundaries.dir)this.showPivotSlide(this._albumFBID,w);}else{this.hidePivotSlide();if(v===-this._albumBoundaries.dir)return;}}var aa=this.getVideoOnStage();if(aa)this.switchVideo(aa,false);if(this.pivots&&this.pivots.page(v))return;c('Arbiter').inform('PhotoSnowlift.PAGE');c('Toggler').hide();this.recacheData();this.stream.moveCursor(v);c('CSS').hide(this.image);if(v!==0){this.storyID=null;this._updateContainerOwnerID();}if(v!==0&&this._isZoomOn)this._setZoomOut();if(this.stream.errorInCurrent()){this.setLoadingState(u.STATE_HTML,true);c('CSS').show(this.errorBox);return;}this.movementDelta+=v;var ba=this.stream.getCurrentImageData();if(ba){var ca=this.getImageURL(ba);if(ca){if(ba.info.isgraphic){if(this._canSeeGraphicWarning){this.showGraphicWarning();c('PhotoWarningScreen').logGraphic(n.GRAPHIC_PHOTO_SHOWN_WITH_WARNING);}else{this.hideGraphicWarning();c('PhotoWarningScreen').logGraphic(n.GRAPHIC_PHOTO_SHOWN_NO_WARNING);}}else this.hideGraphicWarning();this.switchImage(ca,null,true);}else if(ba.video)this.switchVideo(ba.video,true,x);if(!w){this.replaceUrl=true;c('goURI')(ba.info.permalink);}this.setLoadingState(u.STATE_IMAGE_DATA,false);}else{this.setLoadingState(u.STATE_IMAGE_PIXELS,true);this.setLoadingState(u.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(u.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(this._slideshowToken){c('CSS').addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)c('CSS').addClass(this.root,'slideshowAvailable');if(!this._extraSlidePivot&&this._showMorePhotos&&this._albumFBID)if(z===-1){c('PhotosetSearchPivotData').fetch(this._albumFBID,this.stream);}else if(z===0){c('PhotoTagSearchPivotLogger').logSuggestMorePhotos();this.showMorePhotos(this._albumFBID,true);this.showPagers();this._navCount=0;}else{this.hideMorePhotos();this.hidePagers();}this._initLitestandShareAttachments();};u.prototype.showMorePhotos=function(v,w){'use strict';if(this._showingMorePhotos)return;this._showingMorePhotos=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));c('CSS').addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=new (c('ReactComponentRenderer'))(c('PhotosetSearchPivot.react'),this.searchPivot);this.searchPivotComponent.setProps({className:"_27g",fbid:v,onclose:this.hideMorePhotos.bind(this),endofalbum:w||false,withBackground:true});};u.prototype.hideMorePhotos=function(){'use strict';if(this.searchPivotComponent&&this._showingMorePhotos){this._showingMorePhotos=false;c('CSS').removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};u.prototype.showPivotSlide=function(v,w){'use strict';if(this.onExtraSlide)return;this.onExtraSlide=true;c('CSS').addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=c('DOM').create('div');c('DOM').insertBefore(this.stageActions,this.pivotSlide);}this.pivotSlideComponent=new (c('ReactComponentRenderer'))(c('PhotosetPivotSlide.react'),this.pivotSlide);this.pivotSlideComponent.setProps({fbid:v,isAlbum:this._isAlbum,albumOwnerName:this._albumOwnerName,visible:true,onReturn:this.page.bind(this,this._albumBoundaries.dir,w)});};u.prototype.hidePivotSlide=function(){'use strict';if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});c('CSS').removeClass(this.stageWrapper,"_3tvf");}this.onExtraSlide=false;};u.prototype.logImpressionDetailsForPhoto=function(){'use strict';var v=[].concat(c('DOM').scry(c('$')('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),c('DOM').scry(c('$')('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(v.length===0)return;var w={};for(var x=0;x<v.length;x++)w[v[x].name]=v[x].value;if(this.getVideoOnStage()){w.width=0;w.height=0;}else{var y=this.getImageDimensions(this.stream.getCurrentImageData());w.width=y.x;w.height=y.y;}c('PhotoSessionLog').addDetailData(this.stream.getCursor(),w);c('PhotoSnowliftAds').setIsLogAdData(true);};u.prototype.loadAds=function(){'use strict';if(this.disableAds)return;c('PhotoSnowliftAds').loadAdsFromUserActivity();};u.prototype.transitionHandler=function(v){'use strict';if(v.getQueryData().closeTheater||v.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(v.getQualifiedURI().toString());c('PageTransitions').transitionComplete(true);return true;}var w=this._uriStack.length;if(w>=2&&this._uriStack[w-2]==v.getQualifiedURI().toString())this._uriStack.pop();var x=this.stream.getCursorForURI(v.getUnqualifiedURI().toString());if(x){var y=this.stream.getRelativeMovement(x);this.page(y,true);c('PageTransitions').transitionComplete(false);return true;}if(this.isOpen){c('PageTransitions').transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};u.prototype.recacheData=function(){'use strict';if(!this.loadingStates.html){var v=this.stream.getCurrentHtml();for(var w in v){var x=c('$')(w);v[w]=Array.from(x.childNodes);c('DOM').empty(x);}}};u.prototype.reloadIfTimeout=function(){'use strict';if(!c('ImageUtils').hasLoaded(this.image)){var v=this.makeNewImage(this.image.src,true);c('Event').listen(v,'load',this.useImage.bind(this,v,null,true));this._log(v.src);}};u.prototype.useImage=function(v,w,x){var y=arguments.length<=3||arguments[3]===undefined?false:arguments[3];'use strict';if(x&&c('ImageUtils').hasLoaded(this.image))return;var z=function(){c('DOM').replace(this.image,v);this.image=v;this.adjustStageSize(w);}.bind(this);if(!y||c('ImageUtils').hasLoaded(v)){z();}else c('Event').listen(v,'load',z);};u.prototype.makeNewImage=function(v,w){'use strict';if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!w)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),u.LOADING_TIMEOUT);var x=c('DOM').create('img',{className:'spotlight',alt:''});x.setAttribute('aria-describedby','fbPhotosSnowliftCaption');x.setAttribute('aria-busy','true');var y=function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout(function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}.bind(this),0);}.bind(this);c('Event').listen(x,'load',y);this._log(v);if(c('EncryptedImg').isEncrypted(v)){c('EncryptedImg').insertIntoDOM(v,x);}else x.src=v;return x;};u.prototype.switchImage=function(v,w,x){var y=arguments.length<=3||arguments[3]===undefined?false:arguments[3];'use strict';c('CSS').hide(this.errorBox);if(!y)c('CSS').hide(this.image);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var z=this.stream&&this.stream.getCurrentImageData();if(z){c('PhotoSessionLog').addPhotoView(z.info,this.shouldShowHiRes(z),this.fullscreen&&c('FullScreen').isFullScreen());if(this._showHover){var aa=this.stream.getCurrentExtraData();if(aa)c('PhotoTagSearchPivotLogger').logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(aa.tagRects));}}this.useImage(this.makeNewImage(v,false),w,false,y);if(x)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(!this._isZoomOn&&this._isZoomAvailable(z)){c('PhotoSessionLog').addPanoramaImpression();var ba=new (c('Vector'))(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(ba);}else if(this._hasZoomCapability)c('CSS').hide(this.showZoomInButton);if(this._isZoomOn)this.switchIntoZoomedImage();c('Arbiter').inform('PhotoSnowlift.SWITCH_IMAGE');};u.prototype._conditionDisplayZoomInButton=function(){'use strict';if(!this._hasZoomCapability)return;if(this._isZoomAvailable()){var v=new (c('Vector'))(this.stage.clientWidth,this.stage.clientHeight);this._displayZoomInButton(v);}else c('CSS').hide(this.showZoomInButton);};u.prototype._displayZoomInButton=function(v){'use strict';var w=parseInt(this.image.style.height,10),x=(v.y-w)/2;if(x>=u.ZOOM_BUTTON_TOP_PAD+u.ZOOM_BUTTON_BOT_PAD+u.ZOOM_BUTTON_HEIGHT){var y=x-u.ZOOM_BUTTON_HEIGHT-u.ZOOM_BUTTON_TOP_PAD;c('Style').set(this.showZoomInButton,'bottom',y+'px');}else c('Style').set(this.showZoomInButton,'bottom','60px');c('CSS').show(this.showZoomInButton);};u.prototype._isZoomAvailable=function(v){'use strict';if(typeof v==="undefined")v=this.stream&&this.stream.getCurrentImageData();if(!this._hasZoomCapability||!v||!v.originalDimensions)return false;var w=new (c('Vector'))(this.stage.clientWidth,this.stage.clientHeight),x=v.originalDimensions,y=x.x/x.y,z=Math.min(w.y*y,x.x);if(!isNaN(y)&&y>2&&x.y>u.MIN_PANORAMA_Y&&w.x*u.MIN_PANO_TO_STAGE_RATIO<z){return true;}else return false;};u.prototype._setZoomIn=function(){'use strict';this._isZoomOn=true;c('CSS').hide(this.showZoomInButton);c('CSS').hide(this.stageActions);c('CSS').show(this.showZoomOutButton);c('Style').set(this.stage,'overflow','hidden');this.spotlight.disableBehavior(c('LayerHideOnEscape'));this.collapseRHC();};u.prototype._setZoomOut=function(){'use strict';if(!this._hasZoomCapability)return;this._isZoomOn=false;this.spotlight.enableBehavior(c('LayerHideOnEscape'));c('Style').set(this.stage,'overflow','visible');c('CSS').hide(this.showZoomInButton);c('CSS').hide(this.showZoomOutButton);c('CSS').hide(this.zoomedImage);c('CSS').hide(this.outerImageSlider);c('CSS').show(this.stageActions);this.uncollapseRHC();};u.prototype.switchIntoZoomedImage=function(v){'use strict';this._setZoomIn();c('CSS').hide(this.zoomedImage);c('CSS').hide(this.outerImageSlider);var w=this.stream.getCurrentImageData(),x=w.originalDimensions;this.zoomedImage.src=w.url;this.adjustStageSize(x);this._initializeZoomedImagePositions(new (c('Vector'))(parseInt(c('Style').get(this.zoomedImage,'width'),10),parseInt(c('Style').get(this.zoomedImage,'height'),10)));c('CSS').hide(this.image);};u.prototype._adjustInnerImageSlider=function(v){'use strict';var w=this.stage.clientWidth,x=Math.min(100,w/v.x*100);c('Style').set(this.innerImageSlider,'width',x+'%');return x;};u.prototype._getSliderSizeForZoomedImage=function(v){'use strict';var w=u.MAX_SLIDER_HEIGHT*this.stage.clientHeight/v.y,x=u.MAX_SLIDER_WIDTH*this.stage.clientWidth/v.x,y=Math.min(w,x);return new (c('Vector'))(100*v.x*y/this.stage.clientWidth,100*v.y*y/this.stage.clientHeight);};u.prototype._initializeZoomedImagePositions=function(v){'use strict';this._scrollZoomedImageToPercent(this._previousZoomScrollPercent);var w=this._getSliderSizeForZoomedImage(v);c('Style').set(this.outerImageSlider,'width',w.x+'%');c('Style').set(this.outerImageSlider,'height',w.y+'%');c('Style').set(this.outerImageSlider,'left',50-w.x/2+'%');c('Style').set(this.showZoomOutButton,'bottom',w.y*this.stage.clientHeight/100+parseInt(c('Style').get(this.outerImageSlider,'bottom'),10)+20+'px');c('CSS').show(this.zoomedImage);c('CSS').show(this.outerImageSlider);};u.prototype._zoomedImageMouseDown=function(event){'use strict';if(!this._isZoomOn)return;c('CSS').addClass(this.stage,'showSlider');if(this._zoomedImageMouseMoveHandle)this._zoomedImageMouseMoveHandle.remove();var v=false,w=event.getTarget();if(c('Parent').bySelector(w,"._10zv")){this.startSliderMargins=new (c('Vector'))(parseFloat(c('Style').get(this.innerImageSlider,'marginLeft')),parseFloat(c('Style').get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;this.mouseDownStartPosition=new (c('Vector'))(event.clientX,event.clientY);}else if(c('Parent').bySelector(w,"._10zx")){this.startSliderMargins=new (c('Vector'))(parseInt(c('Style').get(this.innerImageSlider,'marginLeft'),10),parseInt(c('Style').get(this.innerImageSlider,'marginTop'),10));this.startImageMargins=null;var x=parseInt(c('Style').get(this.innerImageSlider,'width'),10);this.mouseDownStartPosition=new (c('Vector'))(this.innerImageSlider.getBoundingClientRect().left+x/2,event.clientY);v=true;}else if(c('Parent').bySelector(w,"._10zw")){this.startImageMargins=new (c('Vector'))(parseInt(c('Style').get(this.zoomedImage,'marginLeft'),10),parseInt(c('Style').get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;this.mouseDownStartPosition=new (c('Vector'))(event.clientX,event.clientY);}this._zoomedImageMouseMoveHandle=c('Event').listen(this.stage,'mousemove',this._zoomedImagePan.bind(this));if(v){this._zoomedImagePan(event);}else event.kill();};u.prototype._zoomedImageMouseUp=function(event){'use strict';if(this._zoomedImageMouseMoveHandle){c('CSS').removeClass(this.stage,'showSlider');this._zoomedImageMouseMoveHandle.remove();this._zoomedImageMouseMoveHandle=null;var v=parseFloat(c('Style').get(this.zoomedImage,'marginLeft')),w=-this.zoomedImage.width+this.stage.clientWidth;this._previousZoomScrollPercent=v/w;}};u.prototype._zoomedImagePan=function(event){'use strict';var v;if(this.startSliderMargins){v=event.clientX-this.mouseDownStartPosition.x;var w=parseFloat(c('Style').get(this.outerImageSlider,'width')),x=parseFloat(c('Style').get(this.innerImageSlider,'width')),y=Math.max(0,Math.min(w-x,this.startSliderMargins.x+v))/w;c('Style').set(this.innerImageSlider,'marginLeft',100*y+"%");c('Style').set(this.zoomedImage,'marginLeft',-1*y*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){v=1.75*(this.mouseDownStartPosition.x-event.clientX);var z=Math.min(0,Math.max(this.startImageMargins.x-v,-this.zoomedImage.width+this.stage.clientWidth));c('Style').set(this.zoomedImage,'marginLeft',z+'px');c('Style').set(this.innerImageSlider,'marginLeft',-z/this.zoomedImage.width*100+"%");event.kill();}};u.prototype._scrollZoomedImageToPercent=function(v){'use strict';if(v===undefined||v===null)v=.5;var w=new (c('Vector'))(parseInt(c('Style').get(this.zoomedImage,'width'),10),parseInt(c('Style').get(this.zoomedImage,'height'),10));c('Style').set(this.innerImageSlider,'marginLeft',(100-this._adjustInnerImageSlider(w))*v+'%');c('Style').set(this.zoomedImage,'marginLeft',(this.stage.clientWidth-w.x)*v+'px');};u.prototype._preloadNextVideo=function(){'use strict';var v=this.stream.calculatePositionForMovement(1),w=this.stream.getCursorAt(v),x=this.stream.getImageData(w);if(x&&x.video)x.controller.preload();};u.prototype.switchVideo=function(v,w,x){'use strict';this._pauseVideoIfNeeded();var y='swf_'+v;c('DOM').empty(this.videoStage);if(w){this._preloadNextVideo();c('CSS').addClass(this.stageWrapper,'showVideo');var z=this.stream.getCurrentImageData();if(this.shouldRenderVideoPivots){c('CSS').hide(this.nextPager);c('CSS').hide(this.prevPager);}var aa=z.video_element;c('DOM').scry(aa,"._ox1")[0].style.cssText='';var ba=null;if(this.pivotsCarouselElement)ba=c('DOMQuery').scry(this.pivotsCarouselElement,"._32_l");if(ba)ba.forEach(function(fa){var ga=fa.getAttribute('data-fbid'),ha=this.stream.getCursor(),ia=c('DOM').find(fa,"._1pqn");if(ga===ha){c('CSS').show(ia);}else c('CSS').hide(ia);}.bind(this));c('CSS').addClass(aa,'videoStageContainer');c('DOM').appendContent(this.videoStage,aa);c('DOM').appendContent(this.videoStage,this.pivotsCarouselElement);if(window[y]&&!c('ge')(y))window[y].write(v);var ca='video_warning_'+v,da=c('ge')(v);if(!this.videoWarnings)this.videoWarnings=[];if(da&&this.videoWarnings[ca])c('DOM').setContent(da,this.videoWarnings[ca]);this._videoPlayerStateManager=z.controller;this._videoPlayerStateManager.reset();this._videoPlayerStateManager.collectFeedTrackingData();if(this._autoplayVideos){var ea=x||c('VideoPlayerReason').USER;this._videoPlayerStateManager.play(ea);}if(this._autoplayNextVideo)this._videoPlayerStateManager.addListener('finishPlayback',function(){var fa=z.info.fbid.toString();if(this.haltAutoplay&&fa!==this.stream.fbidList[this.stream.fbidList.length-1]){if(this.autoplayOptionScreenConfig){var ga=this.autoplayOptionScreenConfig.controller;ga.registerCallbacks(aa,this.chooseToReplayVideo.bind(this,this._videoPlayerStateManager),this.handleAutoplay.bind(this,z));}}else this.handleAutoplay(z);}.bind(this));setTimeout(this.adjustStageSizeForVideo.bind(this,v),0);}else{window[y]&&window[y].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);c('CSS').removeClass(this.stageWrapper,'showVideo');}};u.prototype.removeAutoplayOptionScreen=function(){'use strict';if(this.autoplayOptionScreenConfig)this.autoplayOptionScreenConfig.controller.removeSelf();};u.prototype.chooseToReplayVideo=function(v){'use strict';v.play(c('VideoPlayerReason').USER);this.removeAutoplayOptionScreen();this.haltAutoplay=false;};u.prototype.handleAutoplay=function(v){'use strict';var w=v.info.fbid.toString();if(w===this.stream.getCursor()&&w!==this.stream.fbidList[this.stream.fbidList.length-1]){c('SnowliftVideoPivotsCarouselController').adjustCarouselOnAutoPlay();this.page(1,false,c('VideoPlayerReason').AUTOPLAY);}this.removeAutoplayOptionScreen();this.haltAutoplay=false;};u.prototype.checkVideoStatus=function(v){'use strict';if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var w=this.getVideoOnStage();if(!w){return;}else{if(w!==v)return;this.adjustStageSizeForVideo(v);}};u.prototype.getVideoSize=function(v){'use strict';return new (c('Vector'))(v.getAttribute('data-video-width'),+v.getAttribute('data-video-height')+this.getVideoComponentsHeight(v));};u.prototype.getVideoElement=function(v){'use strict';return c('DOM').scry(this.videoStage,"._ox1")[0];};u.prototype.getVideoComponentsHeight=function(v){'use strict';var w=0,x=c('Parent').bySelector(v,"._1c_u");if(!x)return 0;var y=c('DOM').scry(x,"._2i84");if(y.length){var z=y[0].getBoundingClientRect();w=z.bottom-z.top;}return w;};u.prototype.adjustStageSizeForVideo=function(v){'use strict';var w=this.getVideoElement(v);if(!w){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,v),200);}else this.adjustStageSize(this.getVideoSize(w));};u.prototype.handleServerError=function(v,w){'use strict';c('DOM').setContent(this.errorBox,v);this.storeFromData(w);};u.prototype.fixButtonText=function(v){'use strict';if(!this.buttonTruncateGk)return;var w=c('DOM').scry(v,".photosTruncatingUIButton"),x=parseInt(c('Style').get(v,'width'),10);if(x>s){var y={tagPhoto:j._("Etiquetar foto"),doneTagPhoto:j._("Finalizar etiquetado"),addLocation:j._("A\u00f1adir ubicaci\u00f3n"),editPhoto:j._("Editar")};for(var z=0;z<w.length;z++){var aa=w[z];c('CSS').addClass(aa,"_2n0k");c('Tooltip').set(aa,y[aa.getAttribute('data-buttonname')],'below','center');}}};u.prototype.swapData=function(){'use strict';var v,w=this.stream.getCurrentHtml();if(w){this.setLoadingState(u.STATE_HTML,false);for(var x in w){v=c('ge')(x);v&&c('DOM').setContent(v,w[x]);}var y=c('ge')('photosTruncatingUIButtonGroup');y&&this.fixButtonText(y);c('Arbiter').inform('PhotoSnowlift.DATA_CHANGE',Object.assign(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),c('Arbiter').BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())c('Arbiter').inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),c('Arbiter').BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};u.prototype.updateTotalCount=function(v,w,x){'use strict';var y=this.stream.getCurrentHtml();if(y){var z=c('$')('fbPhotoSnowliftPositionAndCount');c('DOM').replace(z,x);z=x;c('CSS').show(z);var aa='fbPhotoSnowliftPositionAndCount';y[aa]=Array.from(z.childNodes);}this.stream.setTotalCount(v);this.stream.setFirstCursorIndex(w);};u.prototype.addPhotoFbids=function(v,w,x,y){'use strict';if(y&&this.sessionID&&y!=this.sessionID)return;var z=this.stream.getCursor()===null;if(this.shouldRenderVideoPivots&&!this._videoSameAsSource)this.stream.fbidList=[];this.stream.attachToFbidsList(v,w,x);if(x&&z)this.page(0,true);if(this.pivots&&x)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;c('CSS').addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();if(this.shouldRenderVideoPivots&&!this._videoSameAsSource){var aa=this.stream.getCursor(),ba=this.stream.calculateDistance(aa,this._mediaFBID);this.stream.moveCursor(ba);}};u.prototype.attachTagger=function(v,w){'use strict';c('DOM').appendContent(this.stageActions,v);if(w)w.setTokenarea(this.taglist);};u.prototype.storeFromData=function(v){'use strict';if(!this.isOpen)return;if(v.pivots)this.pivotsCarouselElement=v.pivots;if(v.autoplay_option_screen_config){this.autoplayOptionScreenConfig=v.autoplay_option_screen_config;if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.addHaltAutoplaySubscription();}this.shouldRenderVideoPivots=v.should_render_pivots;if(v.ssid&&this.sessionID&&this.sessionID!=v.ssid)return;var w=this.stream.storeToCache(v);if('error' in w){this.checkState(u.STATE_ERROR);return;}if('init' in v){if(this.shouldRenderVideoPivots)this._videoSameAsSource=v.init.videoSameAsSource;this._mediaFBID=v.init.fbid;this._albumFBID=v.init.album_fbid;this._isAlbum=v.init.is_album;this._albumOwnerName=v.init.album_owner_name;this._autoplayVideos=v.init.autoplay_videos;this._autoplayNextVideo=v.init.autoplay_next_video;}else this._preloadNextVideo();var x='init' in w;if(x){this.initDataFetched(w.init);if(this.openExplicitly){this.replaceUrl=true;c('goURI')(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();}if('image' in w)this.checkState(u.STATE_IMAGE_DATA,x);if('data' in w)this.checkState(u.STATE_HTML);};u.prototype.setLeftAndRightPagersState=function(){'use strict';if(this.stream.isNonCircularPhotoSet()){c('CSS').conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));c('CSS').conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){c('CSS').conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var v=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));c('CSS').conditionClass(this.root,'disableRight',v==this.firstInSet);}};u.prototype.setStagePagersState=function(v){'use strict';switch(v){case 'ready':c('CSS').addClass(this.root,'pagingReady');this.pagersShown=true;this._setupNextItemUI();return;case 'active':c('CSS').addClass(this.root,'pagingActivated');return;case 'inactive':c('CSS').removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':c('CSS').removeClass(this.root,'pagingReady');return;}};u.prototype.deletePhoto=function(v){'use strict';this.closeRefresh();};u.prototype.closeRefresh=function(){'use strict';this.refreshOnClose=true;this.spotlight.hide();};u.prototype.onHiliteTag=function(v,w){'use strict';if(w.version!=c('PhotosConst').VIEWER_SNOWLIFT)return;var x=w.tag;if(x)this.switchHilitedTags(x,true);};u.prototype.onUpdateTagBox=function(v,w){'use strict';if(w.version==c('PhotosConst').VIEWER_SNOWLIFT)this.updateTagBox(w.id,w.approve);};u.prototype._log=function(v){'use strict';if(this._shouldLog){this._logger&&this._logger.log(v.startsWith('data:')?c('EncryptedImg').dataUrlPrefix(v):v);return true;}return false;};u.prototype._enableMouseOver=function(){'use strict';this._disableMouseOver=false;};u.prototype._interceptMouseOver=function(event){'use strict';if(this._disableMouseOver)event.kill();};u.prototype.isReturningToStart=function(){'use strict';return !!this.returningToStart;};u.prototype._pauseVideoIfNeeded=function(){'use strict';if(this._videoPlayerStateManager){this._videoPlayerStateManager.pause('unloaded');if(c('VideoPlayerAbortLoadingExperiment').canAbort)this._videoPlayerStateManager.abortLoading();}};u.getInstance=function(){'use strict';if(!u._instance)u._instance=new u();return u._instance;};u.initWithSpotlight=function(v,w){'use strict';u.getInstance().init(v,w);};u.addPhotoFbids=function(v,w,x,y){'use strict';u.getInstance().addPhotoFbids(v,w,x,y);};u.setReachedLeftEnd=function(){'use strict';u.getInstance().setReachedLeftEnd();};u.setReachedRightEnd=function(){'use strict';u.getInstance().setReachedRightEnd();};u.attachFollowFlyout=function(v){'use strict';c('DOM').insertAfter(c('$')('fbPhotoSnowliftSubscribe'),v);};u.attachSubscribeFlyout=function(v){'use strict';c('DOM').insertAfter(c('$')('fbPhotoSnowliftSubscribe'),v);};u.attachTagger=function(v,w){'use strict';u.getInstance().attachTagger(v,w);};u.preload=function(v,w){'use strict';if(!u.shouldUseSnowlift(v,w))return;u.getInstance().preload(v,w);};u.bootstrap=function(v,w){'use strict';if(!u.shouldUseSnowlift(v,w))return;var x=v&&new (c('URI'))(v).getQueryData();if(x&&x.hasOwnProperty('share_id')){c('Bootloader').loadModules(["SpotlightShareViewer"],function(y){y.bootstrap(v,w);});return;}u.getInstance().bootstrap(v,w);};u.shouldUseSnowlift=function(v,w){'use strict';var x=v&&new (c('URI'))(v).getQueryData();if(x&&x.hasOwnProperty('sell_story_id')){u.getInstance().loadFrameIfUninitialized();c('Bootloader').loadModules(["GroupCommerceProductDetail.react"],function(y){y.showDialog(x.sell_story_id,x,w);});return false;}return true;};u.closeRefresh=function(){'use strict';u.getInstance().closeRefresh();};u.deletePhoto=function(v){'use strict';u.getInstance().deletePhoto(v);};u.getImage=function(){'use strict';return u.getInstance().getImage();};u.getImageId=function(){'use strict';return u.getInstance().getImageId();};u.getLoadQuery=function(){'use strict';return u.getInstance().getLoadQuery();};u.getRHCBody=function(){'use strict';return u.getInstance().getRHCBody();};u.getRHCFooter=function(){'use strict';return u.getInstance().getRHCFooter();};u.getRHCHeader=function(){'use strict';return u.getInstance().getRHCHeader();};u.getRoot=function(){'use strict';return u.getInstance().getRoot();};u.likePhotoSkipConfirmation=function(v){'use strict';u.getInstance().likePhotoSkipConfirmation(v);};u.saveTagsFromPayload=function(v){'use strict';u.getInstance().saveTagsFromPayload(v);};u.saveTagsFromPayloadDelayed=function(v){'use strict';setTimeout(u.saveTagsFromPayload.bind(null,v),2000);};u.handleServerError=function(v,w){'use strict';u.getInstance().handleServerError(v,w);};u.setVideoWarning=function(v,w){'use strict';var x=u.getInstance(),y='video_warning_'+v;if(!x.videoWarnings)x.videoWarnings=[];x.videoWarnings[y]=w;};u.storeFromData=function(v){'use strict';u.getInstance().storeFromData(v);};u.swapData=function(){'use strict';u.getInstance().swapData();};u.updateTotalCount=function(v,w,x){'use strict';u.getInstance().updateTotalCount(v,w,x);};u.setVideoRotateURI=function(v){'use strict';u.getInstance().videoRotateURI=v;};Object.assign(u,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},PROFILE_PICTURE_BUTTON_WIDTH:140,SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:c('emptyFunction'),touchMarkup:c('emptyFunction'),PRODUCT_ITEM_PAGER_HILIGHT_DISTANCE:100,PRODUCT_ITEM_PAGER_HEIGHT_OFFSET:70,PRODUCT_ITEM_PAGER_HEIGHT:21,PRODUCT_ITEM_PAGER_MARGIN:20});Object.assign(u.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:u.STAGE_NORMAL_MAX,stageChrome:u.STAGE_CHROME,stagePagerPrev:null,ua:null,PhotoTagger:null});f.exports=u;},null);