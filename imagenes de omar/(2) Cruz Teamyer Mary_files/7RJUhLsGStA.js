/*!CK:1297235963!*//*1457233892,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["kjuR+"]); }

__d('LegacyMapUtils',['clamp','mod'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={MIN_LATITUDE:-85.05112878,MAX_LATITUDE:85.05112878,MIN_LONGITUDE:-180,MAX_LONGITUDE:180,pows:{},MAX_ZOOM:20,BING_MAP_ZOOM_LEVEL_CITY:10,BING_MAP_ZOOM_LEVEL_REGION:6,EARTH_CIRCUMFERENCE_METERS:40074784,scale:function(i,j){var k=j-i;if(!h.pows[k])h.pows[k]=Math.pow(2,k);return h.pows[k];},mapSize:function(i){return 512*h.scale(1,i);},latLongToXY:function(i,j){var k=c('clamp')(i.latitude,h.MIN_LATITUDE,h.MAX_LATITUDE),l=(i.longitude+180)/360,m=Math.sin(k*Math.PI/180),n=.5-Math.log((1+m)/(1-m))/(4*Math.PI),o=h.mapSize(j);return {x:Math.floor(l*(o-1)+.5),y:Math.floor(n*(o-1)+.5)};},xyToLatLong:function(i,j){var k=h.mapSize(j),l=c('mod')(i.x,k)/k-.5,m=.5-c('clamp')(i.y,0,k-1)/k,n=90-360*Math.atan(Math.exp(-m*2*Math.PI))/Math.PI,o=360*l;return {latitude:n,longitude:o};},getViewForLatLongs:function(i,j,k,l,m,n){if(!k.length)throw new Error('the proper view for zero point(s) is completely ambiguous');l=l||{t:0,r:0,b:0,l:0};m=m||1;n=n||Infinity;var o=h._getBoundingBox(k),p=l.l+l.r,q=l.t+l.b,r=h.MAX_ZOOM,s;if(k.length>1){s=h.mapSize(r);while(r>m&&(h._getWidth(o,s)>i-p||o.b-o.t>j-q)||r>n){o=h._rectScale(o,1,2);r--;s=h.mapSize(r);}}else while(r!==h.BING_MAP_ZOOM_LEVEL_CITY){r--;o=h._rectScale(o,1,2);}var t=o.l-l.l,u=o.r+l.r;if(u<t)u+=h.mapSize(r);var v={t:o.t-l.t,r:u,b:o.b+l.b,l:t};s=h.mapSize(r);var w={x:(v.l+v.r)/2,y:(v.t+v.b)/2},x=h.xyToLatLong(w,r);return {center:x,width:i,height:j,zoom:r};},_getWidth:function(i,j){return h._calculateRightDistanceAToB(i.l,i.r,j);},_getBoundingBox:function(i){var j=[],k=h.mapSize(h.MAX_ZOOM);for(var l=0;l<i.length;l++){var m=i[l];j.push(h.latLongToXY(m,h.MAX_ZOOM));}j.sort(function(v,w){return v.x-w.x;});var n=j.length-1,o=h._calculateRightDistanceAToB(j[n].x,j[0].x,k),p=0,q=n,r=[j[0].y],s;for(var t=1;t<j.length;t++){r.push(j[t].y);var u=h._calculateRightDistanceAToB(j[t-1].x,j[t].x,k);if(u>o){o=u;p=t;q=t-1;}}s={t:Math.min.apply(null,r),r:j[q].x,b:Math.max.apply(null,r),l:j[p].x};return s;},_calculateRightDistanceAToB:function(i,j,k){if(!k)throw new Error('zero or null map width not allowed');return (k+j-i)%k;},_rectScale:function(i,j,k){return {t:i.t*j/k,r:i.r*j/k,b:i.b*j/k,l:i.l*j/k};}};f.exports=h;},null);
__d('randomShuffle',['randomInt'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){for(var j=i.length-1;j>0;j--){var k=c('randomInt').call(this,j+1);if(k!=j){var l=i[k];i[k]=i[j];i[j]=l;}}return i;}f.exports=h;},null);
__d('AggregatedMapCalloutOrientation',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};Object.assign(h,{TOP:'fbMapCalloutUseArrowTop',LEFT:'fbMapCalloutUseArrowLeft',RIGHT:'fbMapCalloutUseArrowRight',BOTTOM:'fbMapCalloutUseArrowBottom',ALWAYS_ON_MAP:'alwaysOnMap'});f.exports=h;},null);
__d('AggregatedMapCallout',['AggregatedMapCalloutOrientation','CSS','DOM','Style','Vector'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=16,i=10,j=10;function k(l,m,n){this.map=l;this.contentContainer=null;this.width=null;this.height=null;this.anchor=null;this.orientation=c('AggregatedMapCalloutOrientation').RIGHT;this.arrowYOffset=null;this.arrowXOffset=null;this.border=m;this.contentContainer=c('DOM').find(this.border,'.fbMapCalloutContent');this.arrowWrap=c('DOM').find(this.border,'.fbMapCalloutArrowWrap');this.arrowL=c('DOM').find(this.border,'.fbMapCalloutArrowLeft');this.arrowR=c('DOM').find(this.border,'.fbMapCalloutArrowRight');this.arrowT=c('DOM').find(this.border,'.fbMapCalloutArrowTop');this.arrowB=c('DOM').find(this.border,'.fbMapCalloutArrowBottom');this._updateDimensions();}Object.assign(k.prototype,{setOrientation:function(l){this.orientation=l;},getOrientation:function(){return this.orientation;},getRoot:function(){return this.border;},getAnchor:function(){return this.anchor;},close:function(){this.anchor=null;this._map_updatePosition();},updateAnchor:function(l){this.anchor=l;this._map_updatePosition();},setContent:function(l){c('DOM').setContent(this.contentContainer,l);this._updateDimensions();},getContent:function(){return this.contentContainer;},recalculateArrowYOffset:function(l){if(!this.anchor)return;var m=this.map._callout_determineArrowYOffset(this,l,this.width,this.height);this.setArrowYOffset(m);this._map_updatePosition();},_updateDimensions:function(){c('CSS').show(this.border);this.width=c('Vector').getElementDimensions(this.border).x;this.height=c('Vector').getElementDimensions(this.border).y;this.setArrowXOffset(this.width/2);this.setArrowYOffset(this.height/2);c('CSS').hide(this.border);},_map_moveTo:function(l,m){this.anchor=l;this.map._callout_panTo(l,this,m);this._map_updatePosition();},_map_updatePosition:function(){var l=this.anchor&&this.map._callout_getAnchorBounds(this.anchor);if(l===null){c('CSS').hide(this.border);return;}var m,n,o,p,q=i,r=this.orientation;if(this.orientation===c('AggregatedMapCalloutOrientation').ALWAYS_ON_MAP){var s=l.getCenter().x,t=l.getCenter().y;if(s<0&&t<0){n=j;m=j;}else if(s>this.map.ww&&t<0){o=j;m=j;}else if(s>this.map.ww&&t>this.map.hh){o=j;p=j;}else if(s<0&&t>this.map.hh){n=j;p=j;}else if(s<0){r=c('AggregatedMapCalloutOrientation').RIGHT;n=j;m=l.calloutY-this.arrowYOffset;}else if(s>this.map.ww){r=c('AggregatedMapCalloutOrientation').LEFT;o=j;m=l.calloutY-this.arrowYOffset;}else if(t<0){r=c('AggregatedMapCalloutOrientation').BOTTOM;m=j;n=(l.l+l.r)/2-this.arrowXOffset;}else if(t>this.map.hh){r=c('AggregatedMapCalloutOrientation').TOP;p=j;n=(l.l+l.r)/2-this.arrowXOffset;}else{m=l.calloutY-this.arrowYOffset;if(s<this.map.ww/2){n=l.r+q;r=c('AggregatedMapCalloutOrientation').RIGHT;}else{n=l.l-q-this.width;r=c('AggregatedMapCalloutOrientation').LEFT;}}}switch(this.orientation){case c('AggregatedMapCalloutOrientation').LEFT:n=l.l-q-this.width;m=l.calloutY-this.arrowYOffset;break;case c('AggregatedMapCalloutOrientation').RIGHT:n=l.r+q;m=l.calloutY-this.arrowYOffset;break;case c('AggregatedMapCalloutOrientation').TOP:p=this.map._getH()-l.t+q;n=(l.l+l.r)/2-this.arrowXOffset;break;case c('AggregatedMapCalloutOrientation').BOTTOM:m=l.b+q;n=(l.l+l.r)/2-this.arrowXOffset;break;}c('CSS').setClass(this.arrowWrap,r);this._setPosition('top',m);this._setPosition('right',o);this._setPosition('bottom',p);this._setPosition('left',n);c('CSS').show(this.border);},_setPosition:function(l,m){if(m!==undefined){m+='px';}else m='auto';c('Style').set(this.border,l,m);},setArrowXOffset:function(l){this.arrowXOffset=l;l-=Math.round(h/2);c('Style').set(this.arrowT,'left',l+'px');c('Style').set(this.arrowB,'left',l+'px');},setArrowYOffset:function(l){this.arrowYOffset=l;l-=Math.round(h/2);c('Style').set(this.arrowL,'top',l+'px');c('Style').set(this.arrowR,'top',l+'px');}});Object.assign(k,{throbber:function(l){l=l||this.DEFAULT_CALLOUT_WIDTH;var m=c('DOM').create('div',{}),n=c('DOM').create('img',{src:'/images/loaders/indicator_blue_small.gif'});c('CSS').setClass(m,'fbAggregatedMapCalloutThrobberDiv');c('Style').set(m,'width',l+'px');c('CSS').setClass(n,'fbAggregatedMapCalloutThrobber');c('DOM').setContent(m,n);return m;},ARROW_HEIGHT_PLUS_PADDING:i,ARROW_WIDTH:h});f.exports=k;},null);
__d('AggregatedMapMarker',['DOM','Style'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){this._root=i;this._sprite=j;}Object.assign(h.prototype,{setPosition:function(i){var j=i.y-this._sprite.getAnchorY(),k=i.x-this._sprite.getAnchorX();c('Style').set(this._root,'top',Math.round(j)+'px');c('Style').set(this._root,'left',Math.round(k)+'px');},setOnClick:function(i){this._root.onclick=i;},setOnMouseover:function(i){this._root.onmouseover=i;},setOnMouseout:function(i){this._root.onmouseout=i;},remove:function(){c('DOM').remove(this._root);},getElement:function(){return this._root;}});f.exports=h;},null);
__d("AggregatedMapZIndex",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};Object.assign(h,{DEFAULT_PIN_BASE_Z_INDEX:1000,PIN_Z_INDEX_MAXIUMUM_ADD:4000,DEFAULT_PIN_MAX_Z_INDEX:5000,CONTROLS_Z_INDEX:7000,CALLOUT_Z_INDEX:9000,TOOLTIP_Z_INDEX:9100});f.exports=h;},null);
__d('LegacyMapCoordinate',['LegacyMapUtils','Vector','mod'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';this.absoluteX=null;this.absoluteY=null;this.latitude=null;this.longitude=null;}h.fromAbsolute=function(i,j){'use strict';if(j===undefined){j=i.y;i=i.x;}var k=new h();k.absoluteX=i;k.absoluteY=j;var l=c('LegacyMapUtils').xyToLatLong(new (c('Vector'))(i,j),h.MAX_ZOOM);k.latitude=l.latitude;k.longitude=l.longitude;return k;};h.fromLatLong=function(i,j){'use strict';if(j===undefined){j=i.longitude;i=i.latitude;}var k=new h();k.latitude=i;k.longitude=j;var l=c('LegacyMapUtils').latLongToXY({latitude:i,longitude:j},h.MAX_ZOOM);k.absoluteX=l.x;k.absoluteY=l.y;return k;};h.fromMap=function(i,j,k){'use strict';var l=c('LegacyMapUtils').scale(k,h.MAX_ZOOM);return h.fromAbsolute(i*l,j*l);};h.prototype.getLatitude=function(){'use strict';return this.latitude;};h.prototype.getLongitude=function(){'use strict';return this.longitude;};h.prototype.getAbsoluteX=function(){'use strict';return this.absoluteX;};h.prototype.getAbsoluteY=function(){'use strict';return this.absoluteY;};h.prototype.getAbsoluteXY=function(){'use strict';return new (c('Vector'))(this.absoluteX,this.absoluteY);};h.prototype.getMapX=function(i){'use strict';return this.getMapXY(i).x;};h.prototype.getMapY=function(i){'use strict';return this.getMapXY(i).y;};h.prototype.getMapXY=function(i){'use strict';var j=c('LegacyMapUtils').scale(h.MAX_ZOOM,i),k=this.absoluteX*j,l=this.absoluteY*j;return new (c('Vector'))(k,l);};h.prototype.add=function(i,j){'use strict';var k=this.getMapXY(i);return h.fromMap(k.x+j.x,k.y+j.y,i);};h.prototype.calculateDistanceSq=function(i,j){'use strict';var k=this.calculateDistanceX(i,j),l=this.calculateDistanceY(i,j);return k*k+l*l;};h.prototype.calculateDistanceX=function(i,j){'use strict';var k=c('LegacyMapUtils').mapSize(i),l=c('mod')(j.getMapX(i)-this.getMapX(i),k);return Math.min(l,k-l);};h.prototype.calculateDistanceY=function(i,j){'use strict';return Math.abs(j.getMapY(i)-this.getMapY(i));};Object.assign(h,{MAX_ZOOM:18,MIN_ZOOM:1});f.exports=h;},null);
__d('AggregatedMapGroup',['AggregatedMapMarker','AggregatedMapZIndex','LegacyMapCoordinate','DOM','Rect','Style','clamp'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l){this._boundingBox=j;this._sprite=k;this._marker=null;this._mapToPixel=l;this.pins=i;this.deleted=false;}Object.assign(h.prototype,{getType:function(){return 'AggregatedMapGroup';},getCenter:function(){return this._mapToPixel(this._boundingBox.getCenter());},getCenterLatLong:function(i){var j=this._boundingBox.getCenter(),k=c('LegacyMapCoordinate').fromMap(j.x,j.y,i);return {latitude:k.getLatitude(),longitude:k.getLongitude()};},hasMarker:function(){return !!this._marker;},dismissMarker:function(){if(this._marker){this._marker.remove();this._marker=null;}},getMarker:function(){return this._marker&&this._marker.getElement();},getSprite:function(){return this._sprite;},updatePosition:function(i){if(!this._marker)return;var j=this.getCenter();this._marker.setPosition(j);},getSpriteBounds:function(){var i=this._sprite,j=this.getCenter().y-i.getAnchorY(),k=this.getCenter().x-i.getAnchorX(),l=k+i.getWidth(),m=j+i.getHeight(),n=new (c('Rect'))(j,l,m,k);n.calloutY=j+i.getCalloutY();return n;},isSinglePin:function(){return this.pins.length==1;},renderMarker:function(i){if(!this._marker){var j=this._sprite,k=j.render();this._marker=new (c('AggregatedMapMarker'))(k,this._sprite);if(this.isSinglePin()){var l=j.getBaseZIndex&&j.getBaseZIndex()||c('AggregatedMapZIndex').DEFAULT_PIN_BASE_Z_INDEX;l+=c('clamp')(Math.floor(this.getCenter().y),0,c('AggregatedMapZIndex').PIN_Z_INDEX_MAXIUMUM_ADD);if(j.setZIndex){j.setZIndex(Math.floor(l));}else c('Style').set(k,'z-index',Math.floor(l));}c('DOM').appendContent(i,k);}return this._marker;},add:function(i,j){return this._boundingBox.add(i,j);}});f.exports=h;},null);
__d('MapAggregation',['removeFromArray'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){this.combine=null;this.iterations=0;this.candidates=null;this.loners=null;}Object.assign(h.prototype,{aggregate:function(i,j,k){this.overlap=k?k:this._overlap;this.candidates=i;this.combine=j;this.loners=[];while(this.candidates.length>0){var l=this.candidates[this.candidates.length-1],m;do{var n=l.center;this._group(l,Number.MAX_VALUE);m=n!==l.center;}while(!this._isDeleted(l)&&m);if(!this._isDeleted(l)){c('removeFromArray')(this.candidates,l);this.loners.push(l);}}return this.loners;},_isDeleted:function(i){return i.center===null;},_delete:function(i){c('removeFromArray')(this.candidates,i);c('removeFromArray')(this.loners,i);i.center=null;},_group:function(i,j){while(true){this.iterations++;if(this.iterations>=10000){this.iterations%10000===0&&0;return;}var k=this._nearest(i),l=k.nearest,m=k.distanceSquared;if(!l||m>j||!this.overlap(i,l))return;var n=l.center,o=i.center;this._group(l,m-1);if(this._isDeleted(i))return;var p=l.center!==n,q=i.center!==o;if(!p&&!q){this.combine(i,l);this._delete(l);return;}}},_nearest:function(i){var j,k,l,m=null,n=Number.MAX_VALUE;for(j=0;j<this.candidates.length;j++){l=this.candidates[j];if(l===i)continue;k=this._distanceSquared(i,l);if(k<n){m=l;n=k;}}for(j=0;j<this.loners.length;j++){l=this.loners[j];if(l===i)continue;k=this._distanceSquared(i,l);if(k<n){m=l;n=k;}}return {nearest:m,distanceSquared:n};},_overlap:function(i,j){var k=i.radius+j.radius;return this._distanceSquared(i,j)<k*k;},_distanceSquared:function(i,j){var k=i.center.x-j.center.x,l=i.center.y-j.center.y;return k*k+l*l;}});f.exports=h;},null);
__d('MapRects',['Rect','Vector','clamp'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){}Object.assign(h,{containsPoint:function(i,j,k){if(k===undefined)k=0;return i.t<=j.y+k&&i.r>=j.x-k&&i.b>=j.y-k&&i.l<=j.x+k;},pad:function(i,j){return h.padXY(i,j,j);},padX:function(i,j){return h.padXY(i,j,0);},padY:function(i,j){return h.padXY(i,0,j);},padXY:function(i,j,k){return new (c('Rect'))(i.t-k,i.r+j,i.b+k,i.l-j,i.domain);},collides:function(i,j){return (i.t<j.b&&i.b>j.t&&i.l<j.r&&i.r>j.l);},boundPoint:function(i,j){var k=new (c('Vector'))(0,0);k.x=c('clamp')(j.x,i.l,i.r);k.y=c('clamp')(j.y,i.t,i.b);return k;},boundingBox:function(i,j){return new (c('Rect'))(Math.min(i.t,j.t),Math.max(i.r,j.r),Math.max(i.b,j.b),Math.min(i.l,j.l));},scale:function(i,j,k){return new (c('Rect'))(i.t*j/k,i.r*j/k,i.b*j/k,i.l*j/k);}});f.exports=h;},null);
__d('AggregatedMap',['csx','Event','AggregatedMapCallout','AggregatedMapCalloutOrientation','AggregatedMapGroup','AggregatedMapZIndex','Arbiter','LegacyMapCoordinate','LegacyMapUtils','CSS','DOM','GeoRectangle','leaflet','MapAggregation','MapRects','Rect','Run','Style','Vector','clamp','$'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=10,j=7,k=100,l=50,m=500,n=409,o=90,p=90,q=.15,r=10,s=10,t=10,u=new (c('Rect'))(50,50,50,50);function v(w,x,y,z,aa,ba,ca){this.mapReady=false;this.lastZoom=null;this.initialView=null;this.lastRender=null;this.visiblePins=[];this.groups=[];this.callouts=[];this.zoomStack=[];this.initialPinsToHide=[];this.arrowYOffset=p;this.padding=k+l;this.topLeft=c('LegacyMapCoordinate').fromLatLong(0,0);this.dynamicMap=w;this.canvas=x;this.instanceid=y;this.logger=ba;this.maxZoom=z.maxZoom;this.minZoom=z.minZoom;this.maxCalloutWidth=z.maxCalloutWidth||z.width-i;this.maxCalloutHeight=z.maxCalloutHeight||z.height-i;this.pad={};this.setViewportPadding(z.paddingTop,z.paddingRight,z.paddingBottom,z.paddingLeft);this.listeners=[];this.bingMapEvents=[];c('Run').onLeave(this._onBeforeLeave.bind(this));this.dynamicMap.onInit(this._onInit.bind(this,aa,ca));}Object.assign(v.prototype,{CALLOUT_MARGIN:10,noPanningStrategy:function(w){return this._noPan.bind(this,w);},leftRightNoPanningStrategy:function(){return this._leftRightNoPan.bind(this);},anchoredPanningStrategy:function(w,x){return this._anchoredPan.bind(this,w,x);},smartPanningStrategy:function(w,x){return this._smartPan.bind(this,w,x);},getMap:function(){this._assertInitialized();return this.map;},setPins:function(w){this._assertInitialized();this.visiblePins=w;this.calloutAnchor=null;this._setZoomButtonVisibility();this._aggregate();},getGroups:function(){return this.groups;},getWidth:function(){return this._getW()-this.pad.l-this.pad.r;},getAbsoluteWidth:function(){return this._getW();},getHeight:function(){return this._getH()-this.pad.t-this.pad.b;},getAbsoluteHeight:function(){return this._getH();},getBounds:function(){var w=this.dynamicMap.getBounds();return new (c('GeoRectangle'))(w.getNorth(),w.getWest(),w.getSouth(),w.getEast());},pushView:function(){this._assertInitialized();this.zoomStack.push(this._getMapView());},invalidateSize:function(){this.dynamicMap.invalidateSize();},zoomIntoOne:function(w,x){this._assertInitialized();this.pushView();this.zoomToOne(w,x);},zoomToOne:function(w,x,y){this.zoomToOneTight(w,x,0,y);},zoomToOneTight:function(w,x,y,z){this._assertInitialized();x=x||new (c('Vector'))(0,0);y=y||0;z=z||false;y=Math.max(this._findMinZoomWherePinIsAlone(w),y,this.getZoom());w.setZoom(y);var aa=w.anchor.add(y,x.mul(-1));this._setMapView({zoom:y,center:{latitude:aa.getLatitude(),longitude:aa.getLongitude()},animate:z},c('Arbiter').BEHAVIOR_PERSISTENT);},zoomInto:function(w){this._assertInitialized();this.pushView();this.zoomTo(w);},removePin:function(w){this._assertInitialized();this.removePins([w]);},removePins:function(w){this._assertInitialized();for(var x=0;x<w.length;x++)w[x]._aggregated_map_remove=true;var y=[];for(var z=0;z<this.visiblePins.length;z++)if(!this.visiblePins[z]._aggregated_map_remove)y.push(this.visiblePins[z]);for(var aa=0;aa<w.length;aa++)delete w[aa]._aggregated_map_remove;this.visiblePins=y;this._aggregate();},addPins:function(w){this._assertInitialized();this.visiblePins=this.visiblePins||[];for(var x=0;x<w.length;x++)this.visiblePins.push(w[x]);this._aggregate();},addPin:function(w){this._assertInitialized();this.addPins([w]);},zoomOut:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('zoom-out');this.zoomDelta(-1,true);},zoomIn:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('zoom-in');this.zoomDelta(1,true);},zoomBack:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('snap-back');var w;if(this.zoomStack.length){w=this.zoomStack.pop();}else{w={};Object.assign(w,this.initialView);w.zoom=Math.min(w.zoom,this.getZoom());}this._setMapView(w);},setInitialView:function(){this._assertInitialized();this.initialView=this._getMapView();var w=c('DOM').scry(this.canvas,"span.__0")[0];w&&c('CSS').hide(w);},closeCalloutAndZoomBack:function(){this._assertInitialized();this.hideCallout();this.zoomBack();},onAddPin:function(w,x){var y=x.pin,z=x.content;this.hideCallout();this.addPin(y);this.zoomIntoOne(y);this.openCallout(y,z);},zoomDelta:function(w,x){w=c('clamp')(this.getZoom()+w,this.minZoom,this.maxZoom)-this.getZoom();if(!w)return;var y=null;if(x&&this._getPrimaryCalloutAnchorGroup()){y=this._getPrimaryCalloutAnchorGroup().getCenter();var z=!c('MapRects').containsPoint(new (c('Rect'))(0,this._getW(),this._getH(),0),y);if(z)y=null;}if(y===null)y={x:this._getW()/2+this._getCenterOffset().x,y:this._getH()/2+this._getCenterOffset().y};var aa=this.map.tryPixelToLocation(c('leaflet').point(y.x,y.y)),ba=c('leaflet').point(y.x-this.map.getWidth()/2,y.y-this.map.getHeight()/2);this._zoom(true,w,aa,ba);},getZoom:function(){return this.map.getZoom();},getCenter:function(){return this.map.getCenter();},getView:function(){return this._getMapView();},setView:function(w){this._assertInitialized();this._setMapView(w);},setViewportPadding:function(w,x,y,z){this.pad.t=w;this.pad.r=x;this.pad.b=y;this.pad.l=z;},redraw:function(){this._assertInitialized();this._aggregate();},zoomTo:function(w,x){this._assertInitialized();if(w.length<1)return;var y=this.maxZoom;if(w.length<r)while(this._aggregateZoom(w,y-1).length==w.length&&y>=s)y--;var z=[];for(var aa=0;aa<w.length;aa++){var ba={latitude:w[aa].getLatitude(),longitude:w[aa].getLongitude()};z.push(ba);}var ca=c('LegacyMapUtils').getViewForLatLongs(this._getW(),this._getH(),z,u,this.minZoom,y);delete ca.height;delete ca.width;ca.animate=x;this._setMapView(ca,c('Arbiter').BEHAVIOR_PERSISTENT);},hideCallout:function(w){this._assertInitialized();var x=this._getPrimaryCalloutAnchor();this._getInternalCallout().close();if(x&&!w)this._inform('calloutHidden');},throbber:function(w){w=w||n;return c('AggregatedMapCallout').throbber(w);},openCallout:function(w,x,y){if(this._getTooltipCallout().getAnchor()===w)this._getTooltipCallout().close();this._getInternalCallout().setContent(x);this._getInternalCallout()._map_moveTo(w,y);return this._getInternalCallout();},getCallout:function(){return this._getInternalCallout();},setExternalCalloutAnchor:function(w){this._externalCalloutAnchor=w;},openTooltip:function(w,x,y){if(this._getInternalCallout().getAnchor()===w)return;this._getTooltipCallout().setContent(x);this._getTooltipCallout()._map_moveTo(w,y);return this._getTooltipCallout();},getTooltip:function(){return this._getTooltipCallout();},updateCallouts:function(){for(var w=0;w<this.callouts.length;w++)this.callouts[w]._map_updatePosition();},_onInit:function(w,x){this.map=this.dynamicMap;this.bingMapEvents=[{name:'movestart move',callback:this._onViewChange},{name:'moveend',callback:this._onViewChangeEnd},{name:'mouseup',callback:this._onMouseUp},{name:'mousedown',callback:this._onMouseDown},{name:'zoomstart',callback:this._onZoomStart}];this.bingMapEvents.forEach(function(aa){this.map.on(aa.name,aa.callback,this);},this);this._onViewChange();this.initialized=true;for(var y=0;y<w.length;y++)w[y].xhp&&this.initialPinsToHide.push(w[y].xhp);w.length&&this.setPins(w);if(x){w[0].setCallout(c('$')(x));this._getInternalCallout()._map_moveTo(w[0],this.noPanningStrategy(c('AggregatedMapCalloutOrientation').TOP));}c('CSS').hide(c('DOM').scry(this.canvas,'.fbAggregatedMapCalloutShell')[0]);for(var z in v.Listeners)this._subscribe('AggregatedMap/'+z,this[z].bind(this));this._inform(v.Events.ready,this,c('Arbiter').BEHAVIOR_STATE);},_callout_getAnchorBounds:function(w){var x=this._getCalloutAnchorGroup(w),y=x&&x.getSpriteBounds();return y;},_callout_panTo:function(w,x,y){var z=this._callout_getAnchorBounds(w),aa=y?y(x,z):null;if(aa){var ba=c('LegacyMapUtils').xyToLatLong(this.dynamicMap.pixelToMap(aa),this.getZoom());this._setMapView({center:ba});}},_callout_determineArrowYOffset:function(w,x,y,z){var aa=this._callout_getAnchorBounds(w.getAnchor()),ba=new (c('Vector'))((aa.l+aa.r)/2,aa.calloutY),ca=z/2,da=this._getVisibleBounds(),ea=c('MapRects').containsPoint(this._getNoPanBounds(z),ba,1),fa=ca;if(x||ea){var ga=da.t+ca+this.CALLOUT_MARGIN,ha=da.b-(z-ca)-this.CALLOUT_MARGIN;fa+=ba.y-c('clamp')(ba.y,ga,ha);}fa=c('clamp')(fa,c('AggregatedMapCallout').ARROW_WIDTH/2,z-c('AggregatedMapCallout').ARROW_WIDTH/2);return fa;},_createCallout:function(w){var x=c('DOM').scry(this.canvas,'.fbAggregatedMapCalloutShell')[0],y=x.cloneNode(true);c('DOM').appendContent(this.canvas,y);c('Style').set(y,'z-index',w);var z=new (c('AggregatedMapCallout'))(this,y);this.callouts.push(z);return z;},_getInternalCallout:function(){this.internalCallout=this.internalCallout||this._createCallout(c('AggregatedMapZIndex').CALLOUT_Z_INDEX);return this.internalCallout;},_getTooltipCallout:function(){this.tooltipCallout=this.tooltipCallout||this._createCallout(c('AggregatedMapZIndex').TOOLTIP_Z_INDEX);return this.tooltipCallout;},_assertInitialized:function(){},_guard:function(w){return function(x,y){if(!(!y||!y._instanceid))if(y._instanceid===this.instanceid)return w(x,y);}.bind(this);},_subscribe:function(w,x){this.listeners.push(c('Arbiter').subscribe(w,this._guard(x)));},_inform:function(w,x,y){x=x||{};x._instanceid=this.instanceid;c('Arbiter').inform('AggregatedMap/'+w,x,y);},_bubbleClick:function(w){this._inform(v.Events.bubbleClick,w);},_bubbleMouseover:function(w){this._inform(v.Events.bubbleMouseover,w);},_bubbleMouseout:function(w){this._inform(v.Events.bubbleMouseout,w);},_pinClick:function(w){if(w._agg_map_callout)if(this.getCallout().getAnchor()===w){this.hideCallout();}else this.openCallout(w,w._agg_map_callout);this._inform(v.Events.pinClick,w);},_pinMouseover:function(w){if(w.name){var x=c('DOM').create('span');c('CSS').addClass(x,'fbAggregatedMapTooltipText');c('DOM').setContent(x,w.name);this.openTooltip(w,x,this.leftRightNoPanningStrategy());}this._inform(v.Events.pinMouseover,w);},_pinMouseout:function(w){if(this.tooltipCallout&&this.tooltipCallout.getAnchor()===w&&w.name)this.tooltipCallout.close();this._inform(v.Events.pinMouseout,w);},_getVisibleBounds:function(){return new (c('Rect'))(this.pad.t,this._getW()-this.pad.r,this._getH()-this.pad.b,this.pad.l);},_getCenterOffset:function(){return {x:(this.pad.l-this.pad.r)/2,y:(this.pad.t-this.pad.b)/2};},_setMapView:function(w,x){var y=this._getCenterOffset();if(w.centerOffset){y.x+=w.centerOffset.x;y.y+=w.centerOffset.y;}w.centerOffset=c('leaflet').point(y.x,y.y);if(w.center)w.center=c('leaflet').latLng(w.center.latitude,w.center.longitude);this.map.setView(w);},_findMinZoomWherePinIsAlone:function(w){if(this.visiblePins.length<2)return this.minZoom;var x=Number.MAX_VALUE,y=null,z=w.anchor.getAbsoluteXY();for(var aa=0;aa<this.visiblePins.length;aa++){var ba=this.visiblePins[aa],ca=ba.anchor.getAbsoluteXY().distanceTo(z);if(ca<x&&ba!==w){x=ca;y=ba;}}var da=w.getAggregationRadius()+y.getAggregationRadius(),ea=this.maxZoom;while(x/2>da&&ea>this.minZoom){ea--;x/=2;}while(ea<this.maxZoom){var fa=this._aggregateZoom(this.visiblePins,ea),ga=false;for(var ha=0;ha<fa.length;ha++){var ia=fa[ha];if(ia.members.length==1&&ia.members[0]===w)return ea;}ea++;}return ea;},_smartPan:function(w,x,y,z){w=w||this.maxCalloutWidth;x=x||this.maxCalloutHeight;var aa=c('MapRects').pad(this._getNoPanBounds(x),m-this.CALLOUT_MARGIN),ba=new (c('Vector'))(z.getCenter().x,z.calloutY);if(c('MapRects').containsPoint(aa,ba)){var ca=this._getVisibleBounds(),da=ba.sub(c('MapRects').boundPoint(this._getNoPanBounds(x),ba)),ea=z.w()/2+c('AggregatedMapCallout').ARROW_HEIGHT_PLUS_PADDING+w+this.CALLOUT_MARGIN;if(ba.x>ca.getCenter().x){y.setOrientation(c('AggregatedMapCalloutOrientation').LEFT);if(!da.x)da.x=ba.x-Math.max(ba.x,ea+ca.l);}else{y.setOrientation(c('AggregatedMapCalloutOrientation').RIGHT);if(!da.x)da.x=ba.x-Math.min(ba.x,ca.r-ea);}var fa=null;if(da.magnitude()>=1)fa=new (c('Vector'))(this._getW()/2+da.x+this._getCenterOffset().x,this._getH()/2+da.y+this._getCenterOffset().y);return fa;}return this._anchoredPan(v.Anchor.DEFAULT,c('AggregatedMapCalloutOrientation').RIGHT,this._getInternalCallout(),z);},_leftRightNoPan:function(w,x){if(x.getCenter().x>this._getVisibleBounds().getCenter().x){w.setOrientation(c('AggregatedMapCalloutOrientation').LEFT);}else w.setOrientation(c('AggregatedMapCalloutOrientation').RIGHT);},_noPan:function(w,x,y){x.setOrientation(w);},_anchoredPan:function(w,x,y,z){var aa=this._getVisibleBounds();y.setOrientation(x);if(w===v.Anchor.DEFAULT)w=new (c('Vector'))(aa.getCenter().x-this.maxCalloutWidth/2-z.w()/2,aa.getCenter().y-q*this._getH()-p+c('AggregatedMapCallout').ARROW_WIDTH/2);return z.getCenter().sub(w).add(new (c('Vector'))(this._getW()/2,this._getH()/2));},_renderOverlay:function(){if(!this.mapReady)return;this.lastRender=this.topLeft;var w,x=new (c('Rect'))(-this.padding,this._getW()+this.padding,this._getH()+this.padding,-this.padding);for(var y=0;y<this.groups.length;y++){w=this.groups[y];var z=w.getCenter();if(c('MapRects').containsPoint(x,z)){var aa=w.renderMarker(this.canvas);if(w.pins.length>1){aa.setOnClick(this._bubbleClick.bind(this,w));aa.setOnMouseover(this._bubbleMouseover.bind(this,w));aa.setOnMouseout(this._bubbleMouseout.bind(this,w));}else{aa.setOnClick(this._pinClick.bind(this,w.pins[0]));aa.setOnMouseover(this._pinMouseover.bind(this,w.pins[0]));aa.setOnMouseout(this._pinMouseout.bind(this,w.pins[0]));}}else w.dismissMarker();}this._position();while(this.initialPinsToHide.length)c('CSS').hide(this.initialPinsToHide.pop());},_getNoPanBounds:function(w){var x=this._getVisibleBounds();return c('MapRects').pad(new (c('Rect'))(x.t+o,x.r,x.b-o,x.l),-this.CALLOUT_MARGIN);},_getCalloutAnchorGroup:function(w){return w&&(w.group||w);},_getPrimaryCalloutAnchor:function(){return this._getInternalCallout().getAnchor()||this._externalCalloutAnchor;},_getPrimaryCalloutAnchorGroup:function(){return this._getCalloutAnchorGroup(this._getPrimaryCalloutAnchor());},_zoom:function(w,x,y,z){x=Math.max(c('LegacyMapCoordinate').MIN_ZOOM,Math.min(this.getZoom()+x,c('LegacyMapCoordinate').MAX_ZOOM));this.map.setView({animate:w,zoom:x,center:y,centerOffset:z});},_getMapView:function(){return {center:this.map.getCenter(),zoom:this.map.getZoom(),width:this.map.getWidth(),height:this.map.getHeight()};},_setZoomButtonVisibility:function(){var w=c('DOM').scry(this.canvas,"label.__1")[0],x=c('DOM').scry(this.canvas,"label.__2")[0];w&&c('CSS').conditionClass(w,"uiButtonDisabled",this.getZoom()>=this.maxZoom);x&&c('CSS').conditionClass(x,"uiButtonDisabled",this.getZoom()<=this.minZoom);},_aggregate:function(){this.logger&&this.logger.startRun('_aggregate');var w,x=this._aggregateZoom(this.visiblePins,this.getZoom()),y=[];for(var z=0;z<x.length;z++){var aa=x[z];w=new (c('AggregatedMapGroup'))(aa.members,aa.rect,aa.sprite,this.dynamicMap.mapToPixel.bind(this.dynamicMap));y.push(w);for(var ba=0;ba<aa.members.length;ba++)aa.members[ba].group=w;}for(var ca=0;ca<this.groups.length;ca++){w=this.groups[ca];w.dismissMarker();w.deleted=true;}for(var da=0;da<this.callouts.length;da++)if(this.callouts[da].getAnchor()&&this.callouts[da].getAnchor().getType()==='AggregatedMapGroup')this.callouts[da].close();this.groups=y;this._renderOverlay();this.logger&&this.logger.endRun('_aggregate');},_combine:function(w,x){for(var y=0;y<x.members.length;y++)w.members.push(x.members[y]);w.rect=c('MapRects').boundingBox(w.rect,x.rect);w.sprite=w.sprite.combine(x.sprite);w.radius=w.sprite.getAggregationRadius();w.center=w.rect.getCenter();w.single=0;return w;},_overlap:function(w,x){var y=w.center.y-x.center.y,z=w.center.x-x.center.x;if(w.single+x.single==1)if(w.single&&y>j/2){y-=j;}else if(x.single&&-y<j/2)y+=j;var aa=w.radius+x.radius;return z*z+y*y<aa*aa;},_aggregateZoom:function(w,x){for(var y=0;y<w.length;y++){w[y].setZoom(x);var z=w[y].center;w[y].rect=new (c('Rect'))(z.y,z.x,z.y,z.x);w[y].single=1;}var aa=[],ba=[];for(var ca=0;ca<w.length;ca++){var da=w[ca],ea={};Object.assign(ea,da);ea.radius=da.getAggregationRadius();ea.members=[da];if(ea.radius){aa.push(ea);}else ba.push(ea);}if(x<this.maxZoom&&aa.length>1)aa=new (c('MapAggregation'))().aggregate(aa,this._combine.bind(this),this._overlap.bind(this));return aa.concat(ba);},_position:function(){this.logger&&this.logger.startRun('_position');var w=this._getW()/2;for(var x=0;x<this.groups.length;x++)this.groups[x].updatePosition(w);this.updateCallouts();this.logger&&this.logger.endRun('_position');},_getDims:function(){return new (c('Vector'))(this._getW(),this._getH());},_getH:function(){return this.map.getHeight();},_getW:function(){return this.map.getWidth();},_onMapClick:function(){this._inform(v.Events.mapClick);},_onViewChangeEnd:function(){this._inform(v.Events.viewChangeEnd,this._getMapView(),c('Arbiter').BEHAVIOR_STATE);},_onViewChange:function(){this.mapReady=true;this._inform(v.Events.viewChange,this._getMapView(),c('Arbiter').BEHAVIOR_STATE);this.topLeft=c('LegacyMapCoordinate').fromLatLong(this.getCenter()).add(this.getZoom(),this._getDims().mul(-.5));if(this.lastZoom!==this.getZoom()){this.lastZoom=this.getZoom();while(this.zoomStack.length&&this.getZoom()<=this.zoomStack[this.zoomStack.length-1].zoom)this.zoomStack.pop();this._setZoomButtonVisibility();this._aggregate();}else if(!this.lastRender||this.topLeft.calculateDistanceX(this.getZoom(),this.lastRender)>k||this.topLeft.calculateDistanceY(this.getZoom(),this.lastRender)>k){this._renderOverlay();}else this._position();var w=c('DOM').scry(this.canvas,"span.__0")[0];w&&c('CSS').conditionShow(w,this._showSnapBack());},_showSnapBack:function(){if(this.zoomStack.length){return true;}else if(this.initialView){var w=this.initialView;if(this.getZoom()>w.zoom){return true;}else{var x=this._getMapView(),y=t/c('LegacyMapUtils').scale(1,this.getZoom());return Math.abs(x.center.latitude-w.center.latitude)>y||Math.abs(x.center.longitude-w.center.longitude)>y;}}return false;},_onMouseDown:function(w){this.xDown=w.pageX;this.yDown=w.pageY;},_onMouseUp:function(w){if(this.xDown==w.pageX&&this.yDown==w.pageY)this._onMapClick();},_onZoomStart:function(w){for(var x=0;x<this.groups.length;x++)this.groups[x].dismissMarker();},_onBeforeLeave:function(){for(var w=0;w<this.listeners.length;w++)this.listeners[w].unsubscribe();this.bingMapEvents.forEach(function(x){this.map.off(x.name,x.callback,this);},this);}});Object.assign(v,{Anchor:{DEFAULT:'default_anchor'},Events:{calloutHidden:'calloutHidden',ready:'ready',mapClick:'mapClick',viewChange:'viewChange',viewChangeEnd:'viewChangeEnd',bubbleClick:'bubbleClick',bubbleMouseover:'bubbleMouseover',bubbleMouseout:'bubbleMouseout',pinClick:'pinClick',pinMouseover:'pinMouseover',pinMouseout:'pinMouseout',onSearchSubmit:'onSearchSubmit'},Listeners:{hideCallout:'hideCallout',zoomDelta:'zoomDelta',zoomIn:'zoomIn',zoomOut:'zoomOut',zoomBack:'zoomBack',closeCalloutAndZoomBack:'closeCalloutAndZoomBack',onAddPin:'onAddPin'},inform:function(w,event,x,y){if(!x){x={};x._instanceid=w;}c('Arbiter').inform('AggregatedMap/'+event,x,y);},listenThenInform:function(w,x,y,z){c('Event').listen(x,y,function(){v.inform(w,z);});},subscribe:function(w,event,x){c('Arbiter').subscribe('AggregatedMap/'+event,v._guard(w,x));},subscribeAll:function(w,x){for(var y in v.Events){var z=x['aggregatedMapHandler_'+y];if(z){z=z.bind(x);v.subscribe(w,y,z);}}},_guard:function(w,x){return function(y,z,aa){if(!aa._instanceid){throw new Error('aggregated map didnt pass instanceid');}else if(aa._instanceid!==w)return;return y(aa);}.bind(this,x);}});f.exports=v;},null);
__d('AggregatedMapCircleSprite',['DOM'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(m,n,o,p){this._size=m;this._radius=n;if(p){this.chooseAggregationRadius=p;this._aggregationRadius=p(this._size);}this._count=o;}function i(){return this._radius;}function j(){return this._radius*2;}function k(m){switch(m){case h.SIZE_SMALL:return 9;case h.SIZE_MEDIUM:return 11;case h.SIZE_LARGE:return 16;}}function l(m){var n;if(this.chooseAggregationRadius){n=this.chooseAggregationRadius;}else n=k;var o=this.getCount()+m.getCount();if(o>=100){return h.large(o,n);}else if(o>=10){return h.medium(o,n);}else return h.small(o,n);}Object.assign(h.prototype,{render:function(){var m=c('DOM').create('div',{className:['fbAggregatedMapBubble','fbAggregatedMapBubble'+this._size].join(' ')});c('DOM').setContent(m,this._count);var n=c('DOM').create('div',{className:['fbAggregatedMapBubbleShell','fbAggregatedMapBubbleShell'+this._size].join(' ')});c('DOM').setContent(n,m);this._root=n;return n;},combine:l,getCount:function(){return this._count;},getHeight:j,getWidth:j,getAnchorX:i,getAnchorY:i,getCalloutX:i,getCalloutY:i,getAggregationRadius:function(){return this._aggregationRadius;}});Object.assign(h,{RADIUS_SMALL:15,RADIUS_MEDIUM:20,RADIUS_LARGE:28,SIZE_SMALL:'Small',SIZE_MEDIUM:'Medium',SIZE_LARGE:'Large',small:function(m,n){return new h(h.SIZE_SMALL,h.RADIUS_SMALL,m,n);},medium:function(m,n){return new h(h.SIZE_MEDIUM,h.RADIUS_MEDIUM,m,n);},large:function(m,n){return new h(h.SIZE_LARGE,h.RADIUS_LARGE,m,n);},combine:l});f.exports=h;},null);
__d('AggregatedMapPin',['LegacyMapCoordinate'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l,m){this.anchor=c('LegacyMapCoordinate').fromLatLong(i);this.sprite=j;this.name=k||null;this.group=null;this.xhp=l;this.profileID=m;}Object.assign(h.prototype,{getType:function(){return 'AggregatedMapPin';},setZoom:function(i){this.center=this.anchor.getMapXY(i);},getLatitude:function(){return this.anchor.getLatitude();},getLongitude:function(){return this.anchor.getLongitude();},getGroup:function(){return this.group;},getAggregationRadius:function(){return this.sprite.getAggregationRadius();},setSprite:function(i){this.sprite=i;},setCallout:function(i){this._agg_map_callout=i;}});Object.assign(h,{create:function(i,j,k,l){return new h(i,j,k,l);}});f.exports=h;},null);
__d('AggregatedMapRedPinSprite',['AggregatedMapCircleSprite','CSS','DOM'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l,m,n,o,p,q){this.size=i;this.image=j;this.width=k;this.height=l;this.calloutY=m;this.aggregationRadius=n;this.text=p;this.count=o;this.css=q;}Object.assign(h.prototype,{render:function(){var i=c('DOM').create('div');c('CSS').addClass(i,'fbAggregatedMapPin');c('CSS').addClass(i,'fbAggregatedMapPin'+this.size);if(this.css)c('CSS').addClass(i,this.css);var j='/images/places/map/'+this.image,k=c('DOM').create('img',{src:j});c('DOM').appendContent(i,k);var l=null;if(this.text){l=c('DOM').create('div');c('CSS').addClass(l,'fbAggregatedMapPinText');c('CSS').addClass(l,'fbAggregatedMapPinText'+this.size);c('DOM').setContent(l,this.count);c('DOM').appendContent(i,l);}return i;},combine:c('AggregatedMapCircleSprite').combine,getCount:function(){return this.count;},getHeight:function(){return this.height;},getWidth:function(){return this.width;},getAnchorX:function(){return this.width/2;},getAnchorY:function(){return this.height;},getCalloutX:function(){return this.width/2;},getCalloutY:function(){return this.calloutY;},getAggregationRadius:function(){return this.aggregationRadius;}});Object.assign(h,{dot:function(i){if(i===undefined)i=1;return new h('Small','small_dot.png',17,22,8,10,i,false);},smallBlank:function(i){return new h('Small','small_blank.png',17,22,8,10,i,true);},mediumBlank:function(i){return new h('Medium','medium_blank.png',25,34,12,14,i,true);},largeBlank:function(i){return new h('Large','large_blank.png',29,43,14,17,i,true);}});f.exports=h;},null);
__d('TimelineMapPlace',['arrayContains'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){this.stories=[];this.creation=false;this.name=null;i.latitude||(i.latitude=0);i.longitude||(i.longitude=0);Object.assign(this,i);if(this.region)this.region=this.region+':'+this.country;this.visibleStories=this.stories;}Object.assign(h.prototype,{setFilters:function(i){var j=[];for(var k=0;k<this.stories.length;k++)if(!i||c('arrayContains')(this.stories[k].categories,i))j.push(this.stories[k]);this.visibleStories=j;},getStories:function(i,j){if(i===undefined)i=true;var k=i?this.visibleStories:this.stories;if(!j){return k;}else{var l=[];for(var m=0;m<k.length;m++){var n=k[m];if(j(n))l.push(n);}return l;}},count:function(i,j){var k=this.getStories(i,j).length;if(this.creation)k++;return k;}});Object.assign(h,{Filters:{MLE:function(i){return i&&!i.isEnt;},ALL:null}});f.exports=h;},null);
__d("TimelineMapStory",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){Object.assign(this,i);}f.exports=h;},null);
__d('TimelineMapController',['AggregatedMap','shield','AggregatedMapCalloutOrientation','AggregatedMapPin','AggregatedMapRedPinSprite','Arbiter','AsyncRequest','LegacyMapCoordinate','CSS','DOM','MapRects','PageEvents','Rect','Style','TimelineMapPlace','TimelineMapStory','Vector','$','isEmpty','mod','randomShuffle'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=198,i=132,j=108;function k(l,m,n,o,p,q,r){this.profileID=null;this.viewasID=null;this.places={};this.visiblePins=null;this.stories={};this.hiddenStories={};this.placesByTime=[];this.category=null;this.pending=null;this.waitingOnConfirmation=false;this.highlightedPin=null;this.arbiterListeners=[];this.calloutBeingFetched=null;this.initialized=false;this._lastResizeCalloutAnchor=null;this._lastResizeCalloutStoryHeight=null;this._lastResizeCalloutStory=null;this._scrollableCalloutController=null;this.inCreation=false;this.lastTypeaheadEvent=null;this.initialPosition=null;this.initialPlace=null;this.initialStory=null;this.hh=0;this.ww=0;this.smartPan=null;this.requestID=0;this.asyncRequests={};this.intervals=[];this.groups=[];this.pagerIndex=null;this.categoryCountUnique={};if(l)this._init(l,m,n,o,p,q,r);}Object.assign(k.prototype,{HOVER_FETCH_DELAY:100,HOVER_DISMISS_DELAY:300,MAP_BOTTOM_PADDING:40,MIN_MAP_HEIGHT:532,MIN_CALLOUT_STORY_HEIGHT:200,MAX_CALLOUT_HEIGHT:600,RESIZE_CHECK_INTERVAL:50,HOVERCARD_WIDTH:279,HOVERCARD_HEIGHT:251,HOVERCARD_CLOSED:undefined,HOVERCARD_WAITING_TO_FETCH:1,HOVERCARD_BEING_FETCHED:2,HOVERCARD_OPEN:3,HOVERCARD_WAITING_TO_DISMISS:4,TIMELINE_MAP_HOVERCARD_PLACE:'Place',TIMELINE_MAP_HOVERCARD_CITY:'City',TIMELINE_MAP_HOVERCARD_REGION:'Region',TIMELINE_MAP_HOVERCARD_COUNTRY:'Country',HOVERCARD_CITY_REGION_HEURISTIC:3,setCategory:function(l){this.logger&&this.logger.startRun('set-category');this.map.hideCallout();this.category=l;this._filter();},setCategoryCountUnique:function(l){this.categoryCountUnique=l;},getCategories:function(){var l={},m,n;for(var o in this.places){var p=this.places[o],q={};for(var r=0;r<p.stories.length;r++){n=p.stories[r];if(n.categories)for(var s=0;s<n.categories.length;s++){m=n.categories[s];if(!l[m])l[m]={count:0,name:m};if(!q[m])q[m]=1;l[m].count++;}}}return l;},zoomToVisible:function(){this.map.zoomTo(this.visiblePins);},cleanupCreationCallout:function(l){this.map.hideCallout(l);this._cleanUpHighlightedPin();},cancelCreation:function(l){if(!this.inCreation)return;this.inCreation=false;this.cleanupCreationCallout();},creationFinished:function(l,m){var n=m.place,o=m.story,p=m.showCallout;this.inCreation=false;this.waitingOnConfirmation=false;this.cleanupCreationCallout();this.addStories(null,{stories:[o],places:[n]});if(p)this.showCallout(null,{place_id:n.id,story_id:o.id});},page:function(l){var m=this.map.getGroups();if(!m)return;var n=[],o=true,p=0;for(var q=0;q<m.length;q++){var r=m[q];if(r.hasMarker()){var s=r.getCenter(),t=new (c('Rect'))(0,this.ww,this.hh,0);if(c('MapRects').containsPoint(t,s)){n.push(r);if(r===this.groups[p]){p++;}else if(o)o=false;}}}o=o&&p===this.groups.length;if(!o){this.groups=n;this.sortedGroups=n.concat([]).sort(function(v,w){return v.getCenter().x-w.getCenter().x;});if(l>0){this.pagerIndex=0;}else this.pagerIndex=-1;}else this.pagerIndex+=l>0?1:-1;this.pagerIndex=c('mod')(this.pagerIndex,this.sortedGroups.length);var u=this.sortedGroups[this.pagerIndex];if(u.pins.length>1){this._openCallout(u,this.map.throbber(325),this.map.leftRightNoPanningStrategy());u.hoverPermanent=true;u.hoverState=this.HOVERCARD_WAITING_TO_FETCH;this._fetchHovercard(u);}else this.aggregatedMapHandler_pinClick(null,u.pins[0]);},hovercard:function(l,m){var n=this._getAsyncContext(m.requestID);if(n.deleted||n.hoverState!==this.HOVERCARD_BEING_FETCHED)return;n.hoverState=this.HOVERCARD_OPEN;var o=c('DOM').create('div');o.onmouseover=function(){if(!this.map||!this.map.getCallout().getAnchor())return null;this.aggregatedMapHandler_bubbleMouseover(null,this.map.getCallout().getAnchor());}.bind(this);o.onmouseout=function(){if(!this.map||!this.map.getCallout().getAnchor())return null;this.aggregatedMapHandler_bubbleMouseout(null,this.map.getCallout().getAnchor());}.bind(this);c('CSS').setClass(o,'fbTimelineMapHovercard');c('DOM').setContent(o,m.content);if(n===this.map.getCallout().getAnchor()){this.map.getCallout().setContent(o);}else this._openCallout(n,o,this.map.leftRightNoPanningStrategy());this.map.getCallout().recalculateArrowYOffset(true);this.logger&&this.logger.endRun('load-hovercard');},callout:function(l,m){var n=this._getAsyncContext(m.requestID);if(this.map.getCallout().getAnchor()!==n)return;this._openCallout(n,m.content);this.logger&&this.logger.endRun('load-callout');},addPending:function(l,m){var n=m.count;this.pending=this.pending||0;this.pending+=n;this._checkReady();},hideCallout:function(l,m){m=m||{};m._instanceid=this.instanceID;c('Arbiter').inform('AggregatedMap/hideCallout',m);},addStories:function(l,m){var n=m.stories,o=m.places;if(m.count)this.pending=(this.pending||0)-m.count;var p,q,r,s;for(s=0;s<o.length;s++){q=new (c('TimelineMapPlace'))(o[s]);if(!this.places[q.id]){this.places[q.id]=q;this.placesByTime.push(q);}q.mostRecentTimestamp=0;}for(s=0;s<n.length;s++){r=new (c('TimelineMapStory'))(n[s]);this.stories[r.id]=r;p=r.placeID;q=this.places[p];q.stories.push(r);q.mostRecentTimestamp=Math.max(q.mostRecentTimestamp,r.timestamp);}if(m.count===undefined){this._refresh();}else this._checkReady();},updateStory:function(l,m){var n=m.place,o=m.story,p=this.stories[o.id];if(p.placeID!=n.id){var q={};q[p.id]=true;this._removeStories(p.placeID,q);this.addStories(null,{stories:[o],places:[n]});}this._showCallout(this.places[n.id].pin,n.id,o.id);},deleteStory:function(l,m){var n=this.map.getCallout().getAnchor(),o=this.stories[m];if(!o)return;var p={};p[o.id]=true;this.map.hideCallout();var q=this._removeStories(o.placeID,p);q.stories_removed&&this._refresh();!q.place_removed&&this._showCallout(n,n.place.id);},hideStory:function(l,m){var n=this.map.getCallout().getAnchor(),o=this.stories[m.story_id];if(!n)return;if(n.getType()!=='AggregatedMapPin')return;if(!o||o.placeID!=n.place.id)return;var p=c('$')(m.story_domid);c('CSS').hide(p);var q=c('DOM').insertAfter(p,m.undo_html)[0];this.hiddenStories[o.id]={story_domid:p.id,undo_domid:q.id};},undoHideStory:function(l,m){var n=this.stories[m],o=this.hiddenStories[n.id];c('DOM').remove(o.undo_domid);c('CSS').show(o.story_domid);delete this.hiddenStories[n.id];},showCallout:function(l,m){var n=this.places[m.place_id].pin;this._showCallout(n,m.place_id,m.story_id);},zoomIntoOne:function(l,m){var n=this.places[m.place_id];this._zoomToPlace(n);},zoomToArea:function(l,m){var n=m.type,o=m.key,p=[];for(var q in this.places){var r=this.places[q],s=r.pin;if(r.city===o&&n===this.TIMELINE_MAP_HOVERCARD_CITY||r.region===o&&n===this.TIMELINE_MAP_HOVERCARD_REGION||r.country===o&&n===this.TIMELINE_MAP_HOVERCARD_COUNTRY)p.push(s);}this.map.zoomInto(p);},creationFlow:function(l,m){var n=m.place,o={latitude:n.latitude,longitude:n.longitude};this.waitingOnConfirmation=false;this._highlightPlace(n.id,o);this._openCallout(this.highlightedPin,m.content,this.smartPan);this.inCreation=true;},highlightMapPlace:function(l,m){if(m.dismiss&&this.waitingOnConfirmation)return;if(m.showThrobber){this._openCallout(this.highlightedPin,this.map.throbber(),this.smartPan);return;}this.map.hideCallout();if(m.dismiss){this._cleanUpHighlightedPin();}else if(m.selected){this.waitingOnConfirmation=true;}else if(m.center)this._highlightPlace(m.placeID,m.center);this.map.setView(m);},registerScrollableCallout:function(l,m){this._scrollableCalloutController=m;},_init:function(l,m,n,o,p,q,r){this.profileID=l;this.viewasID=m.viewas;this.mapContainer=n;this.canvas=c('DOM').find(this.mapContainer,'.fbAggregatedMapContainer');this.logger=p;this.instanceID=o;this._dynamicSize=m.dynamicSize;if(m.center)this.initialPosition={latitude:m.center.lat,longitude:m.center.long};this.initialPlace=m.highlightedPlace;this.initialStory=m.highlightedStory;this.enableHovercards=m.enableHovercards;this.calloutDiv=q&&c('$')(q);this.maxCalloutHeight=this.MAX_CALLOUT_HEIGHT;if(m.maxCalloutHeight&&m.maxCalloutHeight<this.MAX_CALLOUT_HEIGHT)this.maxCalloutHeight=m.maxCalloutHeight;if(r){r.subscribe('next',this.page.bind(this,1));r.subscribe('previous',this.page.bind(this,-1));}this.border=c('$')('fbTimelineMapBorder');this._subscribe(c('PageEvents').AJAXPIPE_ONUNLOAD,this._onBeforeLeave.bind(this));this._subscribe('AggregatedMap/ready',this._onInit.bind(this));this._subscribe('AggregatedMap/calloutHidden',this.cancelCreation.bind(this));this._subscribe('AggregatedMap/calloutHidden',c('shield')(c('Arbiter').inform,null,'reflow'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadFocus',this._handleTypeahead.bind(this,'focus'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadBlur',this._handleTypeahead.bind(this,'blur'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadSelect',this._handleTypeahead.bind(this,'select'));},_onInit:function(l,m){this.map=m;if(this._dynamicSize){this._resizeMap();this.intervals=[setInterval(this._resizeMap.bind(this),this.RESIZE_CHECK_INTERVAL),setInterval(this.resizeCallout.bind(this),this.RESIZE_CHECK_INTERVAL)];}else{this.hh=this.map.getHeight();this.ww=this.map.getWidth();}this.initialized=true;for(var n in k.Listeners)this._subscribe('TimelineMap/'+n,this[n].bind(this));for(var o in c('AggregatedMap').Events){var p=this['aggregatedMapHandler_'+o];if(p){p=p.bind(this);this._subscribe('AggregatedMap/'+o,p);}}this.smartPan=this.map.smartPanningStrategy();},_getAsyncContext:function(l){var m=this.asyncRequests[l];delete this.asyncRequests[l];return m;},_storeAsyncContext:function(l){var m=this.requestID++;this.asyncRequests[m]=l;return m;},_inform:function(l,m,n){m=m||{};m._instanceid=this.instanceID;k.inform('TimelineMap/'+l,m,n);},_cleanUpHighlightedPin:function(){if(this.highlightedPin){if(this.highlightedPin.isPreview){this.map.removePin(this.highlightedPin);}else{this.highlightedPin.setSprite(this._getPlaceSprite(this.highlightedPin.place));this.map.redraw();}this.highlightedPin=null;c('CSS').removeClass(this.canvas,'fbTimelineMapDimPinMode');}},_handleTypeahead:function(l){!this.inCreation&&l=='blur'&&this.lastTypeaheadEvent=='focus';this.lastTypeaheadEvent=l;},_checkReady:function(){if(this.pending!==0)return;this._refresh();if(this.logger){window._cstart&&this.logger.set('flushTTI',Date.now()-window._cstart);for(var l in this.places){var m=this.places[l];this.logger.bump('places');this.logger.bump('stories',m.count());}this.logger.set('profileID',this.profileID);}if(window.CavalryLogger)window.CavalryLogger.getInstance().measurePageLoad(true);var n=this.initialPlace,o=this.initialStory;if(n){this.map.zoomTo(this.visiblePins,false);this.map.setInitialView();var p=this.places[n].pin;if(p){var q=new (c('Vector'))(h,i);q=q.sub(new (c('Vector'))(this.ww/2,this.hh/2));this.map.zoomIntoOne(p,q);var r=c('DOM').find(this.calloutDiv,'.fbTimelineMapCallout');c('DOM').remove(this.calloutDiv);this._openCallout(p,r);this.map.getCallout().setArrowYOffset(j);this.map.updateCallouts();}}else if(this.initialPosition){this.map.setView({center:this.initialPosition});}else{this.map.zoomTo(this.visiblePins,false);this.map.setInitialView();}c('CSS').addClass(this.border,'fbTimelineMapContainerLoaded');},_refresh:function(){this.placesByTime=this.placesByTime.sort(function(l,m){return l.mostRecentTimestamp-m.mostRecentTimestamp;});this._filter();this._inform(k.Events.updateCategories,null,c('Arbiter').BEHAVIOR_STATE);},_resizeMap:function(){var l=c('Vector').getViewportDimensions().y,m=c('Vector').getElementPosition(this.border).y,n=c('Vector').getElementDimensions(this.border).y,o=l-(m+n),p=this.hh+o-this.MAP_BOTTOM_PADDING;p=Math.max(this.MIN_MAP_HEIGHT,Math.min(p,l));if(Math.abs(this.hh-p)>1){c('Style').set(this.mapContainer,'height',p+'px');this.map.invalidateSize();this.hh=p;this.ww=this.map.ww;this._resizeMap();}},resizeCallout:function(){var l=this.map.getCallout().getContent(),m=c('DOM').scry(l,'.fbTimelineMapScrollableStory');for(var n=m.length-1;n>=0;n--)if(!c('CSS').hasClass(m[n],'hidden_elem')){var o=m[n],p=c('DOM').find(o,'.fbTimelineMapCalloutStory');break;}if(!(l&&p&&o))return;var q=c('Vector').getElementDimensions(p).y;if(this.map.getCallout().getAnchor()===this._lastResizeCalloutAnchor&&q===this._lastResizeCalloutStoryHeight&&p===this._lastResizeCalloutStory)return;var r=c('DOM').find(l,'.fbTimelineMapCalloutHeader'),s=c('Vector').getElementDimensions(r).y,t=c('Vector').getElementPosition(o).y,u=c('Vector').getElementPosition(this.mapContainer).y,v=this.hh-this.map.CALLOUT_MARGIN,w=Math.max(this.MIN_CALLOUT_STORY_HEIGHT,Math.min(u+v-t,v-s)),x=Math.min(q,w,this.maxCalloutHeight);c('Style').set(o,'height',x+'px');this._lastResizeCalloutAnchor=this.map.getCallout().getAnchor();this._lastResizeCalloutStoryHeight=q;this._lastResizeCalloutStory=p;if(this._scrollableCalloutController)this._scrollableCalloutController.adjustGripper();this.map.getCallout()._updateDimensions();this.map.getCallout().recalculateArrowYOffset();},_filter:function(){var l=[];for(var m in this.places){var n=this.places[m];n.setFilters(this.category);if(n.count()>0){var o=this._getPlaceSprite(n),p=c('AggregatedMapPin').create(n,o,n.name);n.pin=p;p.place=n;l.push(p);}}this.visiblePins=l;if(this.highlightedPin)this.visiblePins.push(this.highlightedPin);this.map.setPins(l);},_getPlaceSprite:function(l){var m=l.getStories(),n=m.length,o;if(n>=100){o=c('AggregatedMapRedPinSprite').largeBlank(n);}else if(n>10){o=c('AggregatedMapRedPinSprite').mediumBlank(n);}else if(n>1){o=c('AggregatedMapRedPinSprite').smallBlank(n);}else if(m[0]&&m[0].pin){o=c('AggregatedMapRedPinSprite').mediumBlank(1);o.text=false;o.image=m[0].pin+'.png';}else o=c('AggregatedMapRedPinSprite').dot();return o;},_getHighlightedSprite:function(){var l=c('AggregatedMapRedPinSprite').dot();l.aggregationRadius=0;l.css='fbTimelineMapHighlighted';return l;},_highlightPlace:function(l,m){this._cleanUpHighlightedPin();var n;if(l&&this.places[l]!==undefined){n=this.places[l].pin;n.setSprite(this._getHighlightedSprite());this.map.redraw();}else{n=new (c('AggregatedMapPin'))(c('LegacyMapCoordinate').fromLatLong(m),this._getHighlightedSprite());n.isPreview=true;this.map.addPin(n);}this.highlightedPin=n;c('CSS').addClass(this.canvas,'fbTimelineMapDimPinMode');return n;},_showCallout:function(l,m,n){if(this.map.getCallout()&&this.map.getCallout().getOrientation()){var o=this.map.getCallout().getOrientation()===c('AggregatedMapCalloutOrientation').LEFT,p=new (c('Vector'))(o?200:-200,-100);this.map.zoomIntoOne(l,p);}this._openCallout(l,this.map.throbber(),this.smartPan);this._fetchCallout(l,m,n);},_fetchCallout:function(l,m,n){this.logger&&this.logger.startRun('load-callout');var o=this._storeAsyncContext(l),p=this.places[m],q=[],r={},s=p.getStories();for(var t=0;t<s.length;++t){var u=s[t];if(!u.isEnt){q.push(u.unitParams);}else{r[u.storyType]=r[u.storyType]||[];r[u.storyType].push(u.id);}}var v={profile_id:this.profileID,targetid:p.id,storyid:n,unitparams:q,storiesbytype:r,request_id:o};if(this.viewasID&&this.viewasID!="0")v.viewas=this.viewasID;new (c('AsyncRequest'))().setURI('/ajax/timeline/map/callout.php').setMethod('POST').setData(v).send();},_openCallout:function(l,m,n){var o=this.map.getCallout().getAnchor();o&&this._dismissHovercard(o);this.map.openCallout(l,m,n);this.resizeCallout();},_zoomToPlace:function(l){var m=c('AggregatedMapCalloutOrientation').LEFT,n=c('AggregatedMapCalloutOrientation').RIGHT,o=this.map.getCallout().getOrientation()===m,p=new (c('Vector'))(o?200:-200,-100);this.map.zoomIntoOne(l.pin,p);this._openCallout(l.pin,this.map.throbber(),this.map.noPanningStrategy(o?m:n));this._fetchCallout(l.pin,l.id);},_fetchHovercard:function(l){this.logger&&this.logger.startRun('load-hovercard');if(l.deleted||l.hoverState!==this.HOVERCARD_WAITING_TO_FETCH)return;if(l.pins.length<2)throw 'bubble has < 2 pins!';delete l.timeoutToken;l.hoverState=this.HOVERCARD_BEING_FETCHED;var m=[],n=[],o={},p={},q={},r={},s={},t={};l.pins.forEach(function(qa){var ra=qa.place,sa=ra.getStories();t[ra.id]=true;for(var ta=0;ta<sa.length;ta++)m.push(sa[ta]);n.push(ra);if(ra.city){o[ra.city]=o[ra.city]||0;o[ra.city]++;if(ra.region)s[ra.region]=ra.city;if(ra.country)r[ra.country]=ra.city;}if(ra.region){p[ra.region]=p[ra.region]||0;p[ra.region]++;}if(ra.country){q[ra.country]=q[ra.country]||0;q[ra.country]++;}});var u=n.length,v=this._storeAsyncContext(l),w=this._getStoriesByType(m).TimelineMapStoryPhoto||[],x=w.length,y=c('randomShuffle')(w).slice(0,4),z={},aa=n.length<=3,ba=n.sort(function(qa,ra){return ra.getStories().length-qa.getStories().length;}).slice(0,3).map(function(qa){var ra=0,sa={},ta=qa.getStories();for(var ua=0;ua<ta.length;ua++){var va=ta[ua],wa=va.visitID;if(wa===0){ra++;}else if(!(wa in sa)){sa[wa]=true;ra++;}}z[qa.id]=ra;return qa.id;}),ca=false,da=false,ea=false;for(var fa in this.places){var ga=this.places[fa];if(!t[ga.id]&&(ea=ea||q[ga.country])&&(da=da||p[ga.region])&&(ca=ca||o[ga.city]))break;}var ha=null,ia=null,ja=null,ka=null,la=null,ma=function(qa,ra,sa){return qa[sa]-qa[ra];};o=Object.keys(o).sort(ma.bind(null,o));p=Object.keys(p).sort(ma.bind(null,p));q=Object.keys(q).sort(ma.bind(null,q));var na={};na[this.TIMELINE_MAP_HOVERCARD_COUNTRY]=q.map(function(qa){return r[qa];});na[this.TIMELINE_MAP_HOVERCARD_REGION]=p.map(function(qa){return s[qa];});na[this.TIMELINE_MAP_HOVERCARD_CITY]=o;na[this.TIMELINE_MAP_HOVERCARD_PLACE]=n.map(function(qa){return qa.id;});if(q.length>0)if(!ea){ia=this.TIMELINE_MAP_HOVERCARD_COUNTRY;if(q.length>1){ka=this.TIMELINE_MAP_HOVERCARD_COUNTRY;}else if(p.length>1){ka=this.TIMELINE_MAP_HOVERCARD_REGION;}else ka=this.TIMELINE_MAP_HOVERCARD_CITY;}if(p.length>0&&!ia){var oa=this.HOVERCARD_CITY_REGION_HEURISTIC;if(!da||p.length>1&&o.length>p.length*oa){ia=this.TIMELINE_MAP_HOVERCARD_REGION;if(p.length>1){ka=this.TIMELINE_MAP_HOVERCARD_REGION;}else ka=this.TIMELINE_MAP_HOVERCARD_CITY;}}if(o.length>0&&!ia)if(!ca||o.length>1){ia=this.TIMELINE_MAP_HOVERCARD_CITY;if(o.length>1){ka=this.TIMELINE_MAP_HOVERCARD_CITY;}else la=n.length;}if(!ia){ia=this.TIMELINE_MAP_HOVERCARD_PLACE;la=-1;}ha=na[ia];if(ka)ja=na[ka];var pa={profile_id:this.profileID,request_id:v,target_count:u,photo_count:x,photo_ids:y,place_counts:z,target_ids:ba,all_places:aa,ids:ha,title_type:ia,subtitle_count:la,links:ja,link_type:ka};if(this.viewasID&&this.viewasID!="0")pa.viewas=this.viewasID;new (c('AsyncRequest'))().setURI('/ajax/timeline/map/hovercard.php').setMethod('POST').setData(pa).send();},_dismissHovercard:function(l){delete l.timeoutToken;delete l.hoverState;delete l.hoverPermanent;if(this.map.getCallout().getAnchor()===l)this.map.hideCallout();},_getStoriesByType:function(l){var m={};l.forEach(function(n){m[n.storyType]=m[n.storyType]||[];m[n.storyType].push(n.isEnt?n.id:n.unitParams);});return m;},_removeStories:function(l,m){var n=0,o=false,p=this.places[l],q=[],r;for(r=0;r<p.stories.length;++r){var s=p.stories[r];if(m[s.id]){delete this.stories[s.id];++n;}else q.push(s);}if(q.length===0){delete this.places[l];o=true;}else p.stories=q;return {place_removed:o,stories_removed:n};},_removeHiddenStories:function(){var l=this.map.getCallout().getAnchor();if(!l)return;if(l.getType()!=='AggregatedMapPin')return;if(c('isEmpty')(this.hiddenStories))return;var m=l.place.id,n=this._removeStories(m,this.hiddenStories);if(n.stories_removed!==0){this._refresh();this.hiddenStories={};}},_guard:function(l){return function(m,n){if(!n||!n._instanceid||n._instanceid===this.instanceID)l(m,n);}.bind(this);},_subscribe:function(l,m){this.arbiterListeners.push(c('Arbiter').subscribe(l,this._guard(m)));},aggregatedMapHandler_mapClick:function(){this._removeHiddenStories();this.map.hideCallout();this._inform(k.Events.mapClick);},aggregatedMapHandler_pinClick:function(l,m){this.logger&&this.logger.bumpTap('pin-click');this._removeHiddenStories();if(this.map.getCallout().getAnchor()===m){this.map.hideCallout();}else this._showCallout(m,m.place.id);},aggregatedMapHandler_bubbleClick:function(l,m){this.logger&&this.logger.bumpTap('bubble-click');this.map.hideCallout();this.map.zoomInto(m.pins);},aggregatedMapHandler_bubbleMouseover:function(l,m){if(!this.enableHovercards||m.hoverPermanent)return;if(!m.hoverState||m.hoverState===this.HOVERCARD_CLOSED){m.hoverState=this.HOVERCARD_WAITING_TO_FETCH;m.timeoutToken=setTimeout(this._fetchHovercard.bind(this,m),this.HOVER_FETCH_DELAY);}else if(m.hoverState===this.HOVERCARD_WAITING_TO_DISMISS){clearTimeout(m.timeoutToken);delete m.timeoutToken;m.hoverState=this.HOVERCARD_OPEN;}},aggregatedMapHandler_bubbleMouseout:function(l,m){if(m.hoverPermanent)return;if(m.hoverState===this.HOVERCARD_WAITING_TO_FETCH||m.hoverState===this.HOVERCARD_BEING_FETCHED){clearTimeout(m.timeoutToken);delete m.timeoutToken;delete m.hoverState;}else if(m.hoverState===this.HOVERCARD_OPEN){m.timeoutToken=setTimeout(this._dismissHovercard.bind(this,m),this.HOVER_DISMISS_DELAY);m.hoverState=this.HOVERCARD_WAITING_TO_DISMISS;}},_onBeforeLeave:function(){for(var l=0;l<this.arbiterListeners.length;l++)this.arbiterListeners[l].unsubscribe();for(var m=0;m<this.intervals.length;m++)clearInterval(this.intervals[m]);this.logger=null;this.map=null;this.places=null;}});Object.assign(k,{Events:{updateCategories:'updateCategories',mapClick:'mapClick'},Listeners:{addStories:'addStories',updateStory:'updateStory',deleteStory:'deleteStory',hideStory:'hideStory',undoHideStory:'undoHideStory',addPending:'addPending',creationFlow:'creationFlow',cleanupCreationCallout:'cleanupCreationCallout',cancelCreation:'cancelCreation',creationFinished:'creationFinished',showCallout:'showCallout',callout:'callout',resizeCallout:'resizeCallout',hovercard:'hovercard',highlightMapPlace:'highlightMapPlace',registerScrollableCallout:'registerScrollableCallout',zoomToVisible:'zoomToVisible',hideCallout:'hideCallout',zoomIntoOne:'zoomIntoOne',zoomToArea:'zoomToArea'},inform:function(l,m,n){if(!m||!m._instanceid)return;return c('Arbiter').inform(l,m,n||c('Arbiter').BEHAVIOR_PERSISTENT);}});f.exports=k;},null);
__d('TimelinePlacesSubCollection',['cx','Arbiter','CSS','Event','TimelineMapController','tidyEvent'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i="_3s-";function j(k){'use strict';this.$TimelinePlacesSubCollection1=k.id;this.$TimelinePlacesSubCollection2=k.parent_collection;this.$TimelinePlacesSubCollection3=k.sub_tab;this.$TimelinePlacesSubCollection4=k.entity_id;this.$TimelinePlacesSubCollection5=k.collection_token;this.$TimelinePlacesSubCollection6=k.profile_id;this.$TimelinePlacesSubCollection7=k.places_filter;this.$TimelinePlacesSubCollection8=k.city_id;this.$TimelinePlacesSubCollection9=null;this.$TimelinePlacesSubCollection10=0;this.$TimelinePlacesSubCollection11=0;}j.prototype.hide=function(){'use strict';this.$TimelinePlacesSubCollection3&&c('CSS').hasClass(this.$TimelinePlacesSubCollection3,i)&&c('CSS').removeClass(this.$TimelinePlacesSubCollection3,i);var k=this.$TimelinePlacesSubCollection2.getMapInstanceID();if(k!=null)c('Arbiter').inform('TimelineMap/hideCallout',{_instanceid:k},c('Arbiter').BEHAVIOR_PERSISTENT);};j.prototype.show=function(){'use strict';!c('CSS').hasClass(this.$TimelinePlacesSubCollection3,i)&&c('CSS').addClass(this.$TimelinePlacesSubCollection3,i);this.$TimelinePlacesSubCollection12();c('Arbiter').subscribe('AggregatedMap/ready',this.$TimelinePlacesSubCollection13(this.$TimelinePlacesSubCollection12.bind(this)));};j.prototype.getSubTabNode=function(){'use strict';return this.$TimelinePlacesSubCollection3;};j.prototype.getParentCollection=function(){'use strict';return this.$TimelinePlacesSubCollection2;};j.prototype.getEntityID=function(){'use strict';return this.$TimelinePlacesSubCollection4;};j.prototype.$TimelinePlacesSubCollection12=function(){'use strict';var k=this.$TimelinePlacesSubCollection2.getMapInstanceID();if(k==null)return;c('Arbiter').inform('TimelineMap/zoomToArea',{_instanceid:k,type:c('TimelineMapController').prototype.TIMELINE_MAP_HOVERCARD_CITY,key:this.$TimelinePlacesSubCollection8},c('Arbiter').BEHAVIOR_PERSISTENT);};j.prototype.$TimelinePlacesSubCollection13=function(k){'use strict';return function(l,m){if(!m||!m.$TimelinePlacesSubCollection14||m.$TimelinePlacesSubCollection14===this.$TimelinePlacesSubCollection2.getMapInstanceID())k(l,m);}.bind(this);};j.prototype.$TimelinePlacesSubCollection15=function(){'use strict';if(this.getParentCollection().getActiveSubCollection()===this)return true;return false;};j.build=function(k,l,m,n,o,p,q){'use strict';if(k!=null&&l&&m&&m.sub_tab&&m.entity_id!=null&&n&&o!=null&&p!=null&&q!=null){var r={id:k,parent_collection:l,sub_tab:m.sub_tab,entity_id:m.entity_id,collection_token:n,profile_id:o,places_filter:p,city_id:q},s=new j(r);c('tidyEvent')(c('Event').listen(s.getSubTabNode(),'click',function(t){s.getParentCollection().setActiveSubCollection(s);}));return s;}return null;};f.exports=j;},null);
__d('TimelinePlacesCollection',['csx','cx','CSS','DOM','DOMDimensions','DOMQuery','MenuItem','TimelineAppCollection','TimelinePlacesSubCollection','ProfileOverviewSection'],function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=820;j=babelHelpers.inherits(m,c('TimelineAppCollection'));k=j&&j.prototype;function m(n){'use strict';k.constructor.call(this,n);this.$TimelinePlacesCollection1=n.token;this.$TimelinePlacesCollection2=null;this.$TimelinePlacesCollection3=null;this.$TimelinePlacesCollection4=[];this.$TimelinePlacesCollection5=null;this.$TimelinePlacesCollection6=null;}m.prototype.show=function(){'use strict';this.$TimelinePlacesCollection2&&c('CSS').show(this.$TimelinePlacesCollection2);};m.prototype.hide=function(){'use strict';this.$TimelinePlacesCollection2&&c('CSS').hide(this.$TimelinePlacesCollection2);};m.prototype.setActiveSubCollection=function(n){'use strict';this.$TimelinePlacesCollection3&&this.$TimelinePlacesCollection3.hide();this.$TimelinePlacesCollection3=n;this.$TimelinePlacesCollection3&&this.$TimelinePlacesCollection3.show();};m.prototype.getSubCollectionWithID=function(n){'use strict';if(0<=n&&this.$TimelinePlacesCollection4&&n<this.$TimelinePlacesCollection4.length)return this.$TimelinePlacesCollection4[n];return null;};m.prototype.getMapInstanceID=function(){'use strict';return this.$TimelinePlacesCollection6;};m.prototype.getActiveSubCollection=function(){'use strict';return this.$TimelinePlacesCollection3;};m.prototype.$TimelinePlacesCollection7=function(n){'use strict';if(!n)throw new Error("Don't provide enough information to register sub-collections.");this.$TimelinePlacesCollection8(n);};m.prototype.$TimelinePlacesCollection9=function(n){'use strict';if(!n.sub_collections_filter)throw Error("No sub-collection filter is specified.");if(n.map_instance_id==null)throw Error('No instance id of the map is specified.');this.$TimelinePlacesCollection6=n.map_instance_id;this.$TimelinePlacesCollection8({filter:n.sub_collections_filter});};m.prototype.$TimelinePlacesCollection8=function(n){'use strict';this.$TimelinePlacesCollection5=babelHelpers['extends']({},this.$TimelinePlacesCollection5,n);var o=this.$TimelinePlacesCollection5;if(!o.sub_collections||!o.sub_collections.length||!o.filter||!this.$TimelinePlacesCollection1||o.profile_id==null||!o.more_popover_menu||!o.more_menu)return;for(var p=0;p<o.sub_collections.length;p++){var q=null,r=o.sub_collections[p].city_id;if(r&&o.filter[r])q=c('TimelinePlacesSubCollection').build(this.$TimelinePlacesCollection4.length,this,o.sub_collections[p],this.$TimelinePlacesCollection1,o.profile_id,o.filter[r],r);if(q)this.$TimelinePlacesCollection4.push(q);}if(this.$TimelinePlacesCollection4.length){this.$TimelinePlacesCollection10(this.$TimelinePlacesCollection4,o.more_popover_menu,o.more_menu);setTimeout(function(){this.setActiveSubCollection(this.$TimelinePlacesCollection4[0]);}.bind(this),2000);}};m.prototype.$TimelinePlacesCollection10=function(n,o,p){'use strict';var q=c('DOMQuery').find(this.getParentSection().getNode(),"._33hy");if(!q)return;var r=c('DOM').create('div',{className:"_33hy"});c('DOM').replace(q,r);this.$TimelinePlacesCollection2=r;this.$TimelinePlacesCollection11(r,n,o,p);};m.prototype.$TimelinePlacesCollection11=function(n,o,p,q){'use strict';var r=0;for(var s=0;s<o.length;s++)if(o[s].getSubTabNode()){c('DOM').appendContent(n,o[s].getSubTabNode());r+=c('DOMDimensions').getElementDimensions(o[s].getSubTabNode()).width;}c('DOM').appendContent(n,p);r+=c('DOMDimensions').getElementDimensions(p).width;if(r<=l){c('CSS').hide(p);}else{var t=o.length-1;while(r>l){if(t<0)return;r-=c('DOMDimensions').getElementDimensions(o[t].getSubTabNode()).width;c('DOM').remove(o[t].getSubTabNode());var u=new (c('MenuItem'))({markup:o[t].getSubTabNode()});if(q.getItemAt(0)){q.addItemBefore(u,q.getItemAt(0));}else q.addItem(u);t--;}}};m.registerSubCollections=function(n){'use strict';this.checkCollectionID(n.collection_id);c('ProfileOverviewSection').callWithSection(n.collection_id,function(o){if(o)o.$TimelinePlacesCollection7(n);});};m.registerSubCollectionsFilter=function(n){'use strict';this.checkCollectionID(n.collection_id);c('ProfileOverviewSection').callWithSection(n.collection_id,function(o){if(o)o.$TimelinePlacesCollection9(n);});};m.checkCollectionID=function(n){'use strict';if(n==null)throw new Error("No collection id is specified when trying to access"+" a static function in TimelinePlacesCollection.");};f.exports=m;},null);
__d('TimelineAppCollectionFactory',['TimelineAppCollection','TimelinePlacesCollection'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='map';function i(){'use strict';}i.createFromArray=function(j,k){'use strict';return k.map(function(l){if(j===h)return new (c('TimelinePlacesCollection'))(l);return new (c('TimelineAppCollection'))(l);});};f.exports=i;},null);
__d('TimelineMonitor',['Arbiter','Event','Run','Vector','ViewportBounds','ge','queryThenMutateDOM'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i={},j=0,k=[],l=null,m=false;function n(){h={};i={};j=0;k.length=0;l&&l.remove();l=null;m=false;}function o(){if(!l)l=c('Event').listen(window,'scroll',t);if(!m){c('Run').onLeave(n);m=true;}t();}var p=[],q=[];function r(){k.forEach(function(y){var z=u.getSection(y);if(z&&z!==i[y.id]){i[y.id]=z;p.push({section:z});}});var v=c('ViewportBounds').getTop()+c('Vector').getScrollPosition().y;for(var w in h){var x=h[w];if(v>=x.boundary&&j<=x.boundary||v<=x.boundary&&j>=x.boundary){h[w].fromAbove=j<v;q.push(h[w]);}}j=v;}function s(){p.forEach(function(v){c('Arbiter').inform(u.SECTION_CHANGE,v);});q.forEach(function(v){c('Arbiter').inform(u.BOUNDARY_PASSED,v);});p.length=0;q.length=0;}function t(){c('queryThenMutateDOM')(r,s,'TimelineMonitor/scroll');}var u={BOUNDARY_PASSED:'TimelineMonitor/boundary',SECTION_CHANGE:'TimelineMonitor/change',getSection:function(v){var w=c('ViewportBounds').getTop()+c('Vector').getScrollPosition().y,x=v.childSections.getHead();while(x){if(c('ge')(x.nodeID)&&w<c('Vector').getElementPosition(x.getNode()).y+c('Vector').getElementDimensions(x.getNode()).y)return x;x=x.getNext();}},monitorBoundary:function(v,w){w=w||v;if(!h[w]||h[w].boundary!==v){h[w]={boundary:v,id:w};o();}},monitorSection:function(v){i[v.id]=null;k.push(v);o();return u.getSection(v);},poke:function(v){t();}};f.exports=u;},null);
__d('TimelineAppSection',['csx','cx','fbt','AppSectionCurationState','Arbiter','CSS','DOM','DOMQuery','DOMScroll','JSLogger','ProfileOverviewDOMID','MedleyPageletRequestData','PageletSet','Style','TidyArbiter','TidyArbiterMixin','TimelineAppCollectionFactory','TimelineAppSectionCuration','TimelineDynamicSection','TimelineMonitor','ProfileOverviewSection','TimelineSmartInsert','TriggerablePageletLoader','ViewportBounds','classWithMixins','ge','mixin'],function a(b,c,d,e,f,g,h,i,j){var k,l;if(c.__markCompiled)c.__markCompiled();var m=500,n=2,o=500,p=18,q="_5bry",r="_3s-",s=c('DOM').create('div',{className:"_3s_"});function t(){return c('DOM').create('span',{className:"_3s18"},[c('DOM').create('a',{className:"_3s19",href:'#'},j._("M\u00e1s")),c('DOM').create('span',{className:"_3s1a"})]);}var u=c('JSLogger').create('collections'),v={notes:295,events:345,photos:555,app_quoraapp:569,fitness:619,friends:603,app_foodspotting:621,map:621,favorites:645,app_pinterestapp:699,app_instapp:699,books:699,movies:699,tv:699,music:725};function w(y){return v[y.replace(c('ProfileOverviewDOMID').PREFIX_MEDLEY,'')];}k=babelHelpers.inherits(x,c('classWithMixins')(c('TimelineDynamicSection'),c('mixin')(c('TidyArbiterMixin'))));l=k&&k.prototype;function x(y,z,aa,ba){'use strict';l.constructor.call(this,x.getIDBySK(z),y,aa);this._sk=z;this._title=ba;}x.prototype._createNode=function(){'use strict';var y=l._createNode.call(this);y.setAttribute('aria-labelledby',c('ProfileOverviewDOMID').PREFIX_MEDLEY_HEADER+this._sk);y.setAttribute('aria-role','region');c('DOM').prependContent(y,c('DOM').create('div',{className:"_3cz"},[this._title,c('DOM').create('div',{className:"_3dc",'aria-role':'tablist'})]));this.resetMinHeight(y);return y;};x.prototype.addAuxContent=function(y){'use strict';var z=c('DOMQuery').scry(this.getNode(),"._6ph")[0];z&&c('DOM').appendContent(z,y);this._activeCollection&&this._checkTabDimensions(this._activeCollection);};x.prototype.nullStateCurationContent=function(){'use strict';if(!this._nullStateContent)return;var y=c('DOMQuery').find(this.getNode(),"._1_cb");c('DOM').replace(y.firstChild,this._nullStateContent);};x.prototype.addCurationContent=function(y,z,aa,ba){'use strict';ba=ba?ba:0;var ca=c('DOMQuery').scry(this.getNode(),"._1_cb"),da=ba<ca.length?ca[ba]:null;da&&c('DOM').appendContent(da,y);if(aa)this._nullStateContent=aa;this.checkCurationContent(z);};x.prototype.createTriggerLoader=function(y){'use strict';var z=function(aa){this._parentSection._lastLoadedSection=this;this.setIsLoaded(true);c('TimelineSmartInsert').enable();c('TimelineSmartInsert').run(this.getNode(),function(){aa();this.unsetMinHeight();c('TimelineMonitor').poke(this._parentSection.id);}.bind(this),'viewport');}.bind(this);c('TidyArbiter').subscribe('Medley/requestDataSet',function(){this._triggerLoader=new (c('TriggerablePageletLoader'))({controller:this._controller,data:this.getData(),displayCallback:z,options:{constHeight:true},node:this.getNode()},[{node:this.getNode(),onVisibleBuffer:m,onVisibleStrict:true,type:y?c('TriggerablePageletLoader').TRIGGER_NOW:c('TriggerablePageletLoader').TRIGGER_ONVISIBLE}]);}.bind(this));};x.prototype.freeze=function(){'use strict';c('CSS').addClass(this.getNode(),"_c4e");if(c('ge')(this.nodeID)&&!this.isLoaded())this._triggerLoader&&this._triggerLoader.disableTriggers();this.freezeChildren();};x.prototype.getData=function(){'use strict';if(!this._data)this._data=babelHelpers['extends']({sk:this._sk},c('MedleyPageletRequestData').get(),{overview:!this.isActiveAppSection()});return this._data;};x.prototype.isActiveAppSection=function(){'use strict';return this._parentSection._sk===this._sk;};x.prototype.getActiveCollection=function(){'use strict';return this._activeCollection;};x.prototype.remove=function(){'use strict';if(c('PageletSet').hasPagelet(this.id))c('PageletSet').removePagelet(this.id);c('DOM').remove(this.getNode());this._parentSection.removeChildSection(this.id);};x.prototype.setActiveCollection=function(y){'use strict';if(this._activeCollection===y||!y._tabNode)return;if(this._activeCollection){c('Arbiter').inform('TimelineSideAds/refresh');u.log('change_collection',{previous_collection:this._activeCollection.getToken(),new_collection:y.getToken()});this.hideCollection(this._activeCollection);var z=c('DOM').scry(this._activeCollection._tabNode,"div._3s_"),aa=s;if(z.length>0)aa=z[0];c('DOM').appendContent(y._tabNode,aa.cloneNode(true));z.forEach(c('DOM').remove);}this._activeCollection=y;this.showCollection(this._activeCollection);};x.prototype.hideCollection=function(y){'use strict';if(y){if(y.getRootClass())c('CSS').removeClass(this.getNode(),y.getRootClass());this.resetMinHeight();y.disableContentLoader();c('CSS').hide(y.getNode());c('CSS').removeClass(y._tabNode,r);y.auxContent&&c('CSS').hide(y.auxContent);y.curationContent&&c('CSS').hide(y.curationContent);y._tabNode.setAttribute('aria-selected','false');}};x.prototype.showCollection=function(y){'use strict';if(y.getRootClass())c('CSS').addClass(this.getNode(),y.getRootClass());y.auxContent&&c('CSS').show(y.auxContent);this.checkCurationContent(y);c('CSS').addClass(y._tabNode,r);this._checkTabDimensions(y);x.inform('changeCollection');if(!c('ge')(y.nodeID))c('DOM').appendContent(c('DOMQuery').find(this.getNode(),"div._3i9"),y.getNode());c('CSS').show(y.getNode());y.isLoaded()&&this.unsetMinHeight();y._tabNode.setAttribute('aria-selected','true');y.enableContentLoader();var z=x.getIDBySK(this._sk),aa=c('TimelineAppSectionCuration').getSectionState(z);if(aa)c('TimelineAppSectionCuration').refreshState(aa,z);};x.prototype.resetMinHeight=function(y){'use strict';y||(y=this.getNode());var z=w(this.id)||y.offsetHeight-n;z>0&&this._updateScrollAfterHeight(y,z);};x.prototype.scrollTo=function(y,z){'use strict';var aa=c('ViewportBounds').getElementPosition(this.getNode());aa.y-=y||p;z&&this._parentSection.toggleScrollLoad(false);c('DOMScroll').scrollTo(aa,o,null,null,0,function(){aa=c('ViewportBounds').getElementPosition(this.getNode());aa.y-=y||p;c('DOMScroll').scrollTo(aa);z&&this._parentSection.toggleScrollLoad(true);}.bind(this));};x.prototype.thaw=function(){'use strict';c('CSS').removeClass(this.getNode(),"_c4e");this._triggerLoader&&this._triggerLoader.enableTriggers();this.thawChildren();};x.prototype.unsetMinHeight=function(){'use strict';this._updateScrollAfterHeight(this.getNode(),0);};x.prototype._updateScrollAfterHeight=function(y,z){'use strict';c('Style').set(y,'min-height',z+'px');c('Arbiter').inform('reflow');};x.prototype.checkCurationContent=function(y){'use strict';var z=c('DOMQuery').scry(this.getNode(),"._2zh3")[0];if(z){c('CSS').conditionShow(z,y.curationContent);if(y.curationContent){c('CSS').show(y.curationContent);if(y.curationContentState&&y===this._activeCollection)c('TimelineAppSectionCuration').informState(y.curationContentState,this.id,y.getToken(),y.curationContentState!=c('AppSectionCurationState').hide);}else c('TimelineAppSectionCuration').informState(c('AppSectionCurationState').hide,this.id,y.getToken(),true);}};x.prototype._getTabObj=function(){'use strict';if(!this._tabObj){this._tabObj={aux:c('DOM').find(this.getNode(),"._6ph"),items:[],nav:c('DOM').find(this.getNode(),"._1_ca"),tabs:c('DOM').find(this.getNode(),"._3dc"),width:0};c('CSS').addClass(this._tabObj.tabs,"_5brz");}return this._tabObj;};x.prototype._checkTabDimensions=function(y){'use strict';var z=this._getTabObj(),aa=z.nav.offsetWidth-z.aux.offsetWidth;if(aa>=z.width){if(!z.hidden&&aa-z.tabs.offsetWidth>=0)return;c('CSS').removeClass(z.tabs,q);}if(z.hidden&&y._tabNode.parentNode===z.overflow){c('DOM').prependContent(z.overflow,z.dropdown.previousSibling);c('DOM').insertBefore(z.dropdown,y._tabNode);}if(aa-z.tabs.offsetWidth>=0&&!z.hidden)return;var ba=z.items.length;if(ba&&z.hidden){for(var ca=0;ca<ba;ca++)c('DOM').appendContent(z.tabs,z.items[ca]);c('DOM').remove(z.dropdown);}c('CSS').conditionClass(z.tabs,q,aa-z.tabs.offsetWidth<0);z.width=aa;z.hidden=0;if(aa-z.tabs.offsetWidth>=0)return;if(!z.dropdown){z.dropdown=t();z.overflow=c('DOM').find(z.dropdown,"._3s1a");z.items=c('DOM').scry(this.getNode(),"._3c_");ba=z.items.length;}c('DOM').appendContent(z.tabs,z.dropdown);var da=0;for(ca=ba-1;ca>0&&da<=0;ca--)if(z.items[ca]!==y._tabNode){c('DOM').prependContent(z.overflow,z.items[ca]);da=aa-z.tabs.offsetWidth;z.hidden++;}};x.createFromArray=function(y){'use strict';return y.map(function(z){return new x(z.controller,z.sk,z.label,z.title);});};x.getIDBySK=function(y){'use strict';return c('ProfileOverviewDOMID').PREFIX_MEDLEY+y;};x.registerCollections=function(y,z,aa){'use strict';c('ProfileOverviewSection').callWithSection(x.getIDBySK(y),function(ba){ba._tabObj=null;if(ba.childSections){var ca=ba.childSections.getHead();while(ca){ca._resetAuxContent();ca=ca.getNext();}}c('TimelineAppCollectionFactory').createFromArray(y,z).forEach(ba.appendSection,ba);var da=ba.childSections.get(aa);ba.setActiveCollection(da);da.setIsLoaded(true);});};x.removeEmptyAppSection=function(y){'use strict';c('ProfileOverviewSection').callWithSection(x.getIDBySK(y),function(z){z.remove();});};Object.assign(x,c('TidyArbiterMixin'));f.exports=x;},null);
__d('TimelinePlacesSection',['TimelineAppSection','TimelinePlacesCollection'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('TimelineAppSection'));i=h&&h.prototype;function j(k,l,m,n){'use strict';i.constructor.call(this,k,l,m,n);}j.prototype.hideCollection=function(k){'use strict';i.hideCollection.call(this,k);if(k instanceof c('TimelinePlacesCollection'))k.hide();};j.prototype.showCollection=function(k){'use strict';i.showCollection.call(this,k);if(k instanceof c('TimelinePlacesCollection'))k.show();};f.exports=j;},null);
__d('TimelineAppSectionFactory',['TimelineAppSection','TimelinePlacesSection'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h="map";function i(){'use strict';}i.createFromArray=function(j){'use strict';return j.map(function(k){if(k.sk===h)return new (c('TimelinePlacesSection'))(k.controller,k.sk,k.label,k.title);return new (c('TimelineAppSection'))(k.controller,k.sk,k.label,k.title);});};f.exports=i;},null);
__d('TimelineMedley',['csx','cx','Arbiter','CSS','DOM','DOMQuery','ProfileOverviewDOMID','PageTransitions','ProfileTabUtils','TimelineAppSection','TimelineAppSectionFactory','TimelineMonitor','ProfileOverviewSection','TimelineURI','URI','ViewportBounds','$','ge','getElementPosition'],function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=2,m=false;j=babelHelpers.inherits(n,c('ProfileOverviewSection'));k=j&&j.prototype;function n(o,p,q){'use strict';k.constructor.call(this,c('ProfileOverviewDOMID').MEDLEY_ROOT);this._sectionBreaker=q.breaker;c('TimelineAppSectionFactory').createFromArray(o).forEach(this.appendSection,this);c('TimelineMonitor').monitorSection(this);this._lastLoadedSection=this.childSections.get(c('TimelineAppSection').getIDBySK(p)).setIsLoaded(true);c('ProfileOverviewSection').setActiveSectionID(this._lastLoadedSection.id);if(m&&this.isOverviewProfileTab())this.addSectionPlaceholders();var r=c('URI').getNextURI();this._vanity=c('TimelineURI').getVanityFromURI(r);this._sk=c('TimelineURI').getTabKeyFromURI(r);c('PageTransitions').registerHandler(this._transitionHandler.bind(this));}n.prototype.addSectionTeasers=function(){'use strict';if(!this.isOverviewProfileTab()){c('CSS').removeClass(this.getNode(),"_c4f");this.thawChildren();this.addSectionPlaceholders();this.addSectionBreak();}};n.prototype.addUpcomingSectionPlaceholders=function(o,p){'use strict';p=p||l;while(o=o.getNext())if(!this.addSectionPlaceholder(o,o.getPrev())&&--p<=0)break;};n.prototype.addSectionPlaceholder=function(o,p,q){'use strict';if(!o.isLoaded()&&c('ge')(o.nodeID))return false;if(!c('ge')(o.nodeID)){c('DOM').insertAfter(p.getNode(),o.getNode());o.createTriggerLoader(q);return false;}return true;};n.prototype.addSectionBreak=function(){'use strict';if(this._lastLoadedSection.getNext()){c('DOM').insertAfter(this.childSections.getHead().getNode(),this._sectionBreaker);}else c('DOM').remove(this._sectionBreaker);};n.prototype.removeChildSection=function(o){'use strict';this.childSections.remove(o);if(this.childSections.getCount()==1)c('DOM').remove(this._sectionBreaker);};n.prototype.addSectionPlaceholders=function(){'use strict';this.addUpcomingSectionPlaceholders(this._lastLoadedSection);};n.prototype.getNode=function(){'use strict';return c('$')(this.id);};n.prototype.isOverviewProfileTab=function(){'use strict';return c('ProfileTabUtils').isOverviewTab(this._sk);};n.prototype.toggleScrollLoad=function(o){'use strict';m=o;if(o){this.thawChildren();this.addSectionPlaceholders();}else this.freezeChildren();};n.prototype._transitionHandler=function(o){'use strict';if(c('TimelineURI').getVanityFromURI(o)!==this._vanity)return false;var p=c('TimelineURI').getTabKeyFromURI(o);if(c('ProfileTabUtils').isTimelineTab(p))return false;if(c('ProfileTabUtils').isOverviewTab(p)){return false;}else{var q=o.getQueryData();if(!q.next_cursor)return false;var r=this.childSections.getHead();while(r){if(r._sk===p){if(!r._activeCollection||!c('DOMQuery').scry(r._activeCollection.getNode(),"._3t3")[0])return false;c('Arbiter').inform("save_facebar_query",true);setTimeout(this._transitionToSection.bind(this,r,q),0);return true;}r=r.getNext();}}return false;};n.prototype._transitionToSection=function(o,p){'use strict';var q=c('getElementPosition')(o.getNode()).y-c('ViewportBounds').getTop();c('DOM').scry(o.getNode(),"._51k9").forEach(function(t){c('CSS').removeClass(t,"_51k9");});this._sk=o._sk;c('ProfileOverviewSection').setActiveSectionID(o.id);o.thaw();c('CSS').addClass(this.getNode(),"_c4f");this.freezeChildren();var r=c('DOMQuery').find(o._activeCollection.getNode(),"._3t3");o._activeCollection.addContentLoader(r,p.next_cursor);o._activeCollection._contentLoader.load({node:r});var s=this.childSections.getHead();while(s&&s.id!==o.id){s.remove();s=this.childSections.getHead();}c('ProfileOverviewSection').inform('Medley/transitionToSection',o.id);o.scrollTo(q<0?q:0);c('PageTransitions').transitionComplete();};n.loadToSection=function(o,p){'use strict';c('ProfileOverviewSection').setActiveSectionID(o);c('ProfileOverviewSection').callWithSection(c('ProfileOverviewDOMID').MEDLEY_ROOT,function(q){var r=q.childSections.getHead(),s=0;while(r&&r.id!==o){s++;r=r.getNext();}if(!s)return p(r);s--;s&&q.addUpcomingSectionPlaceholders(q.childSections.getHead(),s);q.addSectionPlaceholder(r,r.getPrev(),true);var t=r.subscribe('loaded',function(){p(r);t.unsubscribe();});});};n.scrollToSection=function(o,p,q){'use strict';c('ProfileOverviewSection').callWithSection(o,function(r){r.scrollTo(p,q);});};n.toggleScrollLoad=function(o){'use strict';m=o;c('ProfileOverviewSection').callWithSection(c('ProfileOverviewDOMID').MEDLEY_ROOT,function(p){p.toggleScrollLoad(o);});};f.exports=n;},null);
__d('PhotosAppSection',['TimelineAppSection','TimelineAppSectionCuration','TidyArbiterMixin'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=babelHelpers['extends']({init:function(i){var j=c('TimelineAppSection').getIDBySK(i);c('TimelineAppSectionCuration').subscribe('toggle_drawer',function(k,l){if(l.section.id===j)h.inform('toggle_drawer',l);});}},c('TidyArbiterMixin'));f.exports=h;},null);
__d('PhotoCreateButtonsVisibility',['csx','Arbiter','CSS','DOMQuery','Event','Parent','$'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(k){var l=c('Parent').bySelector(k,"._3cz");return c('DOMQuery').find(l,"._69l");}var j={addHideClickListener:function(k){c('Event').listen(k,'click',function(){c('CSS').hide(i(k));});},addShowClickListener:function(k){c('Event').listen(k,'click',function(){c('CSS').show(i(k));});},hideButtons:function(k){var l=c('$')('pagelet_timeline_medley_photos');c('CSS').hide(c('DOMQuery').find(l,"._69l"));},showButtonOnTabChange:function(k){c('Arbiter').subscribe('Medley/tab-change',function(l){c('CSS').show(k);});}};f.exports=j;},null);