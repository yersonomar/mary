/*!CK:3821890728!*//*1457739548,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["oalUJ"]); }

__d('OGCollectionAddCuration',['AsyncRequest','DataStore','DOM','tidyEvent'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='OGCollectionAddCuration';function i(j,k,l,m,n,o){this._container=j;this._control=k;this._itemID=l;this._surface=n;this._display=o.display;if(k)c('tidyEvent')([k.subscribe('reload',this.reloadControl.bind(this))]);if(m)c('DataStore').set(String(m),h,this);if(l)c('DataStore').set(String(l),h,this);}Object.assign(i,{handleDeleteAction:function(j){var k=c('DataStore').get(String(j),h);if(k)k.reloadControl();},handleAddItemSuccess:function(j,k,l){var m=c('DataStore').get(String(j),h);c('DataStore').set(String(k),h,m);m.insertMenuIntoDialog(l);},hideControl:function(j){var k=c('DataStore').get(String(j),h);k.hideControl();},insertControl:function(j,k){var l=c('DataStore').get(String(j),h);l.replaceControl(k);},reloadControl:function(j){var k=c('DataStore').get(String(j),h);if(k)k.reloadControl();}});Object.assign(i.prototype,{hideControl:function(){this._control.hide();},reloadControl:function(){var j=new (c('AsyncRequest'))('/ajax/collections/add_curation').setData({itemid:this._itemID,surface:this._surface,forceedit:true,display:this._display}).setHandler(this._handleAddCurationResponse.bind(this));j.send();},insertMenuIntoDialog:function(j){this._control.insertMenuIntoDialog(j);},replaceControl:function(j){c('DOM').replace(this._container,j);},getMenuControl:function(){return this._control;},_handleAddCurationResponse:function(j){this._control.destroy();c('DOM').replace(this._container,j.payload);}});f.exports=i;},null);
__d('OGCollectionAddDialog',['csx','AsyncRequest','DataStore','DOMQuery','Form','MenuDeprecated','URI','collectDataAttributes','tidyEvent'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='OGCollectionAddDialog';function j(k,l,m,n,o){this._dialog=k;this._surface=l;this._endpoint=new (c('URI'))(n);this._loadEditMenu=o.loadEditMenu;this._listener=c('DataStore').get(String(m),i);this._audienceSelector=c('DOMQuery').find(this._dialog.getContent(),'.audienceSelector');this._menu=c('DOMQuery').find(this._dialog.getContent(),"._4-jt");c('MenuDeprecated').register(this._menu);this._menuSubscriptionToken=c('MenuDeprecated').subscribe('select',this._onMenuClick.bind(this));c('tidyEvent')([this._dialog.subscribe('show',this._onDialogShow.bind(this)),this._dialog.subscribe('hide',this._onDialogHide.bind(this))]);if(o.setContextToParent)this._dialog.setContext(this._dialog.getContext().parentNode);this._dialog.show();}Object.assign(j,{INSTANCE_KEY:i});Object.assign(j.prototype,{_onDialogShow:function(){this._listener.onDialogShow(this._dialog);},_onDialogHide:function(){this._destroy();},_onMenuClick:function(k,l){if(l.menu!==this._menu)return;var m=l.item;this._listener.onMenuClick(m);var n=c('DOMQuery').find(m,"._5581"),o=n.getAttribute('value');this._submitRequest(o);},_submitRequest:function(k){this._endpoint.addQueryData({collection_token:k});this._dialog.hide();this._request=new (c('AsyncRequest'))(this._endpoint).setData(Object.assign(c('Form').serialize(this._audienceSelector),{action:'add',load_edit_menu:this._loadEditMenu,surface:this._surface},c('collectDataAttributes')(this._dialog.getContext(),['ft'])));this._request.send();},_destroy:function(){this._listener.onDialogHide();c('MenuDeprecated').unsubscribe(this._menuSubscriptionToken);}});f.exports=j;},null);
__d('OGCollectionAddMenu',['csx','cx','CSS','DataStore','DOM','DOMQuery','Event','OGCollectionAddDialog','Parent','TidyArbiterMixin','tidyEvent'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k,l,m,n,o,p){this._image=l;this._container=m;this._placeholder=n;this._surface=o;this._rateControl=c('DOM').scry(this._container.parentNode,"._5fza")[0];j.inform('addButton',{button:this._image,root:this._container});c('tidyEvent')(c('Event').listen(this._container,'click',function(q){var r=c('Parent').bySelector(q.getTarget(),"._5859");if(this.isDialogShowing()&&r)q.kill();}.bind(this)));if(this._surface==='friend_timeline_lhc')this._handleAlwaysVisibleLHC();c('DataStore').set(String(k),c('OGCollectionAddDialog').INSTANCE_KEY,this);}Object.assign(j,c('TidyArbiterMixin'));Object.assign(j.prototype,c('TidyArbiterMixin'),{destroy:function(){c('DOM').remove(this._container);this._placeholder.destroy();},hide:function(){c('CSS').hide(this._image);this._placeholder.hide();},getParent:function(){return this._container.parentNode;},insertMenuIntoDialog:function(k){this._placeholder.insertIntoDialog(k);},onMenuClick:function(k){var l=c('DOMQuery').find(k,"._5582");this._showRate=this._rateControl&&l.getAttribute('value');if(this._showRate){this.switchToShowRate();c('Event').fire(this._rateControl,'click');}else this._switchToShowPlaceholder();this.inform('menuclicked');},onDialogShow:function(k){var l=c('DOMQuery').find(k.getContent(),'.audienceSelector');c('CSS').addClass(this._image,'openToggler');j.inform('menuOpened',{audienceSelector:l.parentNode});this._dialogShowing=true;},onDialogHide:function(){c('CSS').removeClass(this._image,'openToggler');this._dialogShowing=false;},isDialogShowing:function(){return this._dialogShowing;},_switchToShowPlaceholder:function(){c('CSS').hide(this._image);c('CSS').show(this._placeholder.getIcon());},switchToShowRate:function(){c('CSS').hide(this._image);c('CSS').show(this._rateControl);},_handleAlwaysVisibleLHC:function(){var k=c('Parent').bySelector(this._container,"._4_ij"),l=c('Parent').bySelector(k,"._5-r");if(c('CSS').hasClass(k,"_58v0"))c('tidyEvent')([this._alwaysVisibleToken=c('Event').listen(l,'mouseenter',function(){c('CSS').removeClass(k,"_58v0");this._alwaysVisibleToken.remove();}.bind(this))]);}});f.exports=j;},null);
__d('OGCollectionAddedIconPlaceholder',['csx','CSS','DataStore','DOM','DOMQuery','Event','tidyEvent'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i='OGCollectionAddedIconPlaceholder';function j(k,l,m,n){this._dialog=m;this._icon=l;this._addPlaceholder=n;c('tidyEvent')(c('Event').listen(l,'click',m.show.bind(m)));c('DataStore').set(String(k),i,this);}Object.assign(j,{loadEditMenu:function(k,l){var m=c('DataStore').get(String(k),i);m.insertIntoDialog(l);}});Object.assign(j.prototype,{destroy:function(){this._dialog.destroy();},getIcon:function(){return this._icon;},hide:function(){c('CSS').hide(this._icon);c('CSS').show(this._addPlaceholder);this._dialog.hide();},insertIntoDialog:function(k){c('DOM').setContent(c('DOMQuery').find(this._dialog.getContent(),"._51rr"),k);}});f.exports=j;},null);
__d('OGCollectionAddedIconRate',['DataStore','Event','tidyEvent'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='OGCollectionAddedIconRate';function i(j,k){this._link=j;c('DataStore').set(String(k),h,this);}i.disable=function(j){var k=c('DataStore').get(String(j),h);k._disable();};Object.assign(i.prototype,{_disable:function(){c('tidyEvent')(c('Event').listen(this._link,'click',function(j){j.kill();}));}});f.exports=i;},null);